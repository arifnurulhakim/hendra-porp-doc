<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hendra Prop - Dokumentasi Analisis & Desain Sistem Lengkap</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        @page {
            size: A4;
            margin: 2cm;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.7;
            color: #1a202c;
            background: #f7fafc;
            padding: 0;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        @media print {
            body { background: white; padding: 0; font-size: 9pt; max-width: 100%; line-height: 1.4; }
            .no-print { display: none !important; }
            .cover, .toc-section { page-break-after: always; }
            .page-break { page-break-before: always; }
            h1 { font-size: 14pt; page-break-after: avoid; }
            h2 { font-size: 12pt; page-break-after: avoid; }
            h3 { font-size: 10pt; page-break-after: avoid; }
            h4 { font-size: 9pt; page-break-after: avoid; }
            pre, table { page-break-inside: avoid; font-size: 7pt; }
            .content-section { page-break-inside: avoid; }
        }
        
        /* COVER PAGE */
        .cover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8rem 4rem;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .cover h1 { 
            font-size: 4rem; 
            font-weight: 700; 
            margin-bottom: 1.5rem; 
            color: white; 
            border: none; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .cover .subtitle { 
            font-size: 1.8rem; 
            opacity: 0.95; 
            margin-bottom: 1rem;
            font-weight: 300;
        }
        .cover .subtitle-2 {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 3rem;
        }
        .cover .meta { 
            font-size: 1.1rem; 
            opacity: 0.9;
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        .cover .meta p {
            margin: 0.5rem 0;
        }
        
        /* TABLE OF CONTENTS */
        .toc-section {
            background: white;
            padding: 3rem;
            min-height: 100vh;
        }
        .toc-container {
            margin-top: 2rem;
        }
        .toc-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }
        .toc-list {
            list-style: none;
            padding-left: 0;
            margin: 1rem 0 2rem 0;
        }
        .toc-list li {
            margin: 0.5rem 0;
            padding-left: 0;
        }
        .toc-list li a {
            color: #4a5568;
            text-decoration: none;
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
        }
        .toc-list li a:hover {
            color: #667eea;
        }
        .toc-level-1 {
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        .toc-level-2 {
            padding-left: 1.5rem;
            font-size: 0.95rem;
        }
        .toc-level-3 {
            padding-left: 3rem;
            font-size: 0.9rem;
            color: #718096;
        }
        
        /* CONTENT SECTIONS */
        .content-section {
            background: white;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h1 { 
            color: #667eea; 
            font-size: 2.5rem; 
            margin-bottom: 1.5rem; 
            border-bottom: 3px solid #667eea; 
            padding-bottom: 0.5rem; 
        }
        h2 { 
            color: #5a67d8; 
            font-size: 1.8rem; 
            margin: 2rem 0 1rem 0; 
            border-left: 4px solid #667eea; 
            padding-left: 1rem; 
        }
        h3 { 
            color: #4c51bf; 
            font-size: 1.4rem; 
            margin: 1.5rem 0 1rem 0; 
        }
        h4 { 
            color: #434190; 
            font-size: 1.1rem; 
            margin: 1rem 0 0.5rem 0; 
        }
        p { 
            margin-bottom: 1rem; 
            color: #4a5568; 
        }
        
        /* FIXED: Proper list styling */
        ul { 
            margin: 1rem 0;
            padding-left: 2rem;
            list-style-type: disc;
            color: #4a5568;
        }
        ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: #4a5568;
        }
        li { 
            margin: 0.4rem 0;
            padding-left: 0.3rem;
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 1.5rem 0; 
            font-size: 0.9rem; 
        }
        th { 
            background: #667eea; 
            color: white; 
            padding: 0.75rem; 
            text-align: left; 
            font-weight: 600; 
        }
        td { 
            padding: 0.75rem; 
            border-bottom: 1px solid #e2e8f0; 
        }
        tr:hover { 
            background: #f7fafc; 
        }
        
        pre { 
            background: #1a202c; 
            color: #e2e8f0; 
            padding: 1.5rem; 
            border-radius: 8px; 
            overflow-x: auto; 
            margin: 1.5rem 0; 
            font-size: 0.85rem; 
            line-height: 1.5; 
            white-space: pre-wrap; 
        }
        code { 
            background: #edf2f7; 
            color: #d53f8c; 
            padding: 0.2rem 0.5rem; 
            border-radius: 4px; 
            font-size: 0.9em; 
            font-family: 'Consolas', 'Monaco', monospace; 
        }
        pre code { 
            background: none; 
            color: inherit; 
            padding: 0; 
        }
        
        .alert { 
            padding: 1rem 1.5rem; 
            border-radius: 8px; 
            margin: 1.5rem 0; 
            border-left: 4px solid; 
        }
        .alert-info { 
            background: #ebf8ff; 
            border-color: #3182ce; 
            color: #2c5282; 
        }
        .alert-warning { 
            background: #fffaf0; 
            border-color: #dd6b20; 
            color: #7c2d12; 
        }
        .alert-success { 
            background: #f0fff4; 
            border-color: #38a169; 
            color: #22543d; 
        }
        
        .badge { 
            display: inline-block; 
            padding: 0.25rem 0.75rem; 
            border-radius: 12px; 
            font-size: 0.85rem; 
            font-weight: 600; 
            margin: 0.25rem; 
        }
        .badge-critical { 
            background: #fc8181; 
            color: #742a2a; 
        }
        .badge-high { 
            background: #f6ad55; 
            color: #7c2d12; 
        }
        .badge-medium { 
            background: #68d391; 
            color: #22543d; 
        }
        
        .print-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #667eea;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: all 0.3s;
        }
        .print-button:hover { 
            background: #5a67d8; 
            transform: translateY(-2px); 
            box-shadow: 0 6px 10px rgba(0,0,0,0.15); 
        }
        
        hr { 
            border: none; 
<div class="content-section page-break" id="section-1">
<h1>BAB 1: Business Requirements Document (BRD)</h1>

<p><strong>Dokumen Business Requirements Document (BRD)</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Functional Requirements</h2>
<h3>1.1 Authentication & Authorization</h3>
<h4>FR-AUTH-001: Multi-Role Login</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>User Story:</strong> Sebagai user, saya ingin login dengan role yang berbeda agar bisa akses fitur sesuai permission  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>System harus support 4 role: Admin Master, Admin Kantor, Agen, Buyer</li>
<li>Login menggunakan email & password</li>
<li>Session management dengan timeout 24 jam</li>
<li>Remember me option (7 hari)</li>
<li>Forgot password functionality</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ User bisa login dengan email & password</li>
<li>✅ System mengarahkan ke dashboard sesuai role</li>
<li>✅ Invalid credentials menampilkan error message</li>
<li>✅ User bisa logout dan session ter-invalidate</li>
</ul>
<hr>
<h4>FR-AUTH-002: Role-Based Access Control (RBAC)</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Permission Matrix:</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Admin Master</th>
<th>Admin Kantor</th>
<th>Agen</th>
<th>Buyer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Manage Kantor</td>
<td>✅ Full</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Manage Agen</td>
<td>✅ All</td>
<td>✅ Own Office</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Manage Property</td>
<td>✅ All</td>
<td>✅ Own Office</td>
<td>✅ Own Only</td>
<td>❌</td>
</tr>
<tr>
<td>Input Transaction</td>
<td>✅ All</td>
<td>✅ Own Office</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Set Commission</td>
<td>✅ All</td>
<td>✅ Own Office</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>View Performance</td>
<td>✅ All</td>
<td>✅ Own Office</td>
<td>✅ Own Only</td>
<td>❌</td>
</tr>
<tr>
<td>View Public Listing</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>✅ User hanya bisa akses fitur sesuai role</li>
<li>✅ Unauthorized access menampilkan 403 Forbidden</li>
<li>✅ URL protection (tidak bisa bypass via direct link)</li>
</ul>
<hr>
<h3>1.2 Kantor Management</h3>
<h4>FR-OFFICE-001: CRUD Kantor</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Create kantor baru dengan data: nama, alamat, telepon, email</li>
<li>Read/View daftar semua kantor</li>
<li>Update data kantor</li>
<li>Soft delete kantor (tidak hard delete jika sudah ada agen)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Admin Master bisa create kantor baru</li>
<li>✅ Validation: nama, telepon, email required</li>
<li>✅ List kantor show jumlah agen di masing-masing kantor</li>
<li>✅ Delete kantor yang sudah punya agen harus confirm dulu</li>
</ul>
<hr>
<h4>FR-OFFICE-002: Assign Admin Kantor</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Assign user dengan role Admin Kantor ke kantor tertentu</li>
<li>Satu kantor bisa punya multiple Admin Kantor</li>
<li>Satu Admin Kantor bisa manage multiple kantor</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Admin Master bisa assign Admin Kantor ke kantor</li>
<li>✅ Admin Kantor hanya lihat data kantor yang di-assign ke dia</li>
<li>✅ Bisa unassign Admin Kantor dari kantor</li>
</ul>
<hr>
<h3>1.3 Agen Management</h3>
<h4>FR-AGENT-001: CRUD Agen</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Create agen baru dengan data: nama, email, telepon, foto, kantor</li>
<li>Satu agen hanya bisa assigned ke 1 kantor (dedicated)</li>
<li>Update data agen</li>
<li>Activate/Deactivate agen (soft delete)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Create agen dengan assign ke kantor</li>
<li>✅ Validation: email unique, telepon required</li>
<li>✅ Admin Kantor hanya bisa create agen untuk kantornya</li>
<li>✅ Admin Master bisa create agen untuk semua kantor</li>
<li>✅ Agen inactive tidak bisa login dan tidak muncul di listing</li>
</ul>
<hr>
<h4>FR-AGENT-002: Agen Profile</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Agen  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Agen bisa edit profile sendiri (foto, bio, kontak)</li>
<li>Tidak bisa pindah kantor sendiri (harus lewat admin)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Agen bisa update foto profile</li>
<li>✅ Agen bisa update nomor WA & telepon</li>
<li>✅ Field kantor read-only (tidak bisa edit)</li>
</ul>
<hr>
<h3>1.4 Property Management</h3>
<h4>FR-PROP-001: Create Property</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Input properti dengan field:</li>
<li>Judul listing</li>
<li>Deskripsi (rich text)</li>
<li>Tipe (Rumah, Apartemen, Tanah, Komersial)</li>
<li>Status listing (Jual/Sewa/Keduanya)</li>
<li>Harga (IDR)</li>
<li>Harga per m² (auto-calculate)</li>
<li>Luas tanah (m²)</li>
<li>Luas bangunan (m²)</li>
<li>Alamat lengkap</li>
<li>Koordinat (optional - for map)</li>
<li>Jumlah kamar tidur</li>
<li>Jumlah kamar mandi</li>
<li>Foto (max 10 foto)</li>
<li>Sertifikat (SHM, HGB, dll)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input properti dengan validation</li>
<li>✅ Upload multiple foto (max 10, max 5MB per foto)</li>
<li>✅ Auto-calculate harga/m² dari harga / luas tanah</li>
<li>✅ Properti otomatis assigned ke agen yang create</li>
<li>✅ Admin bisa assign properti ke agen lain</li>
</ul>
<hr>
<h4>FR-PROP-002: Edit Property</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen (owner)  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Agen hanya bisa edit properti miliknya</li>
<li>Admin Kantor bisa edit properti di kantornya</li>
<li>Admin Master bisa edit semua properti</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Edit semua field termasuk foto</li>
<li>✅ Add/remove foto</li>
<li>✅ Change status (Available → Sold/Rented)</li>
<li>✅ Log history perubahan (audit trail)</li>
</ul>
<hr>
<h4>FR-PROP-003: Property Status</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Status Flow:</strong></p>
<pre><code>Available → Pending → Sold/Rented
    ↑                      |
    └──────────────────────┘
         (Batalkan transaksi)
</code></pre>
<p><strong>Requirements:</strong></p>
<ul>
<li>Available: Properti bisa dilihat public</li>
<li>Pending: Ada calon buyer, nego berjalan (masih show di public)</li>
<li>Sold/Rented: Transaksi selesai (hide dari public)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Status available show di public listing</li>
<li>✅ Status sold/rented hide dari public (hanya internal view)</li>
<li>✅ Bisa revert status jika transaksi gagal</li>
</ul>
<hr>
<h4>FR-PROP-004: Property Photos</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Upload max 10 foto per properti</li>
<li>Format: JPG, PNG</li>
<li>Max size: 5MB per foto</li>
<li>Auto-resize & compress untuk performance</li>
<li>Drag & drop untuk reorder foto</li>
<li>Foto pertama = cover image</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Upload multiple foto sekaligus</li>
<li>✅ Drag & drop reorder</li>
<li>✅ Delete foto</li>
<li>✅ Set cover image</li>
<li>✅ Foto ter-compress tanpa degradasi kualitas signifikan</li>
</ul>
<hr>
<h4>FR-PROP-005: Public Marketplace</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Admin/Agen bisa toggle properti untuk ditampilkan di public marketplace</li>
<li>Field: <code>is_public</code> (boolean) - default TRUE untuk auto-publish</li>
<li>Field: <code>published_at</code> (datetime) - timestamp publikasi</li>
<li>Properti dengan <code>is_public = true</code> dan <code>status = available/pending</code> muncul di marketplace</li>
<li>Properti dengan <code>status = sold/rented</code> atau <code>is_public = false</code> tidak muncul</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Toggle "Publish to Marketplace" di form property</li>
<li>✅ Auto-set <code>published_at</code> saat pertama kali di-publish</li>
<li>✅ Unpublish tidak menghapus property, hanya hide dari public</li>
<li>✅ Filter di public marketplace: hanya show property yang <code>is_public = true</code></li>
<li>✅ View counter (<code>views_count</code>) increment setiap property detail dibuka</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Hanya properti yang sudah approved yang bisa di-publish</li>
<li>Soft-deleted properties otomatis unpublish</li>
<li>Admin bisa force unpublish property agen</li>
</ul>
<hr>
<h4>FR-PROP-006: Private Tokenized Link</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Generate private link dengan token unik untuk properti tertentu</li>
<li>Link format: <code>/property/{slug}?token={random_token}</code></li>
<li>Token expiration: default 7 hari (customizable)</li>
<li>Single-use option: link hanya bisa dibuka 1x</li>
<li>Track access: siapa/kapan link dibuka</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button "Generate Private Link" di property detail (admin panel)</li>
<li>✅ Form: expiration date, is_single_use checkbox</li>
<li>✅ Generate random token (64 characters)</li>
<li>✅ Copy link to clipboard functionality</li>
<li>✅ List all generated links per property (dengan status: active/expired/used)</li>
<li>✅ Expired link show "Link Expired" page</li>
<li>✅ Used single-use link show "Link Already Used" page</li>
<li>✅ Valid link show property detail (tanpa agent contact info)</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Check if link is valid
- Token exists in property_links table
- expires_at > now()
- If is_used = true: access_count must be 0
- Property must not be deleted
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Exclusive/premium property untuk VIP customer</li>
<li>Pre-launch property viewing</li>
<li>Agent share ke specific buyer (tanpa publish publik)</li>
</ul>
<hr>
<h4>FR-PROP-007: Property Moderation/Approval System</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Kantor, Agen  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Agen create property → status <code>approval_status</code> = DRAFT (belum submit)</li>
<li>Agen bisa save draft tanpa submit approval</li>
<li>Agen submit untuk review → status jadi PENDING</li>
<li>Admin Kantor review submission:</li>
<li><strong>Approve</strong> → status jadi PUBLISHED (bisa tampil di public)</li>
<li><strong>Decline</strong> → status jadi DECLINED (rejected permanently)</li>
<li><strong>Request Revision</strong> → status jadi NEED_REVISION (agent harus perbaiki)</li>
<li>Jika NEED_REVISION → Admin Kantor input revision notes</li>
<li>Agen perbaiki property → resubmit → kembali ke PENDING</li>
<li>Hanya property dengan status PUBLISHED yang bisa tampil di public marketplace</li>
</ul>
<p><strong>Approval Status Flow:</strong></p>
<pre><code>DRAFT ──(submit)──> PENDING ──(approve)──> PUBLISHED
                       │
                       ├──(decline)──> DECLINED
                       │
                       └──(request revision)──> NEED_REVISION
                                                       │
                                                       └──(resubmit)──> PENDING
</code></pre>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Agen create property → default status = DRAFT</li>
<li>✅ Button "Submit for Approval" (hanya muncul jika status DRAFT or NEED_REVISION)</li>
<li>✅ Admin Kantor lihat list properties dengan status PENDING</li>
<li>✅ Admin Kantor bisa Approve/Decline/Request Revision</li>
<li>✅ Jika Request Revision → Admin wajib isi revision notes</li>
<li>✅ Agen dapat notifikasi (email + dashboard) saat status berubah</li>
<li>✅ Agen bisa lihat revision notes dari Admin</li>
<li>✅ Property dengan status PUBLISHED baru bisa di-publish ke marketplace</li>
<li>✅ Log semua approval actions ke activity_log</li>
</ul>
<p><strong>Field Changes:</strong></p>
<ul>
<li><code>approval_status</code> ENUM: draft, pending, published, declined, need_revision</li>
<li><code>submitted_at</code> DATETIME: kapan agent submit</li>
<li><code>reviewed_by</code> FK to users: Admin Kantor yang review</li>
<li><code>reviewed_at</code> DATETIME: kapan di-review</li>
<li><code>revision_notes</code> TEXT: notes dari admin untuk revision</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Hanya Admin Kantor yang bisa approve property di kantornya</li>
<li>Admin Master bisa approve property di semua kantor</li>
<li>Property yang DECLINED tidak bisa di-resubmit (harus create new)</li>
<li>Property NEED_REVISION bisa di-edit dan resubmit unlimited</li>
<li>Auto-notify Agent via email saat status berubah</li>
<li>Public marketplace hanya show property dengan <code>approval_status = PUBLISHED</code> AND <code>is_public = TRUE</code></li>
</ul>
<hr>
<h4>FR-PROP-008: Visitor Form (Lead Capture)</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Public Visitor (via private link)  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Visitor akses private link → harus isi form dulu sebelum bisa lihat property</li>
<li>Form fields:</li>
<li>Nama lengkap (required)</li>
<li>Email (required, validated)</li>
<li>Nomor telepon (optional)</li>
<li>WhatsApp (optional)</li>
<li>Interest level (required): Low, Medium, High, Very High</li>
<li>Message/notes (optional, textarea)</li>
<li>Setelah submit form → visitor bisa lihat property detail</li>
<li>Data visitor disimpan ke table <code>property_visitors</code></li>
<li>Agent dapat notifikasi jika visitor dengan interest HIGH atau VERY_HIGH</li>
<li>Agent bisa lihat daftar semua visitors per property</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Visitor klik private link → redirect ke visitor form page</li>
<li>✅ Form validation: nama & email required</li>
<li>✅ Submit form → redirect ke property detail page</li>
<li>✅ Visitor data tersimpan di <code>property_visitors</code> table</li>
<li>✅ Agent dapat email notifikasi untuk HIGH/VERY_HIGH interest</li>
<li>✅ Agent bisa view list visitors di property detail page (admin panel)</li>
<li>✅ Track IP address & user agent untuk security</li>
<li>✅ Prevent duplicate submission dalam 1 hari (same email + property)</li>
</ul>
<p><strong>Table: <code>property_visitors</code></strong></p>
<pre><code>- property_link_id (FK ke property_links)
- property_id (FK ke properties - denormalized)
- visitor_name
- visitor_email
- visitor_phone
- visitor_whatsapp
- interest_level (ENUM: low, medium, high, very_high)
- message (TEXT)
- visited_at (DATETIME)
- ip_address
- user_agent
</code></pre>
<p><strong>Business Logic:</strong></p>
<ul>
<li>Auto-increment <code>access_count</code> di <code>property_links</code> setiap form disubmit</li>
<li>Notifikasi real-time ke agent untuk HIGH/VERY_HIGH interest</li>
<li>Export visitors to Excel untuk follow-up</li>
<li>Filter visitors by interest level di admin panel</li>
<li>Show "X people viewed this property" di property detail (agent view only)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Agent generate private link → share ke potential buyer via WhatsApp/Email</li>
<li>Buyer klik link → isi form (lead capture)</li>
<li>Buyer lihat property detail (tanpa contact info agent)</li>
<li>Agent follow-up based on interest level</li>
</ul>
<hr>
<h3>1.5 Public Listing (Buyer)</h3>
<h4>FR-PUBLIC-001: Browse Listing</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Buyer (public, no login)  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>List semua properti dengan status Available atau Pending</li>
<li>Grid view dengan foto cover, judul, harga, lokasi</li>
<li>Pagination (20 item per page)</li>
<li>Responsive design (mobile & desktop)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Show semua properti available</li>
<li>✅ Card show: foto cover, judul, harga, tipe, lokasi</li>
<li>✅ Click card → detail page</li>
<li>✅ Mobile responsive</li>
</ul>
<hr>
<h4>FR-PUBLIC-002: Search & Filter</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Buyer  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Search by keyword (judul, lokasi, deskripsi)</li>
<li>Filter:</li>
<li>Tipe properti (Rumah, Apartemen, Tanah, Komersial)</li>
<li>Status (Jual/Sewa)</li>
<li>Harga range (min-max)</li>
<li>Lokasi (dropdown kota/area)</li>
<li>Luas range (min-max m²)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Search real-time (debounce 300ms)</li>
<li>✅ Multiple filter bisa digabung</li>
<li>✅ Filter tersimpan di URL (shareable link)</li>
<li>✅ Show jumlah hasil: "Ditemukan 45 properti"</li>
</ul>
<hr>
<h4>FR-PUBLIC-003: Property Detail</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Buyer  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Show semua detail properti</li>
<li>Gallery foto (full screen)</li>
<li>Map lokasi (if koordinat tersedia)</li>
<li>Kontak agen: Nama, Foto, Telepon, WA</li>
<li>Button: Call & WhatsApp direct link</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ All fields ditampilkan dengan layout rapi</li>
<li>✅ Photo gallery dengan lightbox</li>
<li>✅ Click WA button → open WA dengan pre-filled message</li>
<li>✅ Click phone → call direct (di mobile)</li>
<li>✅ Share button (copy link)</li>
</ul>
<hr>
<h3>1.6 Transaction Management</h3>
<h4>FR-TRANS-001: Input Transaction</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Input transaksi dengan data:</li>
<li>Properti (dropdown)</li>
<li>Agen Owner (auto-fill dari properti)</li>
<li>Agen Buyer (optional, dropdown agen lain)</li>
<li>Buyer name & contact</li>
<li>Tipe transaksi (Jual/Sewa)</li>
<li>Harga final (bisa beda dari harga listing)</li>
<li>Tanggal transaksi</li>
<li>Catatan (optional)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input transaksi dengan validation</li>
<li>✅ Pilih properti → auto-fill agen owner</li>
<li>✅ Optional: pilih agen buyer (jika ada)</li>
<li>✅ Harga final default = harga listing, bisa diubah</li>
<li>✅ Submit → status properti otomatis jadi Sold/Rented</li>
</ul>
<hr>
<h4>FR-TRANS-002: Transaction List</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Admin Master: lihat semua transaksi</li>
<li>Admin Kantor: lihat transaksi di kantornya</li>
<li>Agen: lihat transaksi yang involve dia (owner atau buyer)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ List transaksi dengan filter by date, kantor, agen</li>
<li>✅ Show: properti, agen, buyer, harga, tanggal, status</li>
<li>✅ Click row → detail transaksi</li>
</ul>
<hr>
<h3>1.7 Commission Management</h3>
<h4>FR-COMM-001: Set Commission</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Setting komisi per transaksi (bukan global)</li>
<li>Default: 70% agen, 30% kantor (untuk sewa)</li>
<li>Customizable per transaksi:</li>
<li>% komisi dari harga final</li>
<li>Split agen vs kantor</li>
<li>Jika 2 agen: split antar agen</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Input transaksi → auto-calculate komisi dengan default split</li>
<li>✅ Admin bisa override split komisi</li>
<li>✅ Jika ada 2 agen: split 70% dibagi 2 (35% each)</li>
<li>✅ Komisi kantor tetap 30%</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>Harga final: Rp 1.000.000.000
Default komisi: 2% = Rp 20.000.000

Scenario 1: Hanya agen owner
- Agen owner: 70% × Rp 20jt = Rp 14jt
- Kantor: 30% × Rp 20jt = Rp 6jt

Scenario 2: Agen owner + agen buyer
- Agen owner: 35% × Rp 20jt = Rp 7jt
- Agen buyer: 35% × Rp 20jt = Rp 7jt
- Kantor: 30% × Rp 20jt = Rp 6jt
</code></pre>
<hr>
<h4>FR-COMM-002: Commission Status</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Status:</strong></p>
<ul>
<li>Pending: Transaksi selesai, komisi belum dibayar</li>
<li>Paid: Komisi sudah dibayar ke agen</li>
<li>Cancelled: Transaksi dibatalkan</li>
</ul>
<p><strong>Requirements:</strong></p>
<ul>
<li>Admin bisa mark komisi sebagai Paid (dengan tanggal bayar)</li>
<li>Agen bisa lihat status komisi mereka</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Admin bisa update status komisi</li>
<li>✅ Notifikasi ke agen saat komisi di-mark Paid</li>
<li>✅ Log history payment (tanggal, amount, metode)</li>
</ul>
<hr>
<h3>1.8 Performance Dashboard</h3>
<h4>FR-DASH-001: Agen Personal Dashboard</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Agen  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Widget:</li>
</ul>
<p>  1. Total Listing Active</p>
<p>  2. Total Omzet (sum harga final transaksi)</p>
<p>  3. Total Komisi (sum komisi)</p>
<p>  4. Komisi Pending (belum dibayar)</p>
<p>  5. Komisi Paid (sudah dibayar)</p>
<ul>
<li>Filter by date range (bulan ini, 3 bulan, 1 tahun, custom)</li>
<li>Chart: Omzet per bulan (line chart)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Dashboard show data real-time</li>
<li>✅ Filter date range update chart & numbers</li>
<li>✅ Click widget → detail list</li>
</ul>
<hr>
<h4>FR-DASH-002: Kantor Dashboard</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Admin Kantor  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Widget (aggregate agen di kantornya):</li>
</ul>
<p>  1. Total Agen Active</p>
<p>  2. Total Listing Active</p>
<p>  3. Total Omzet</p>
<p>  4. Total Komisi Kantor</p>
<ul>
<li>Table: Performance per agen (nama, listing, omzet, komisi)</li>
<li>Chart: Omzet per agen (bar chart)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Dashboard show aggregate data</li>
<li>✅ Table sortable by omzet/komisi</li>
<li>✅ Click agen → detail performance agen tersebut</li>
</ul>
<hr>
<h4>FR-DASH-003: Master Dashboard</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Admin Master  </p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Widget (aggregate semua kantor):</li>
</ul>
<p>  1. Total Kantor</p>
<p>  2. Total Agen</p>
<p>  3. Total Listing</p>
<p>  4. Total Omzet</p>
<p>  5. Total Komisi</p>
<ul>
<li>Table: Performance per kantor</li>
<li>Chart: Omzet per kantor (bar chart)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Dashboard show global data</li>
<li>✅ Table sortable</li>
<li>✅ Click kantor → detail performance kantor tersebut</li>
</ul>
<hr>
<h3>1.9 Activity Log & Audit Trail</h3>
<h4>FR-AUDIT-001: Activity Logging</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> System (automatic logging)</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Log semua perubahan penting di sistem (using spatie/laravel-activitylog)</li>
<li>Track siapa (causer) melakukan apa (action) pada data apa (subject)</li>
<li>Simpan old values & new values untuk audit trail</li>
<li>Log category: property, transaction, commission, user, approval</li>
</ul>
<p><strong>Activities yang di-log:</strong></p>
<ul>
<li>Create/Update/Delete properti (track: harga, status, is_public)</li>
<li>Create/Update transaksi</li>
<li>Update komisi (track: amount, status)</li>
<li>Approval/Rejection properti</li>
<li>User login/logout</li>
<li>Generate private link</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Auto-logging tanpa manual intervention</li>
<li>✅ Activity log viewable di admin panel (per entity & per user)</li>
<li>✅ Show: timestamp, user, action, entity, old/new values</li>
<li>✅ Filter by: date range, user, log category</li>
<li>✅ Search by keyword</li>
<li>✅ Export activity log ke Excel</li>
</ul>
<p><strong>Example Log Entry:</strong></p>
<pre><code>User: Admin Kantor 1
Action: Updated property price
Property: Rumah Mewah Jakarta #123
Changes:
  - price: 1.000.000.000 → 900.000.000
  - status: available → pending
Timestamp: 2025-11-15 14:30:00
</code></pre>
<hr>
<h4>FR-AUDIT-002: Transaction Audit Trail</h4>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Simpan semua perubahan komisi & harga jual dalam transaksi</li>
<li>Tidak bisa delete transaction history (hard constraint)</li>
<li>Track manual override komisi oleh admin</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Transaction detail page show full audit trail</li>
<li>✅ Show: created by, created at, modified by, modified at</li>
<li>✅ List semua perubahan komisi dengan reason</li>
<li>✅ Cannot delete/hard delete transactions</li>
</ul>
<hr>
<h3>1.10 Notification System</h3>
<h4>FR-NOTIF-001: Internal Notifications</h4>
<p><strong>Priority:</strong> P2 - MEDIUM  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor, Agen</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Notification di dashboard (bell icon dengan counter)</li>
<li>Notification categories:</li>
<li>Property approved/rejected</li>
<li>Property sold (untuk agen owner)</li>
<li>Commission paid (untuk agen)</li>
<li>New property needs review (untuk admin kantor)</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Bell icon di navbar dengan unread count</li>
<li>✅ Dropdown list showing latest 10 notifications</li>
<li>✅ Click notification → redirect ke related page</li>
<li>✅ Mark as read functionality</li>
<li>✅ Mark all as read button</li>
<li>✅ Notification auto-expire setelah 30 hari</li>
</ul>
<hr>
<h4>FR-NOTIF-002: Email Notifications</h4>
<p><strong>Priority:</strong> P2 - MEDIUM (Phase 2)  </p>
<p><strong>Actor:</strong> System (automatic)</p>
<p><strong>Email Triggers:</strong></p>
<ul>
<li>Property approved → Email ke agen</li>
<li>Property sold → Email ke agen owner & agen buyer</li>
<li>Commission paid → Email ke agen dengan detail</li>
<li>New property submitted → Email ke admin kantor untuk review</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Email template dengan branding Hendra Prop</li>
<li>✅ Include relevant links (view property, view commission)</li>
<li>✅ Toggle email notification ON/OFF per user (settings)</li>
<li>✅ Email queue (tidak send synchronous)</li>
</ul>
<hr>
<h3>1.11 Performance Board Enhanced</h3>
<h4>FR-PERF-001: Closing Rate Calculation</h4>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Calculate & display closing rate di performance board</li>
<li>Formula: <code>(Jumlah Properti Terjual / Total Listing) × 100%</code></li>
<li>Show per agen & per kantor</li>
<li>Filter by date range</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Closing rate column di performance table</li>
<li>✅ Color coding: >50% = green, 30-50% = yellow, <30% = red</li>
<li>✅ Sort by closing rate</li>
<li>✅ Include dalam export Excel</li>
</ul>
<p><strong>Example Display:</strong></p>
<pre><code>Agent A: 15 sold / 30 listings = 50% closing rate ✅
Agent B: 5 sold / 25 listings = 20% closing rate ⚠️
</code></pre>
<hr>
<h4>FR-PERF-002: Export Reports</h4>
<p><strong>Priority:</strong> P2 - MEDIUM (Phase 2)  </p>
<p><strong>Actor:</strong> Admin Master, Admin Kantor</p>
<p><strong>Requirements:</strong></p>
<ul>
<li>Export performance board ke Excel/PDF</li>
<li>Include: charts, tables, metrics</li>
<li>Customizable date range</li>
<li>Auto-generate filename with timestamp</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button "Export to Excel" & "Export to PDF"</li>
<li>✅ Excel: multiple sheets (summary, per-agent, per-kantor)</li>
<li>✅ PDF: professional layout dengan logo</li>
<li>✅ Download langsung (tidak email)</li>
</ul>
<hr>
<h2>2. Non-Functional Requirements</h2>
<h3>2.1 Performance</h3>
<h4>NFR-PERF-001: Page Load Time</h4>
<p><strong>Requirement:</strong> Page load time < 2 detik (avg)  </p>
<p><strong>Measurement:</strong> Google PageSpeed Insights score > 80</p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Image lazy loading</li>
<li>CSS/JS minification</li>
<li>CDN untuk static assets</li>
<li>Database query optimization</li>
<li>Caching (Redis)</li>
</ul>
<hr>
<h4>NFR-PERF-002: Concurrent Users</h4>
<p><strong>Requirement:</strong> Support 100 concurrent users tanpa degradasi performance  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Load testing dengan JMeter/K6</li>
<li>Server scaling plan (vertical/horizontal)</li>
<li>Database connection pooling</li>
</ul>
<hr>
<h3>2.2 Security</h3>
<h4>NFR-SEC-001: Authentication</h4>
<p><strong>Requirement:</strong> Secure authentication & session management  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Password hashing dengan bcrypt</li>
<li>CSRF protection (Laravel default)</li>
<li>XSS protection</li>
<li>SQL injection protection (Eloquent ORM)</li>
<li>Session timeout: 24 jam</li>
<li>Remember me: encrypted cookie</li>
</ul>
<hr>
<h4>NFR-SEC-002: Authorization</h4>
<p><strong>Requirement:</strong> Strict role-based access control  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Laravel Gate & Policy</li>
<li>Middleware untuk setiap route</li>
<li>Database-level permission check</li>
<li>Audit trail untuk sensitive actions</li>
</ul>
<hr>
<h4>NFR-SEC-003: Data Privacy</h4>
<p><strong>Requirement:</strong> Protect sensitive data  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>HTTPS only (SSL certificate)</li>
<li>Database encryption untuk sensitive fields</li>
<li>No password storage in plain text</li>
<li>GDPR compliance (user data deletion)</li>
</ul>
<hr>
<h3>2.3 Usability</h3>
<h4>NFR-USA-001: Responsive Design</h4>
<p><strong>Requirement:</strong> 100% responsive di mobile, tablet, desktop  </p>
<p><strong>Breakpoints:</strong></p>
<ul>
<li>Mobile: 320px - 768px</li>
<li>Tablet: 769px - 1024px</li>
<li>Desktop: > 1024px</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>Mobile-first design</li>
<li>Touch-friendly buttons (min 44x44px)</li>
<li>Readable font size (min 16px)</li>
</ul>
<hr>
<h4>NFR-USA-002: User Experience</h4>
<p><strong>Requirement:</strong> Intuitive & easy to use  </p>
<p><strong>Metrics:</strong></p>
<ul>
<li>User bisa input listing tanpa training</li>
<li>Max 3 clicks untuk reach any feature</li>
<li>Consistent UI/UX across pages</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>Follow Laravel Filament design patterns</li>
<li>Form validation dengan helpful error messages</li>
<li>Loading indicators untuk async actions</li>
<li>Success/error notifications</li>
</ul>
<hr>
<h3>2.4 Reliability</h3>
<h4>NFR-REL-001: Uptime</h4>
<p><strong>Requirement:</strong> 99% uptime (max 7.2 jam downtime per bulan)  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Monitoring dengan UptimeRobot</li>
<li>Automated backup daily</li>
<li>Disaster recovery plan</li>
</ul>
<hr>
<h4>NFR-REL-002: Data Backup</h4>
<p><strong>Requirement:</strong> Daily backup dengan retention 30 hari  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Automated database backup (MySQL dump)</li>
<li>File backup (foto properti)</li>
<li>Off-site backup storage</li>
<li>Tested recovery procedure</li>
</ul>
<hr>
<h3>2.5 Scalability</h3>
<h4>NFR-SCALE-001: Data Growth</h4>
<p><strong>Requirement:</strong> Support up to 10,000 listing & 1,000 agen  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Database indexing</li>
<li>Query optimization</li>
<li>Archive old data (> 2 tahun)</li>
</ul>
<hr>
<h4>NFR-SCALE-002: Feature Growth</h4>
<p><strong>Requirement:</strong> Arsitektur yang mudah di-extend untuk Phase 2  </p>
<p><strong>Implementation:</strong></p>
<ul>
<li>Modular architecture</li>
<li>Service-oriented design</li>
<li>API-first approach (untuk future mobile app)</li>
</ul>
<hr>
<h3>2.6 Compatibility</h3>
<h4>NFR-COMP-001: Browser Support</h4>
<p><strong>Requirement:</strong> Support modern browsers  </p>
<p><strong>Browsers:</strong></p>
<ul>
<li>Chrome (latest 2 versions)</li>
<li>Firefox (latest 2 versions)</li>
<li>Safari (latest 2 versions)</li>
<li>Edge (latest 2 versions)</li>
</ul>
<hr>
<h4>NFR-COMP-002: Mobile OS</h4>
<p><strong>Requirement:</strong> Support mobile browsers  </p>
<p><strong>Mobile OS:</strong></p>
<ul>
<li>iOS Safari (iOS 14+)</li>
<li>Android Chrome (Android 10+)</li>
</ul>
<hr>
<h3>2.7 Scheduled Tasks & Automation</h3>
<h4>NFR-SCHED-001: Cron Jobs</h4>
<p><strong>Requirement:</strong> Automated background tasks (using Laravel Scheduler)</p>
<p><strong>Scheduled Tasks:</strong></p>
<p>1. <strong>Auto-expire Private Links</strong> (Hourly)</p>
<ul>
<li>Check <code>property_links</code> where <code>expires_at < now()</code></li>
<li>Mark as expired atau soft delete</li>
</ul>
<p>2. <strong>Clean Old Notifications</strong> (Daily at 2 AM)</p>
<ul>
<li>Delete notifications older than 30 days</li>
</ul>
<p>3. <strong>Generate Daily Reports</strong> (Daily at 8 AM)</p>
<ul>
<li>Cache performance metrics untuk faster dashboard load</li>
</ul>
<p>4. <strong>Clean Activity Log</strong> (Weekly)</p>
<ul>
<li>Archive activity logs older than 90 days</li>
</ul>
<p><strong>Implementation:</strong></p>
<pre><code>// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    $schedule->command('links:expire')->hourly();
    $schedule->command('notifications:clean')->daily()->at('02:00');
    $schedule->command('reports:cache')->daily()->at('08:00');
    $schedule->command('logs:archive')->weekly();
}
</code></pre>
<p><strong>Monitoring:</strong></p>
<ul>
<li>Log setiap scheduled task execution</li>
<li>Alert jika task fail</li>
<li>Track execution time</li>
</ul>
<hr>
<h4>NFR-SCHED-002: Queue Workers</h4>
<p><strong>Requirement:</strong> Asynchronous job processing</p>
<p><strong>Queued Jobs:</strong></p>
<ul>
<li>Email notifications</li>
<li>Image optimization setelah upload</li>
<li>Export reports (Excel/PDF)</li>
<li>Activity logging (untuk heavy operations)</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>Laravel Queue with database driver (MVP)</li>
<li>Upgrade to Redis for production</li>
<li>Supervisor untuk keep queue worker running</li>
</ul>
<hr>
<h3>2.8 Data Integrity & Soft Delete</h3>
<h4>NFR-DATA-001: Soft Delete</h4>
<p><strong>Requirement:</strong> Protect important data from accidental deletion</p>
<p><strong>Tables with Soft Delete:</strong></p>
<ul>
<li><code>offices</code> - Kantor tidak bisa hard delete jika ada agen</li>
<li><code>agents</code> - Agen tidak bisa hard delete jika ada transaksi</li>
<li><code>properties</code> - Properti soft delete, bisa restore</li>
<li><code>users</code> - User soft delete, bisa restore</li>
</ul>
<p><strong>Implementation:</strong></p>
<pre><code>use Illuminate\Database\Eloquent\SoftDeletes;

class Property extends Model {
    use SoftDeletes;
}

// Query exclude soft-deleted
Property::all(); // Only non-deleted

// Query include soft-deleted
Property::withTrashed()->get();

// Restore
$property->restore();
</code></pre>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Only Admin Master can permanently delete (force delete)</li>
<li>Soft-deleted data tidak muncul di dropdown/select</li>
<li>Soft-deleted properties tidak muncul di public marketplace</li>
<li>Report tetap include soft-deleted data dengan indicator</li>
</ul>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Deleted data not showing in normal queries</li>
<li>✅ Admin panel show "Deleted" tab untuk view soft-deleted items</li>
<li>✅ Restore button available untuk Admin Master</li>
<li>✅ Cascade soft delete: Delete office → soft delete all agents</li>
</ul>
<hr>
<h2>3. Business Rules Summary</h2>
<h3>BR-001: Kantor-Agen Relationship</h3>
<ul>
<li>Satu kantor memiliki banyak agen (1:N)</li>
<li>Satu agen hanya dedicated ke 1 kantor (N:1)</li>
<li>Agen tidak bisa pindah kantor tanpa approval Admin Master</li>
</ul>
<hr>
<h3>BR-002: Properti-Agen Relationship</h3>
<ul>
<li>Satu properti owned oleh 1 agen</li>
<li>Maksimal 1 agen tambahan sebagai agen buyer</li>
<li>Total maksimal: 1 agen owner + 1 agen buyer per transaksi</li>
</ul>
<hr>
<h3>BR-003: Komisi Calculation</h3>
<ul>
<li>Default split: 70% agen, 30% kantor</li>
<li>Jika 2 agen: 35% owner + 35% buyer + 30% kantor</li>
<li>Customizable per transaksi oleh Admin</li>
<li>Komisi dihitung dari harga final (bukan listing price)</li>
</ul>
<hr>
<h3>BR-004: Property Status Flow</h3>
<ul>
<li>New listing → Available (show public)</li>
<li>Nego → Pending (masih show public)</li>
<li>Deal → Sold/Rented (hide dari public)</li>
<li>Cancel → back to Available</li>
</ul>
<hr>
<h3>BR-005: Permission Hierarchy</h3>
<p>1. Admin Master: Full access semua fitur & data</p>
<p>2. Admin Kantor: Access terbatas ke kantor & agen di bawahnya</p>
<p>3. Agen: Access terbatas ke properti & transaksi miliknya</p>
<p>4. Buyer: Read-only public listing</p>
<hr>
<h2>4. User Acceptance Test (UAT) Scenarios</h2>
<h3>UAT-001: End-to-End Listing Flow</h3>
<p><strong>Actor:</strong> Agen</p>
<p><strong>Steps:</strong></p>
<p>1. Login sebagai agen</p>
<p>2. Create listing baru (input semua field + upload foto)</p>
<p>3. Submit listing</p>
<p>4. Verify listing muncul di public page</p>
<p>5. Buyer lihat listing & kontak agen via WA</p>
<p>6. Agen update status → Pending</p>
<p>7. Admin input transaksi → status jadi Sold</p>
<p>8. Verify listing hilang dari public</p>
<p>9. Agen cek dashboard → komisi muncul sebagai Pending</p>
<p>10. Admin mark komisi sebagai Paid</p>
<p>11. Agen cek dashboard → komisi Paid</p>
<p><strong>Expected Result:</strong> ✅ All steps berhasil tanpa error</p>
<hr>
<h3>UAT-002: Multi-Agen Transaction</h3>
<p><strong>Actor:</strong> Admin Kantor</p>
<p><strong>Scenario:</strong></p>
<ul>
<li>Agen A punya listing rumah Rp 1M</li>
<li>Agen B bawa buyer untuk rumah tersebut</li>
<li>Deal di Rp 900jt (nego)</li>
</ul>
<p><strong>Steps:</strong></p>
<p>1. Login sebagai Admin Kantor</p>
<p>2. Input transaksi:</p>
<ul>
<li>Properti: Rumah Agen A</li>
<li>Agen Owner: Agen A</li>
<li>Agen Buyer: Agen B</li>
<li>Harga final: Rp 900jt</li>
</ul>
<p>3. Submit → auto-calculate komisi</p>
<p>4. Verify komisi split:</p>
<ul>
<li>Komisi total: 2% × Rp 900jt = Rp 18jt</li>
<li>Agen A: 35% × Rp 18jt = Rp 6.3jt</li>
<li>Agen B: 35% × Rp 18jt = Rp 6.3jt</li>
<li>Kantor: 30% × Rp 18jt = Rp 5.4jt</li>
</ul>
<p>5. Agen A & B cek dashboard → masing-masing lihat komisi Rp 6.3jt</p>
<p><strong>Expected Result:</strong> ✅ Komisi ter-split dengan benar</p>
<hr>
<h3>UAT-003: Permission Test</h3>
<p><strong>Actor:</strong> Multiple</p>
<p><strong>Steps:</strong></p>
<p>1. Login sebagai Agen A</p>
<p>2. Try akses list semua agen → ❌ Forbidden</p>
<p>3. Try edit properti milik Agen B → ❌ Forbidden</p>
<p>4. Try input transaksi → ❌ Forbidden</p>
<p>5. Logout, login sebagai Admin Kantor</p>
<p>6. Access list agen di kantornya → ✅ Success</p>
<p>7. Try access agen di kantor lain → ❌ Forbidden</p>
<p>8. Logout, login sebagai Admin Master</p>
<p>9. Access semua data → ✅ Success</p>
<p><strong>Expected Result:</strong> ✅ Permission enforcement work correctly</p>
<hr>
<h2>5. Change Log</h2>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Changes</th>
<th>Author</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0</td>
<td>31 Okt 2025</td>
<td>Initial BRD</td>
<td>AI Analysis System</td>
</tr>
</tbody>
</table>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Reviewed by:</strong> [Pending]  </p>
<p><strong>Approved by:</strong> [Pending]  </p>
<p><strong>Date:</strong> 31 Oktober 2025</p>
</div>

<div class="content-section page-break" id="section-2">
<h1>BAB 2: Software Requirements Specification (SRS)</h1>

<p><strong>Dokumen Analisis Sistem</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti Multi-Kantor  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Executive Summary</h2>
<h3>1.1 Gambaran Umum</h3>
<p>Hendra Prop adalah sistem manajemen properti berbasis web yang dirancang untuk mengelola multiple kantor cabang dengan agen-agen properti yang terstruktur. Sistem ini memfasilitasi manajemen listing properti, tracking performa agen, serta kalkulasi komisi otomatis.</p>
<h3>1.2 Tujuan Utama</h3>
<ul>
<li>Centralized management untuk multi-kantor properti</li>
<li>Tracking performa dan komisi agen secara transparan</li>
<li>Digitalisasi proses listing dan transaksi properti</li>
<li>Memudahkan buyer dalam mencari dan menghubungi agen</li>
</ul>
<h3>1.3 Target Pengguna</h3>
<p>1. <strong>Admin Master</strong> - Super administrator dengan akses penuh</p>
<p>2. <strong>Admin Kantor</strong> - Manager cabang yang mengelola agen di kantornya</p>
<p>3. <strong>Agen Properti</strong> - Sales yang mengelola listing dan transaksi</p>
<p>4. <strong>Buyer/Customer</strong> - Pencari properti (publik)</p>
<h3>1.4 Timeline</h3>
<ul>
<li><strong>Deadline:</strong> Maret 2026</li>
<li><strong>Development Period:</strong> 3-4 bulan (Desember 2025 - Maret 2026)</li>
<li><strong>Target:</strong> MVP (Minimum Viable Product)</li>
</ul>
<hr>
<h2>2. Latar Belakang & Masalah</h2>
<h3>2.1 Kondisi Saat Ini</h3>
<ul>
<li>Manajemen properti masih manual atau menggunakan spreadsheet</li>
<li>Sulit tracking performa agen di multiple kantor</li>
<li>Perhitungan komisi tidak transparan</li>
<li>Buyer sulit mendapat informasi terpusat</li>
</ul>
<h3>2.2 Masalah yang Harus Diselesaikan</h3>
<p>1. <strong>Fragmentasi Data</strong> - Data tersebar di berbagai kantor</p>
<p>2. <strong>Tracking Performance</strong> - Sulit mengukur produktivitas agen</p>
<p>3. <strong>Komisi Manual</strong> - Rawan error dan tidak transparan</p>
<p>4. <strong>Akses Informasi</strong> - Buyer kesulitan cari properti yang sesuai</p>
<h3>2.3 Solusi yang Diusulkan</h3>
<p>Sistem terintegrasi berbasis web dengan fitur:</p>
<ul>
<li>User management multi-level (Master, Kantor, Agen)</li>
<li>Database terpusat untuk listing properti</li>
<li>Dashboard performance real-time</li>
<li>Kalkulasi komisi otomatis</li>
<li>Public listing page untuk buyer</li>
</ul>
<hr>
<h2>3. Struktur Organisasi</h2>
<h3>3.1 Hierarki Bisnis</h3>
<pre><code>Hendra Prop (Pusat)
├── HP 1 (Kantor Cabang 1)
│   ├── Agent 1
│   ├── Agent 2
│   └── Agent 3
├── HP 2 (Kantor Cabang 2)
│   ├── Agent Z1
│   ├── Agent Z2
│   └── Agent Z3
└── HP 3 (Kantor Cabang 3)
    └── [Multiple Agents]
</code></pre>
<h3>3.2 Business Rules</h3>
<h4>Rule 1: Relasi Kantor - Agen</h4>
<ul>
<li>✅ Satu kantor bisa memiliki banyak agen (1:N)</li>
<li>✅ Satu agen hanya dedicated ke 1 kantor (N:1)</li>
<li>❌ Agen tidak bisa pindah kantor (atau butuh proses approval)</li>
</ul>
<h4>Rule 2: Relasi Properti - Agen</h4>
<ul>
<li>✅ Satu properti owned oleh 1 agen (pemilik listing)</li>
<li>✅ Maksimal ada 1 agen pembawa buyer untuk properti tersebut</li>
<li>✅ Total maksimal: 1 Agen Owner + 1 Agen Buyer per transaksi</li>
<li>⚠️ Agen buyer harus koordinasi dengan agen owner</li>
</ul>
<h4>Rule 3: Komisi</h4>
<ul>
<li>📌 <strong>Default Split:</strong> 70% untuk Agen, 30% untuk Kantor</li>
<li>📌 Khusus untuk transaksi <strong>sewa</strong></li>
<li>📌 Komisi untuk jual-beli bisa berbeda (customizable)</li>
<li>📌 Diatur manual oleh Admin Master/Kantor per transaksi</li>
</ul>
<h4>Rule 4: Akses & Permission</h4>
<ul>
<li><strong>Admin Master:</strong> Full akses ke semua kantor & agen</li>
<li><strong>Admin Kantor:</strong> Akses terbatas ke kantor & agen di bawahnya</li>
<li><strong>Agen:</strong> Akses terbatas ke properti & transaksi miliknya</li>
<li><strong>Buyer:</strong> Read-only untuk listing publik</li>
</ul>
<hr>
<h2>4. Analisis Stakeholder</h2>
<h3>4.1 Admin Master</h3>
<p><strong>Kebutuhan:</strong></p>
<ul>
<li>Manajemen kantor cabang (CRUD)</li>
<li>Manajemen agen di semua kantor</li>
<li>Monitoring performa global</li>
<li>Setting komisi dan approval transaksi</li>
<li>Dashboard overview seluruh bisnis</li>
</ul>
<p><strong>Pain Points:</strong></p>
<ul>
<li>Sulit kontrol multi-kantor secara real-time</li>
<li>Tidak ada data agregat performa</li>
<li>Perhitungan komisi manual rawan error</li>
</ul>
<p><strong>Ekspektasi:</strong></p>
<ul>
<li>Dashboard real-time untuk semua kantor</li>
<li>Laporan performa per kantor & per agen</li>
<li>Sistem komisi otomatis namun bisa di-override manual</li>
</ul>
<hr>
<h3>4.2 Admin Kantor</h3>
<p><strong>Kebutuhan:</strong></p>
<ul>
<li>Manajemen agen di kantornya</li>
<li>Input & edit properti di kantornya</li>
<li>Monitoring performa agen</li>
<li>Setting komisi untuk agen di kantornya</li>
<li>Dashboard kantor</li>
</ul>
<p><strong>Pain Points:</strong></p>
<ul>
<li>Sulit track produktivitas agen</li>
<li>Manual hitung komisi setiap bulan</li>
<li>Tidak ada history transaksi yang terstruktur</li>
</ul>
<p><strong>Ekspektasi:</strong></p>
<ul>
<li>Dashboard khusus untuk kantornya</li>
<li>Laporan performa agen</li>
<li>Export data untuk accounting</li>
</ul>
<hr>
<h3>4.3 Agen Properti</h3>
<p><strong>Kebutuhan:</strong></p>
<ul>
<li>Input & edit listing properti</li>
<li>Share listing ke buyer</li>
<li>Track komisi yang diterima</li>
<li>Dashboard personal performance</li>
<li>Contact management (buyer)</li>
</ul>
<p><strong>Pain Points:</strong></p>
<ul>
<li>Sulit track listing yang masih available</li>
<li>Tidak tahu status komisi (pending/paid)</li>
<li>Manual share listing via WA/sosmed</li>
</ul>
<p><strong>Ekspektasi:</strong></p>
<ul>
<li>Dashboard personal (total listing, omzet, komisi)</li>
<li>Notifikasi jika ada inquiry dari buyer</li>
<li>Link sharing yang mudah untuk promosi</li>
</ul>
<hr>
<h3>4.4 Buyer/Customer</h3>
<p><strong>Kebutuhan:</strong></p>
<ul>
<li>Cari properti dengan filter (lokasi, harga, tipe)</li>
<li>Lihat detail properti (foto, harga, luas)</li>
<li>Kontak agen pemilik langsung</li>
<li>Save favorit (nice to have)</li>
</ul>
<p><strong>Pain Points:</strong></p>
<ul>
<li>Informasi properti tersebar di berbagai channel</li>
<li>Harus hubungi banyak agen untuk compare</li>
<li>Tidak tahu siapa agen yang handle properti tertentu</li>
</ul>
<p><strong>Ekspektasi:</strong></p>
<ul>
<li>Platform terpusat untuk semua listing</li>
<li>Search & filter yang mudah</li>
<li>Kontak langsung ke agen via WA/phone</li>
</ul>
<hr>
<h2>5. MVP Scope Definition</h2>
<h3>5.1 Prinsip MVP: "Minimum Viable Scope Only"</h3>
<p>Hanya fitur yang <strong>BENAR-BENAR ESENSIAL</strong> untuk operasional dasar bisnis yang masuk MVP.</p>
<h3>5.2 ✅ FITUR YANG MASUK MVP (Must Have)</h3>
<h4>A. Authentication & User Management</h4>
<ul>
<li>[x] Multi-role login (Admin Master, Admin Kantor, Agen, Buyer)</li>
<li>[x] User profile management</li>
<li>[x] Role-based access control (RBAC)</li>
</ul>
<h4>B. Kantor Management</h4>
<ul>
<li>[x] CRUD Kantor (oleh Admin Master)</li>
<li>[x] Assign Admin Kantor ke kantor tertentu</li>
</ul>
<h4>C. Agen Management</h4>
<ul>
<li>[x] CRUD Agen (oleh Admin Master & Admin Kantor)</li>
<li>[x] Assign agen ke kantor (1:1 relationship)</li>
<li>[x] Status agen (Active/Inactive)</li>
</ul>
<h4>D. Property Management</h4>
<ul>
<li>[x] CRUD Properti oleh Admin Master, Admin Kantor, Agen</li>
<li>[x] Upload multiple foto properti</li>
<li>[x] Detail properti: Judul, Deskripsi, Harga, Harga/m², Luas, Alamat</li>
<li>[x] Tipe properti (Rumah, Apartemen, Tanah, Komersial)</li>
<li>[x] Status properti (Available, Pending, Sold, Rented)</li>
<li>[x] Contact info (Phone, WhatsApp)</li>
</ul>
<h4>E. Public Listing (Buyer)</h4>
<ul>
<li>[x] Browse semua properti available</li>
<li>[x] Search & Filter dasar (lokasi, harga range, tipe)</li>
<li>[x] Detail view properti</li>
<li>[x] Kontak agen via phone/WA</li>
</ul>
<h4>F. Transaction Management</h4>
<ul>
<li>[x] Input transaksi manual (oleh Admin Master/Kantor)</li>
<li>[x] Record: Properti + Agen Owner + Agen Buyer (optional) + Buyer Info</li>
<li>[x] Tipe transaksi (Jual/Sewa)</li>
<li>[x] Harga final</li>
<li>[x] Tanggal transaksi</li>
</ul>
<h4>G. Commission System</h4>
<ul>
<li>[x] Setting komisi per transaksi (customizable %)</li>
<li>[x] Split komisi: Agen vs Kantor</li>
<li>[x] Split komisi antar agen (jika ada agen buyer)</li>
<li>[x] Status komisi (Pending, Paid)</li>
</ul>
<h4>H. Performance Dashboard</h4>
<ul>
<li>[x] Dashboard Personal Agen (Total Listing, Omzet, Komisi)</li>
<li>[x] Dashboard Kantor (Aggregate agen di kantornya)</li>
<li>[x] Dashboard Master (Aggregate semua kantor)</li>
</ul>
<hr>
<h3>5.3 ❌ FITUR YANG TIDAK MASUK MVP (Phase 2)</h3>
<h4>Moderasi & Approval</h4>
<ul>
<li>[ ] Moderasi properti sebelum publish (B2)</li>
<li>[ ] Approval workflow untuk transaksi</li>
</ul>
<h4>Sharing & Marketing</h4>
<ul>
<li>[ ] Link terbatas dengan hidden detail (B4)</li>
<li>[ ] Share link dengan no-phone & detail tersembunyi</li>
<li>[ ] Social media integration</li>
</ul>
<h4>Advanced Features</h4>
<ul>
<li>[ ] Tag properti serupa (recommendation)</li>
<li>[ ] Reward system (gamification)</li>
<li>[ ] Add-on HPDM / Premiere listing</li>
<li>[ ] Performance Board Master & Kantor (agregat dashboard)</li>
</ul>
<h4>Customer Features</h4>
<ul>
<li>[ ] Buyer registration & login</li>
<li>[ ] Favorit/Wishlist untuk buyer</li>
<li>[ ] Inquiry tracking</li>
<li>[ ] Email notification otomatis</li>
</ul>
<h4>Reporting & Analytics</h4>
<ul>
<li>[ ] Export laporan ke Excel/PDF</li>
<li>[ ] Advanced analytics & charts</li>
<li>[ ] Forecasting & trend analysis</li>
</ul>
<hr>
<h2>6. Analisis Fitur per Role</h2>
<h3>6.1 Admin Master - Fungsi Utama</h3>
<table>
<thead>
<tr>
<th>Kode</th>
<th>Fungsi</th>
<th>Prioritas</th>
<th>Status MVP</th>
</tr>
</thead>
<tbody>
<tr>
<td>A1</td>
<td>Input & Edit Kantor</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>A2</td>
<td>Input & Edit Agen</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B1</td>
<td>Input & Edit Properti</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B2</td>
<td>Moderasi Properti</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>B3</td>
<td>Atur Performance Agen & Komisi</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B4</td>
<td>Buat Link Terbatas</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>B5</td>
<td>Cek Performance & Komisi</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
</tbody>
</table>
<hr>
<h3>6.2 Admin Kantor - Fungsi Utama</h3>
<table>
<thead>
<tr>
<th>Kode</th>
<th>Fungsi</th>
<th>Prioritas</th>
<th>Status MVP</th>
</tr>
</thead>
<tbody>
<tr>
<td>A2</td>
<td>Input & Edit Agen (di kantornya)</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B1</td>
<td>Input & Edit Properti</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B2</td>
<td>Moderasi Properti</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>B3</td>
<td>Atur Performance Agen & Komisi</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B4</td>
<td>Buat Link Terbatas</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>B5</td>
<td>Cek Performance & Komisi</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
</tbody>
</table>
<hr>
<h3>6.3 Agen - Fungsi Utama</h3>
<table>
<thead>
<tr>
<th>Kode</th>
<th>Fungsi</th>
<th>Prioritas</th>
<th>Status MVP</th>
</tr>
</thead>
<tbody>
<tr>
<td>B1</td>
<td>Input & Edit Properti</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>B4</td>
<td>Buat Link Terbatas</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>B5</td>
<td>Cek Performance & Komisi</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
</tbody>
</table>
<hr>
<h3>6.4 Buyer - Fungsi Utama</h3>
<table>
<thead>
<tr>
<th>Kode</th>
<th>Fungsi</th>
<th>Prioritas</th>
<th>Status MVP</th>
</tr>
</thead>
<tbody>
<tr>
<td>C1</td>
<td>Cek Properti & Kontak Agen</td>
<td>P0 - CRITICAL</td>
<td>✅ MVP</td>
</tr>
<tr>
<td>-</td>
<td>Login & Save Favorit</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
<tr>
<td>-</td>
<td>Inquiry Tracking</td>
<td>P2 - LOW</td>
<td>❌ Phase 2</td>
</tr>
</tbody>
</table>
<hr>
<h2>7. Pertanyaan Klarifikasi & Asumsi</h2>
<h3>7.1 Pertanyaan yang Sudah Terjawab ✅</h3>
<table>
<thead>
<tr>
<th>No</th>
<th>Pertanyaan</th>
<th>Jawaban</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>What is HPDM?</td>
<td>Hanya nama, skip</td>
<td>No functional impact</td>
</tr>
<tr>
<td>2</td>
<td>Relasi Agen-Kantor?</td>
<td>1 Kantor : N Agen, 1 Agen : 1 Kantor</td>
<td>Database schema</td>
</tr>
<tr>
<td>3</td>
<td>Relasi Properti-Agen?</td>
<td>1 Properti : 1 Owner + 1 Buyer (max)</td>
<td>Transaction logic</td>
</tr>
<tr>
<td>4</td>
<td>Komisi flat atau dynamic?</td>
<td>Dynamic, diisi admin</td>
<td>Commission module</td>
</tr>
</tbody>
</table>
<h3>7.2 Pertanyaan yang Masih Perlu Dijawab ⚠️</h3>
<h4>CRITICAL - Harus Dijawab Sebelum Development</h4>
<p><strong>Q1: Flow Transaksi & Status Properti</strong></p>
<ul>
<li>Apakah ada status properti: Available → Pending → Sold/Rented?</li>
<li>Ketika agen input transaksi, apakah status properti otomatis berubah?</li>
<li>Apakah properti yang sudah Sold/Rented masih ditampilkan di public listing?</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Ada 4 status: Available, Pending, Sold, Rented</li>
<li>Saat transaksi di-input, status otomatis jadi Sold/Rented</li>
<li>Properti sold/rented tidak muncul di public listing</li>
</ul>
<hr>
<p><strong>Q2: Pencatatan Transaksi</strong></p>
<ul>
<li>Siapa yang bisa input transaksi? (Admin saja atau Agen juga?)</li>
<li>Apakah ada approval workflow? (Agen input → Admin approve)</li>
<li>Bagaimana flow jika agen buyer membawa pembeli?</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Hanya Admin Master & Admin Kantor yang bisa input transaksi</li>
<li>No approval workflow (langsung final)</li>
<li>Agen buyer bisa di-tag saat input transaksi</li>
</ul>
<hr>
<p><strong>Q3: Komisi Detail</strong></p>
<ul>
<li>Komisi 70/30 untuk sewa. Bagaimana untuk jual-beli?</li>
<li>Jika ada 2 agen (owner + buyer), bagaimana split-nya?</li>
<li>Contoh: 70% dibagi 2 agen? Atau masing-masing tetap dapat 70%?</li>
<li>Apakah komisi dihitung dari harga final atau harga listing?</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Jual-beli juga pakai 70/30 (customizable)</li>
<li>Jika ada 2 agen: 70% dibagi 2 (35% each), 30% tetap ke kantor</li>
<li>Komisi dari harga final (closing price)</li>
</ul>
<hr>
<p><strong>Q4: Data Properti</strong></p>
<ul>
<li>Berapa maksimal foto per properti? (5? 10? Unlimited?)</li>
<li>Apakah perlu video/virtual tour? (Phase 2)</li>
<li>Apakah ada sertifikat/dokumen properti yang perlu di-upload?</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Max 10 foto per properti</li>
<li>Video/VR tour = Phase 2</li>
<li>Dokumen legal = Phase 2</li>
</ul>
<hr>
<h4>MEDIUM - Bisa Ditentukan Kemudian</h4>
<p><strong>Q5: Buyer Access</strong></p>
<ul>
<li>Apakah buyer perlu login untuk lihat listing? (Public = no login)</li>
<li>Apakah buyer bisa save favorit tanpa login? (Phase 2)</li>
<li>Apakah perlu tracking inquiry dari buyer? (Phase 2)</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Public access, no login required</li>
<li>Favorit & inquiry = Phase 2</li>
</ul>
<hr>
<p><strong>Q6: Search & Filter</strong></p>
<ul>
<li>Filter apa yang paling prioritas?</li>
<li>Lokasi (kota, kecamatan)</li>
<li>Harga (range)</li>
<li>Tipe (rumah, apartemen, tanah, komersial)</li>
<li>Luas (m²)</li>
<li>Status (jual/sewa)</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Filter: Lokasi, Harga Range, Tipe, Status (Jual/Sewa)</li>
<li>Advanced filter (luas, kamar, dll) = Phase 2</li>
</ul>
<hr>
<p><strong>Q7: Hosting & Infrastructure</strong></p>
<ul>
<li>Estimasi jumlah agen di tahun pertama? (10? 50? 100?)</li>
<li>Estimasi jumlah listing? (100? 1000? 10000?)</li>
<li>Apakah perlu cloud storage atau VPS storage cukup?</li>
</ul>
<p><strong>Asumsi Sementara:</strong></p>
<ul>
<li>Max 50 agen, 500 listing di tahun 1</li>
<li>VPS storage cukup untuk MVP</li>
<li>Cloud (S3) untuk production scaling</li>
</ul>
<hr>
<h2>8. Risk Analysis & Mitigation</h2>
<h3>8.1 Technical Risks</h3>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Probability</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database design error</td>
<td>Medium</td>
<td>High</td>
<td>Review ERD dengan stakeholder sebelum development</td>
</tr>
<tr>
<td>Performance issue (banyak foto)</td>
<td>Medium</td>
<td>Medium</td>
<td>Implementasi image optimization & lazy loading</td>
</tr>
<tr>
<td>Security breach (data sensitif)</td>
<td>Low</td>
<td>Critical</td>
<td>Implement standard Laravel security + encryption</td>
</tr>
<tr>
<td>Integration error (WA/Email)</td>
<td>Low</td>
<td>Low</td>
<td>Build as separate module, fail gracefully</td>
</tr>
</tbody>
</table>
<h3>8.2 Business Risks</h3>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Probability</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Komisi logic salah</td>
<td>High</td>
<td>Critical</td>
<td><strong>Manual testing</strong> dengan sample data real sebelum launch</td>
</tr>
<tr>
<td>Role permission salah</td>
<td>Medium</td>
<td>High</td>
<td>Test setiap role dengan different scenarios</td>
</tr>
<tr>
<td>User adoption rendah</td>
<td>Medium</td>
<td>Medium</td>
<td>Training & onboarding untuk admin & agen</td>
</tr>
<tr>
<td>Data migration dari sistem lama</td>
<td>High</td>
<td>Medium</td>
<td>Prepare import tool & validation</td>
</tr>
</tbody>
</table>
<h3>8.3 Timeline Risks</h3>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Probability</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scope creep (fitur tambahan)</td>
<td>High</td>
<td>High</td>
<td><strong>Strict MVP scope</strong>, tolak fitur non-esensial</td>
</tr>
<tr>
<td>Klarifikasi lambat</td>
<td>Medium</td>
<td>High</td>
<td>Set SLA untuk response: 2-3 hari max</td>
</tr>
<tr>
<td>Bug critical saat testing</td>
<td>Medium</td>
<td>Medium</td>
<td>Buffer 2 minggu untuk bug fixing</td>
</tr>
</tbody>
</table>
<ul>
<li>Development: 2.5 bulan (10 weeks)</li>
<li>Testing: 2 minggu</li>
<li>Bug fixing: 2 minggu</li>
<li><strong>Total:</strong> 3.5 bulan (Desember - Maret)</li>
</ul>
<hr>
<h2>9. Success Criteria</h2>
<h3>9.1 MVP Launch Criteria (Maret 2026)</h3>
<h4>Must Have (Go/No-Go)</h4>
<ul>
<li>✅ 3 kantor cabang sudah ter-input dengan minimal 5 agen</li>
<li>✅ Minimal 50 listing properti available</li>
<li>✅ Transaksi & komisi bisa dicatat dengan benar</li>
<li>✅ Public listing accessible & mobile responsive</li>
<li>✅ No critical bug pada core features</li>
</ul>
<h4>Should Have (Nice to Have)</h4>
<ul>
<li>✅ Performance dashboard showing real data</li>
<li>✅ Export laporan basic (Excel)</li>
<li>✅ Email notification untuk transaksi baru</li>
</ul>
<h4>Could Have (Post-Launch)</h4>
<ul>
<li>Buyer login & favorit</li>
<li>Advanced analytics</li>
<li>Mobile app (PWA)</li>
</ul>
<hr>
<h3>9.2 Key Performance Indicators (KPI)</h3>
<p><strong>Technical KPI:</strong></p>
<ul>
<li>System uptime: > 99%</li>
<li>Page load time: < 2 detik</li>
<li>Mobile responsive: 100% pages</li>
<li>Zero critical bugs after launch</li>
</ul>
<p><strong>Business KPI:</strong></p>
<ul>
<li>User adoption: > 80% agen aktif menggunakan sistem</li>
<li>Listing growth: +20 listing/bulan</li>
<li>Transaction recording: 100% transaksi tercatat di sistem</li>
<li>Commission accuracy: 100% (no dispute)</li>
</ul>
<hr>
<h2>10. Kesimpulan & Next Steps</h2>
<h3>10.1 Kesimpulan</h3>
<p>Proyek Hendra Prop adalah sistem manajemen properti multi-kantor dengan scope MVP yang <strong>realistis dan achievable</strong> dalam timeline Maret 2026. Fokus pada fitur esensial dengan prinsip "Minimum Viable Scope Only" memastikan delivery tepat waktu dengan kualitas terjaga.</p>
<h3>10.2 Next Steps</h3>
<h4>Immediate (Minggu 1-2)</h4>
<p>1. ✅ Review & approval dokumen analisis ini</p>
<p>2. ⏳ Jawab pertanyaan klarifikasi (Q1-Q7)</p>
<p>3. ⏳ Finalize database schema</p>
<p>4. ⏳ Setup project & repository</p>
<h4>Short Term (Minggu 3-4)</h4>
<p>5. ⏳ Create wireframe/mockup UI (optional tapi recommended)</p>
<p>6. ⏳ Setup development environment</p>
<p>7. ⏳ Kickoff development sprint 1</p>
<h4>Long Term (Minggu 5-14)</h4>
<p>8. ⏳ Development (10 sprints @ 1 week each)</p>
<p>9. ⏳ Testing & QA (2 weeks)</p>
<p>10. ⏳ Bug fixing & refinement (2 weeks)</p>
<p>11. ⏳ Soft launch (Maret 2026)</p>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Status:</strong> Draft - Pending Stakeholder Review</p>
</div>

<div class="content-section page-break" id="section-2">
<h1>BAB 2 (Lanjutan): SRS - User Stories</h1>

<p><strong>Dokumen User Stories & Acceptance Criteria</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Epic Overview</h2>
<h3>Epic 1: Authentication & User Management 🔐</h3>
<p>Manage users, roles, and permissions untuk Admin Master, Admin Kantor, dan Agen</p>
<h3>Epic 2: Office & Agent Management 🏢</h3>
<p>Manage kantor cabang dan agen-agen properti</p>
<h3>Epic 3: Property Management 🏠</h3>
<p>Manage listing properti dengan foto dan detail lengkap</p>
<h3>Epic 4: Public Listing 🌐</h3>
<p>Public website untuk buyer mencari dan melihat properti</p>
<h3>Epic 5: Transaction Management 💰</h3>
<p>Record transaksi jual/sewa properti</p>
<h3>Epic 6: Commission Management 💵</h3>
<p>Manage komisi agen dan kantor dengan tracking pembayaran</p>
<h3>Epic 7: Dashboard & Reports 📊</h3>
<p>Performance dashboard untuk setiap role</p>
<hr>
<h2>2. User Stories per Epic</h2>
<h3>EPIC 1: Authentication & User Management 🔐</h3>
<h4>US-AUTH-001: Login sebagai Admin Master</h4>
<p><strong>As a</strong> Super Admin  </p>
<p><strong>I want to</strong> login ke sistem dengan email dan password  </p>
<p><strong>So that</strong> saya bisa manage seluruh sistem</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Halaman login dengan form email & password</li>
<li>✅ Validasi: email format valid, password min 8 karakter</li>
<li>✅ Error message jika credentials salah</li>
<li>✅ Redirect ke dashboard setelah login berhasil</li>
<li>✅ Session active selama 24 jam</li>
<li>✅ Remember me option (7 hari)</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-AUTH-002: Login sebagai Admin Kantor</h4>
<p><strong>As a</strong> Admin Kantor  </p>
<p><strong>I want to</strong> login dan hanya lihat data kantor saya  </p>
<p><strong>So that</strong> saya bisa manage agen dan properti di kantor saya</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Login dengan role admin_kantor</li>
<li>✅ Dashboard hanya show data kantor yang di-assign</li>
<li>✅ Tidak bisa akses data kantor lain</li>
<li>✅ Bisa manage agen di kantornya</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 2  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-AUTH-003: Login sebagai Agen</h4>
<p><strong>As a</strong> Agen Properti  </p>
<p><strong>I want to</strong> login dan lihat listing & komisi saya  </p>
<p><strong>So that</strong> saya bisa track performa saya</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Login dengan role agent</li>
<li>✅ Dashboard personal show: listing, omzet, komisi</li>
<li>✅ Hanya bisa edit properti miliknya</li>
<li>✅ Tidak bisa akses properti agen lain</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 2  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-AUTH-004: Forgot Password</h4>
<p><strong>As a</strong> User  </p>
<p><strong>I want to</strong> reset password jika lupa  </p>
<p><strong>So that</strong> saya bisa login lagi</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Link "Forgot Password" di halaman login</li>
<li>✅ Form input email</li>
<li>✅ Send email dengan reset link</li>
<li>✅ Reset link valid selama 1 jam</li>
<li>✅ Form set password baru</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 2</p>
<hr>
<h3>EPIC 2: Office & Agent Management 🏢</h3>
<h4>US-OFFICE-001: Create Kantor Baru</h4>
<p><strong>As a</strong> Admin Master  </p>
<p><strong>I want to</strong> create kantor cabang baru  </p>
<p><strong>So that</strong> saya bisa expand bisnis ke kota lain</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input: nama kantor, alamat, telepon, email</li>
<li>✅ Validation: nama & telepon required</li>
<li>✅ Success notification setelah create</li>
<li>✅ Redirect ke list kantor</li>
<li>✅ New kantor muncul di dropdown</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-OFFICE-002: Edit & Delete Kantor</h4>
<p><strong>As a</strong> Admin Master  </p>
<p><strong>I want to</strong> edit atau delete kantor  </p>
<p><strong>So that</strong> saya bisa update info atau non-aktifkan kantor</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button edit di list kantor</li>
<li>✅ Form pre-filled dengan data existing</li>
<li>✅ Soft delete (status inactive)</li>
<li>✅ Confirm dialog sebelum delete</li>
<li>✅ Tidak bisa delete jika ada agen active</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 2  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-AGENT-001: Create Agen Baru</h4>
<p><strong>As a</strong> Admin Master/Admin Kantor  </p>
<p><strong>I want to</strong> create agen baru dan assign ke kantor  </p>
<p><strong>So that</strong> agen bisa mulai input listing</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input: nama, email, phone, WA, kantor</li>
<li>✅ Auto-create user account (role: agent)</li>
<li>✅ Send email dengan password default</li>
<li>✅ Agen langsung bisa login</li>
<li>✅ Admin Kantor hanya bisa assign ke kantornya</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 1</p>
<hr>
<h4>US-AGENT-002: Edit Profile Agen</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> edit profile saya (foto, bio, kontak)  </p>
<p><strong>So that</strong> buyer bisa lihat info saya dengan jelas</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form edit profile</li>
<li>✅ Upload foto profile (max 2MB)</li>
<li>✅ Edit bio, phone, WA</li>
<li>✅ Field kantor read-only (tidak bisa pindah sendiri)</li>
<li>✅ Auto-save dengan notification</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 2</p>
<hr>
<h3>EPIC 3: Property Management 🏠</h3>
<h4>US-PROP-001: Create Listing Properti</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> create listing properti baru dengan foto  </p>
<p><strong>So that</strong> properti bisa dilihat buyer di public page</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input: judul, deskripsi, tipe, harga, luas, alamat</li>
<li>✅ Upload max 10 foto (JPG/PNG, max 5MB each)</li>
<li>✅ Drag & drop foto untuk reorder</li>
<li>✅ Set cover image (foto pertama default)</li>
<li>✅ Auto-generate slug dari judul</li>
<li>✅ Auto-assign ke agen yang login</li>
<li>✅ Status default: available</li>
<li>✅ Preview before submit</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 2</p>
<hr>
<h4>US-PROP-002: Edit Listing Properti</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> edit listing saya  </p>
<p><strong>So that</strong> saya bisa update harga atau info terbaru</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button edit di list properti</li>
<li>✅ Form pre-filled dengan data existing</li>
<li>✅ Bisa add/remove foto</li>
<li>✅ Bisa change status (available → pending → sold)</li>
<li>✅ Audit trail: track perubahan harga</li>
<li>✅ Agen hanya bisa edit properti miliknya</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 2</p>
<hr>
<h4>US-PROP-003: Delete Listing</h4>
<p><strong>As a</strong> Admin Master/Admin Kantor  </p>
<p><strong>I want to</strong> delete listing yang invalid  </p>
<p><strong>So that</strong> public page hanya show properti valid</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Soft delete (bukan permanent delete)</li>
<li>✅ Confirm dialog</li>
<li>✅ Tidak bisa delete jika sudah ada transaksi</li>
<li>✅ Deleted listing tidak muncul di public</li>
<li>✅ Admin bisa restore jika perlu</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 3</p>
<hr>
<h4>US-PROP-004: Upload Foto Properti</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> upload multiple foto sekaligus  </p>
<p><strong>So that</strong> buyer bisa lihat properti dari berbagai sudut</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Upload max 10 foto per properti</li>
<li>✅ Validation: JPG/PNG only, max 5MB</li>
<li>✅ Auto-resize ke 1200x800px</li>
<li>✅ Auto-compress tanpa quality loss signifikan</li>
<li>✅ Progress bar saat upload</li>
<li>✅ Error handling jika upload gagal</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 2</p>
<hr>
<h3>EPIC 4: Public Listing 🌐</h3>
<h4>US-PUBLIC-001: Browse Listing Properti</h4>
<p><strong>As a</strong> Buyer  </p>
<p><strong>I want to</strong> lihat semua properti available  </p>
<p><strong>So that</strong> saya bisa cari properti yang sesuai</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Grid view dengan foto cover, judul, harga, lokasi</li>
<li>✅ Responsive design (mobile & desktop)</li>
<li>✅ Pagination (20 item per page)</li>
<li>✅ Sort by: harga, tanggal, views</li>
<li>✅ Show jumlah hasil: "Ditemukan 45 properti"</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 3</p>
<hr>
<h4>US-PUBLIC-002: Search & Filter Properti</h4>
<p><strong>As a</strong> Buyer  </p>
<p><strong>I want to</strong> search dan filter properti  </p>
<p><strong>So that</strong> saya bisa cari properti sesuai budget dan lokasi</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Search box (keyword: judul, deskripsi, alamat)</li>
<li>✅ Filter: tipe, status (jual/sewa), harga range, lokasi</li>
<li>✅ Multiple filter bisa digabung</li>
<li>✅ Filter tersimpan di URL (shareable)</li>
<li>✅ Button "Reset Filter"</li>
<li>✅ Real-time search (debounce 300ms)</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 3</p>
<hr>
<h4>US-PUBLIC-003: View Detail Properti</h4>
<p><strong>As a</strong> Buyer  </p>
<p><strong>I want to</strong> lihat detail lengkap properti  </p>
<p><strong>So that</strong> saya bisa evaluasi sebelum kontak agen</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ All info ditampilkan: harga, luas, kamar, alamat, deskripsi</li>
<li>✅ Photo gallery dengan lightbox</li>
<li>✅ Map lokasi (Google Maps embedded)</li>
<li>✅ Info agen: nama, foto, phone, WA</li>
<li>✅ Button: Call & WhatsApp (pre-filled message)</li>
<li>✅ Share button (copy link, WA, FB)</li>
<li>✅ View counter +1 setiap page load</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 3</p>
<hr>
<h4>US-PUBLIC-004: Kontak Agen via WhatsApp</h4>
<p><strong>As a</strong> Buyer  </p>
<p><strong>I want to</strong> kontak agen via WA dengan 1 klik  </p>
<p><strong>So that</strong> saya bisa tanya langsung tentang properti</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button "Chat via WhatsApp"</li>
<li>✅ Pre-filled message: "Halo, saya tertarik dengan [Judul Properti] - [Link]"</li>
<li>✅ Open WhatsApp web/app</li>
<li>✅ Mobile: deep link ke WA app</li>
<li>✅ Desktop: open wa.me link</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 3</p>
<hr>
<h3>EPIC 5: Transaction Management 💰</h3>
<h4>US-TRANS-001: Input Transaksi Jual/Sewa</h4>
<p><strong>As a</strong> Admin Master/Admin Kantor  </p>
<p><strong>I want to</strong> input transaksi ketika deal  </p>
<p><strong>So that</strong> komisi bisa dihitung otomatis</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Form input: properti, agen owner (auto-fill), agen buyer (optional)</li>
<li>✅ Input: buyer name, phone, harga final, tanggal</li>
<li>✅ Tipe: jual atau sewa</li>
<li>✅ Komisi %: default 2%, bisa diubah</li>
<li>✅ Auto-calculate total komisi</li>
<li>✅ Preview komisi split sebelum submit</li>
<li>✅ Submit → auto-generate commissions</li>
<li>✅ Property status auto-change ke sold/rented</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 4</p>
<hr>
<h4>US-TRANS-002: View List Transaksi</h4>
<p><strong>As a</strong> Admin/Agen  </p>
<p><strong>I want to</strong> lihat list transaksi  </p>
<p><strong>So that</strong> saya bisa track sales</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Table view: properti, agen, buyer, harga, tanggal</li>
<li>✅ Filter by: date range, kantor, agen, status</li>
<li>✅ Sort by: tanggal, harga</li>
<li>✅ Pagination</li>
<li>✅ Admin Master: all transactions</li>
<li>✅ Admin Kantor: kantornya saja</li>
<li>✅ Agen: transaksi yang involve dia</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 4</p>
<hr>
<h4>US-TRANS-003: View Detail Transaksi</h4>
<p><strong>As a</strong> Admin/Agen  </p>
<p><strong>I want to</strong> lihat detail transaksi  </p>
<p><strong>So that</strong> saya bisa review komisi breakdown</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Info properti: judul, foto, alamat</li>
<li>✅ Info agen owner & buyer (jika ada)</li>
<li>✅ Info buyer: nama, kontak</li>
<li>✅ Harga listing vs harga final</li>
<li>✅ Komisi breakdown: total, agen, kantor</li>
<li>✅ Status pembayaran komisi</li>
<li>✅ Tanggal transaksi & created</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 3  </p>
<p><strong>Sprint:</strong> 4</p>
<hr>
<h3>EPIC 6: Commission Management 💵</h3>
<h4>US-COMM-001: Auto-Calculate Komisi</h4>
<p><strong>As a</strong> Admin  </p>
<p><strong>I want to</strong> sistem auto-calculate komisi saat input transaksi  </p>
<p><strong>So that</strong> saya tidak perlu hitung manual</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Input harga final → auto-calculate total komisi (% × price)</li>
<li>✅ Scenario 1 agen: 70% agen, 30% kantor</li>
<li>✅ Scenario 2 agen: 35% + 35% agen, 30% kantor</li>
<li>✅ Preview sebelum submit</li>
<li>✅ Bisa override % manual jika perlu</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 4</p>
<hr>
<h4>US-COMM-002: Mark Komisi sebagai Paid</h4>
<p><strong>As a</strong> Admin Master/Admin Kantor  </p>
<p><strong>I want to</strong> mark komisi sebagai paid  </p>
<p><strong>So that</strong> agen tahu komisinya sudah dibayar</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Button "Mark as Paid" di list komisi</li>
<li>✅ Input: tanggal bayar, metode (transfer/cash), notes</li>
<li>✅ Status change: pending → paid</li>
<li>✅ Notifikasi ke agen (email/WA)</li>
<li>✅ Tidak bisa unmark (audit trail)</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 5</p>
<hr>
<h4>US-COMM-003: View Komisi Pending & Paid</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> lihat komisi pending dan paid  </p>
<p><strong>So that</strong> saya tahu berapa yang harus saya terima</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Tab: Pending | Paid | All</li>
<li>✅ Table: transaksi, properti, amount, tanggal, status</li>
<li>✅ Total pending di header</li>
<li>✅ Total paid (bulan ini, total)</li>
<li>✅ Filter by date range</li>
<li>✅ Export ke Excel</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 5  </p>
<p><strong>Sprint:</strong> 5</p>
<hr>
<h3>EPIC 7: Dashboard & Reports 📊</h3>
<h4>US-DASH-001: Dashboard Personal Agen</h4>
<p><strong>As a</strong> Agen  </p>
<p><strong>I want to</strong> lihat dashboard performa saya  </p>
<p><strong>So that</strong> saya tahu produktivitas saya</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Widget:</li>
<li>Total Listing Active</li>
<li>Total Omzet (sum harga final)</li>
<li>Total Komisi</li>
<li>Komisi Pending</li>
<li>Komisi Paid</li>
<li>✅ Filter by date range (bulan ini, 3 bulan, 1 tahun, custom)</li>
<li>✅ Chart: Omzet per bulan (line chart)</li>
<li>✅ Chart: Listing by status (pie chart)</li>
<li>✅ Real-time data (no caching)</li>
</ul>
<p><strong>Priority:</strong> P0 - CRITICAL  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 5</p>
<hr>
<h4>US-DASH-002: Dashboard Kantor</h4>
<p><strong>As a</strong> Admin Kantor  </p>
<p><strong>I want to</strong> lihat dashboard performa kantor saya  </p>
<p><strong>So that</strong> saya bisa monitor agen-agen saya</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Widget:</li>
<li>Total Agen Active</li>
<li>Total Listing Active</li>
<li>Total Omzet Kantor</li>
<li>Total Komisi Kantor</li>
<li>✅ Table: Performance per agen (nama, listing, omzet, komisi)</li>
<li>✅ Sort by omzet/komisi</li>
<li>✅ Chart: Omzet per agen (bar chart)</li>
<li>✅ Click agen → detail performance agen</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 6</p>
<hr>
<h4>US-DASH-003: Dashboard Master (Global)</h4>
<p><strong>As a</strong> Admin Master  </p>
<p><strong>I want to</strong> lihat dashboard global semua kantor  </p>
<p><strong>So that</strong> saya bisa monitor bisnis secara keseluruhan</p>
<p><strong>Acceptance Criteria:</strong></p>
<ul>
<li>✅ Widget:</li>
<li>Total Kantor</li>
<li>Total Agen</li>
<li>Total Listing</li>
<li>Total Omzet Global</li>
<li>Total Komisi</li>
<li>✅ Table: Performance per kantor (nama, agen, listing, omzet)</li>
<li>✅ Chart: Omzet per kantor (bar chart)</li>
<li>✅ Chart: Trend omzet (line chart)</li>
<li>✅ Click kantor → detail performance kantor</li>
</ul>
<p><strong>Priority:</strong> P1 - HIGH  </p>
<p><strong>Story Points:</strong> 8  </p>
<p><strong>Sprint:</strong> 6</p>
<hr>
<h2>3. User Story Summary per Sprint</h2>
<h3>Sprint 1 (Week 1-2): Foundation 🏗️</h3>
<p><strong>Goal:</strong> Setup authentication & basic CRUD</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-AUTH-001</td>
<td>Login Admin Master</td>
<td>3</td>
<td>P0</td>
</tr>
<tr>
<td>US-AUTH-002</td>
<td>Login Admin Kantor</td>
<td>2</td>
<td>P0</td>
</tr>
<tr>
<td>US-AUTH-003</td>
<td>Login Agen</td>
<td>2</td>
<td>P0</td>
</tr>
<tr>
<td>US-OFFICE-001</td>
<td>Create Kantor</td>
<td>3</td>
<td>P0</td>
</tr>
<tr>
<td>US-OFFICE-002</td>
<td>Edit & Delete Kantor</td>
<td>2</td>
<td>P0</td>
</tr>
<tr>
<td>US-AGENT-001</td>
<td>Create Agen</td>
<td>5</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 20</p>
<hr>
<h3>Sprint 2 (Week 3-4): Property Management 🏠</h3>
<p><strong>Goal:</strong> CRUD Properti dengan foto upload</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-AUTH-004</td>
<td>Forgot Password</td>
<td>5</td>
<td>P1</td>
</tr>
<tr>
<td>US-AGENT-002</td>
<td>Edit Profile Agen</td>
<td>3</td>
<td>P1</td>
</tr>
<tr>
<td>US-PROP-001</td>
<td>Create Listing</td>
<td>8</td>
<td>P0</td>
</tr>
<tr>
<td>US-PROP-002</td>
<td>Edit Listing</td>
<td>5</td>
<td>P0</td>
</tr>
<tr>
<td>US-PROP-004</td>
<td>Upload Foto</td>
<td>5</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 25</p>
<hr>
<h3>Sprint 3 (Week 5-6): Public Listing 🌐</h3>
<p><strong>Goal:</strong> Public website untuk buyer</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-PROP-003</td>
<td>Delete Listing</td>
<td>3</td>
<td>P1</td>
</tr>
<tr>
<td>US-PUBLIC-001</td>
<td>Browse Listing</td>
<td>5</td>
<td>P0</td>
</tr>
<tr>
<td>US-PUBLIC-002</td>
<td>Search & Filter</td>
<td>8</td>
<td>P0</td>
</tr>
<tr>
<td>US-PUBLIC-003</td>
<td>View Detail</td>
<td>8</td>
<td>P0</td>
</tr>
<tr>
<td>US-PUBLIC-004</td>
<td>Kontak Agen WA</td>
<td>3</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 25</p>
<hr>
<h3>Sprint 4 (Week 7-8): Transaction & Commission 💰</h3>
<p><strong>Goal:</strong> Input transaksi & auto-calculate komisi</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-TRANS-001</td>
<td>Input Transaksi</td>
<td>8</td>
<td>P0</td>
</tr>
<tr>
<td>US-TRANS-002</td>
<td>View List Transaksi</td>
<td>5</td>
<td>P1</td>
</tr>
<tr>
<td>US-TRANS-003</td>
<td>View Detail Transaksi</td>
<td>3</td>
<td>P1</td>
</tr>
<tr>
<td>US-COMM-001</td>
<td>Auto-Calculate Komisi</td>
<td>8</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 25</p>
<hr>
<h3>Sprint 5 (Week 9-10): Commission Management & Dashboard 💵📊</h3>
<p><strong>Goal:</strong> Mark komisi paid & dashboard personal</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-COMM-002</td>
<td>Mark Komisi Paid</td>
<td>5</td>
<td>P0</td>
</tr>
<tr>
<td>US-COMM-003</td>
<td>View Komisi Pending/Paid</td>
<td>5</td>
<td>P1</td>
</tr>
<tr>
<td>US-DASH-001</td>
<td>Dashboard Personal Agen</td>
<td>8</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 20</p>
<hr>
<h3>Sprint 6 (Week 11-12): Dashboard Kantor & Master 📊</h3>
<p><strong>Goal:</strong> Dashboard agregat & final polish</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-DASH-002</td>
<td>Dashboard Kantor</td>
<td>8</td>
<td>P1</td>
</tr>
<tr>
<td>US-DASH-003</td>
<td>Dashboard Master</td>
<td>8</td>
<td>P1</td>
</tr>
<tr>
<td>-</td>
<td>Bug Fixing & Polish</td>
<td>10</td>
<td>P0</td>
</tr>
</tbody>
</table>
<p><strong>Velocity Target:</strong> 25</p>
<hr>
<h2>4. Total Summary</h2>
<p><strong>Total User Stories:</strong> 26  </p>
<p><strong>Total Story Points:</strong> 138  </p>
<p><strong>Average Velocity:</strong> 23 points/sprint  </p>
<p><strong>Total Sprints:</strong> 6 (12 weeks)  </p>
<p><strong>Estimated Completion:</strong> End of February 2026  </p>
<p><strong>Buffer for Testing:</strong> 2 weeks  </p>
<p><strong>Target Launch:</strong> Maret 2026 ✅</p>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0</p>
</div>

<div class="content-section page-break" id="section-3">
<h1>BAB 3: Entity Relationship Diagram (ERD)</h1>

<p><strong>Dokumen Database Design & Schema</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Database Overview</h2>
<h3>1.1 Database Information</h3>
<ul>
<li><strong>Type:</strong> Relational Database</li>
<li><strong>DBMS:</strong> MySQL 8.0+ / PostgreSQL 15+</li>
<li><strong>Charset:</strong> utf8mb4_unicode_ci</li>
<li><strong>Engine:</strong> InnoDB (untuk transactions & foreign keys)</li>
<li><strong>Collation:</strong> utf8mb4_unicode_ci</li>
</ul>
<h3>1.2 Naming Conventions</h3>
<ul>
<li><strong>Tables:</strong> plural, snake_case (e.g., <code>properties</code>, <code>property_photos</code>)</li>
<li><strong>Columns:</strong> snake_case (e.g., <code>created_at</code>, <code>agent_id</code>)</li>
<li><strong>Primary Keys:</strong> <code>id</code> (BIGINT UNSIGNED AUTO_INCREMENT)</li>
<li><strong>Foreign Keys:</strong> <code>{table}_id</code> (e.g., <code>agent_id</code>, <code>office_id</code>)</li>
<li><strong>Indexes:</strong> <code>idx_{column}</code> atau <code>idx_{purpose}</code></li>
<li><strong>Unique Indexes:</strong> <code>unique_{column}</code></li>
</ul>
<hr>
<h2>2. Complete ERD (Entity Relationship Diagram)</h2>
<pre><code>                    ┌─────────────────────┐
                    │       USERS         │
                    ├─────────────────────┤
                    │ PK: id              │
                    │     name            │
                    │     email (UNIQUE)  │
                    │     password        │
                    │     role (ENUM)     │
                    │     phone           │
                    │     avatar          │
                    │     is_active       │
                    │     created_at      │
                    └──────┬──────────────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          │ 1:1            │                │ N:M
          │                │                │
          ▼                │                ▼
┌──────────────────┐       │      ┌──────────────────┐
│     AGENTS       │       │      │  OFFICE_ADMINS   │
├──────────────────┤       │      │  (Pivot Table)   │
│ PK: id           │       │      ├──────────────────┤
│ FK: user_id      │       │      │ PK: id           │
│ FK: office_id    │       │      │ FK: user_id      │
│     phone        │       │      │ FK: office_id    │
│     whatsapp     │       │      └────────┬─────────┘
│     bio          │       │               │
│     status       │       │               │
│     created_at   │       │               │
└─────┬────────────┘       │               │
      │                    │               │
      │ N:1                │ 1:N           │ N:1
      │                    │               │
      ▼                    ▼               ▼
┌─────────────────────────────────────────────────┐
│                   OFFICES                       │
├─────────────────────────────────────────────────┤
│ PK: id                                          │
│     name                                        │
│     address                                     │
│     phone                                       │
│     email                                       │
│     is_active                                   │
│     created_at                                  │
└─────────────────────────────────────────────────┘


      ┌──────────────────┐
      │     AGENTS       │ (from above)
      └─────┬────────────┘
            │
            │ 1:N (owner)
            │
            ▼
┌────────────────────────────────────┐
│          PROPERTIES                │
├────────────────────────────────────┤
│ PK: id                             │
│ FK: agent_id                       │
│     slug (UNIQUE)                  │
│     title                          │
│     description (TEXT)             │
│     type (ENUM)                    │
│     listing_type (ENUM)            │
│     price (DECIMAL)                │
│     price_per_sqm (DECIMAL)        │
│     land_area (DECIMAL)            │
│     building_area (DECIMAL)        │
│     bedrooms (INT)                 │
│     bathrooms (INT)                │
│     address (TEXT)                 │
│     city                           │
│     province                       │
│     latitude (DECIMAL)             │
│     longitude (DECIMAL)            │
│     certificate_type               │
│     status (ENUM)                  │
│     approval_status (ENUM)         │
│     submitted_at (DATETIME)        │
│     reviewed_by (user_id)          │
│     reviewed_at (DATETIME)         │
│     revision_notes (TEXT)          │
│     is_featured (BOOLEAN)          │
│     is_public (BOOLEAN)            │
│     published_at (DATETIME)        │
│     views_count (INT)              │
│     created_at                     │
│     deleted_at (DATETIME)          │
└─────┬──────────────────────────────┘
      │
      │ 1:N
      │
      ▼
┌────────────────────────────┐
│    PROPERTY_PHOTOS         │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_id            │
│     photo_url              │
│     order_number           │
│     is_cover (BOOLEAN)     │
│     created_at             │
└────────────────────────────┘

      │ (from properties)
      │ 1:N
      ▼
┌────────────────────────────┐
│    PROPERTY_LINKS          │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_id            │
│ FK: created_by (user_id)   │
│     token (UNIQUE)         │
│     expires_at (DATETIME)  │
│     is_used (BOOLEAN)      │
│     access_count (INT)     │
│     created_at             │
└────────────────────────────┘

      │ (from property_links)
      │ 1:N
      ▼
┌────────────────────────────┐
│   PROPERTY_VISITORS        │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_link_id       │
│ FK: property_id            │
│     visitor_name           │
│     visitor_email          │
│     visitor_phone          │
│     visitor_whatsapp       │
│     interest_level (ENUM)  │
│     message (TEXT)         │
│     visited_at (DATETIME)  │
│     ip_address             │
│     created_at             │
└────────────────────────────┘


┌────────────────────────────────────┐
│          PROPERTIES                │ (from above)
└─────┬──────────────────────────────┘
      │
      │ 1:1 (per transaction)
      │
      ▼
┌────────────────────────────────────────────┐
│              TRANSACTIONS                  │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: property_id                            │
│ FK: agent_owner_id (→ agents.id)           │
│ FK: agent_buyer_id (→ agents.id, NULLABLE) │
│     buyer_name                             │
│     buyer_phone                            │
│     buyer_email                            │
│     transaction_type (ENUM)                │
│     final_price (DECIMAL)                  │
│     commission_percentage (DECIMAL)        │
│     transaction_date (DATE)                │
│     status (ENUM)                          │
│     notes (TEXT)                           │
│     created_at                             │
└─────┬──────────────────────────────────────┘
      │
      │ 1:N
      │
      ▼
┌────────────────────────────────────────────┐
│              COMMISSIONS                   │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: transaction_id                         │
│ FK: agent_id (NULLABLE)                    │
│ FK: office_id (NULLABLE)                   │
│     amount (DECIMAL)                       │
│     percentage (DECIMAL)                   │
│     type (ENUM)                            │
│     status (ENUM)                          │
│     paid_date (DATE)                       │
│     payment_method                         │
│     notes (TEXT)                           │
│     created_at                             │
└────────────────────────────────────────────┘

┌────────────────────────────────────────────┐
│              ACTIVITY_LOG                  │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: causer_id (user_id)                    │
│     log_name, description                  │
│     subject_type, subject_id               │
│     properties (JSON)                      │
│     created_at                             │
└────────────────────────────────────────────┘
</code></pre>
<hr>
<h2>3. Detailed Table Schemas</h2>
<h3>3.1 Authentication & Users</h3>
<h4>Table: `users`</h4>
<p><strong>Purpose:</strong> Store all user accounts (Admin Master, Admin Kantor, Agen, Buyer)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Full name</td>
</tr>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>UNIQUE, NOT NULL</td>
<td>Login email</td>
</tr>
<tr>
<td><code>email_verified_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Email verification time</td>
</tr>
<tr>
<td><code>password</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Hashed password (bcrypt)</td>
</tr>
<tr>
<td><code>role</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>admin_master, admin_kantor, agent, buyer</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Phone number</td>
</tr>
<tr>
<td><code>avatar</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Avatar image path</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Active status</td>
</tr>
<tr>
<td><code>remember_token</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>Remember me token</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation time</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_email (email)</code></li>
<li><code>INDEX idx_role (role)</code></li>
<li><code>INDEX idx_is_active (is_active)</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>hasOne(Agent)</code> - untuk user dengan role agent</li>
<li><code>belongsToMany(Office)</code> - via office_admins untuk admin kantor</li>
</ul>
<hr>
<h4>Table: `password_reset_tokens`</h4>
<p><strong>Purpose:</strong> Store password reset tokens (Laravel default)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>PK</td>
<td>Email address</td>
</tr>
<tr>
<td><code>token</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Reset token</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Token creation time</td>
</tr>
</tbody>
</table>
<h4>Table: `sessions`</h4>
<p><strong>Purpose:</strong> Store user sessions (Laravel default)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>VARCHAR(255)</td>
<td>PK</td>
<td>Session ID</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, INDEX</td>
<td>User ID</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>VARCHAR(45)</td>
<td>NULLABLE</td>
<td>IP address</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>User agent</td>
</tr>
<tr>
<td><code>payload</code></td>
<td>LONGTEXT</td>
<td>NOT NULL</td>
<td>Session data</td>
</tr>
<tr>
<td><code>last_activity</code></td>
<td>INT</td>
<td>INDEX</td>
<td>Last activity timestamp</td>
</tr>
</tbody>
</table>
<h3>3.2 Organization Structure</h3>
<h4>Table: `offices`</h4>
<p><strong>Purpose:</strong> Store office/branch information</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Office name</td>
</tr>
<tr>
<td><code>address</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full address</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Office phone</td>
</tr>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Office email</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Active status</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_is_active (is_active)</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>hasMany(Agent)</code> - satu kantor punya banyak agen</li>
<li><code>belongsToMany(User)</code> - via office_admins</li>
<li><code>hasMany(Commission)</code> - komisi kantor</li>
</ul>
<hr>
<h4>Table: `office_admins`</h4>
<p><strong>Purpose:</strong> Pivot table untuk assign Admin Kantor ke Office</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → users.id</td>
<td>Admin Kantor user ID</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → offices.id</td>
<td>Office ID</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Assignment time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_user_office (user_id, office_id)</code></li>
<li><code>INDEX idx_user (user_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE CASCADE</code></li>
</ul>
<hr>
<h4>Table: `agents`</h4>
<p><strong>Purpose:</strong> Store agent profiles (linked to users table)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>UNIQUE, FK → users.id</td>
<td>User account</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → offices.id</td>
<td>Office affiliation</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Contact phone</td>
</tr>
<tr>
<td><code>whatsapp</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>WhatsApp number</td>
</tr>
<tr>
<td><code>bio</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Agent bio/description</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'active'</td>
<td>active, inactive</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_user (user_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
<li><code>INDEX idx_status (status)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(User)</code> - agent punya user account</li>
<li><code>belongsTo(Office)</code> - agent belong to satu kantor</li>
<li><code>hasMany(Property)</code> - agent punya banyak listing</li>
<li><code>hasMany(Transaction as owner)</code> - transaksi sebagai pemilik</li>
<li><code>hasMany(Transaction as buyer)</code> - transaksi sebagai pembawa buyer</li>
<li><code>hasMany(Commission)</code> - komisi agen</li>
</ul>
<hr>
<h3>3.3 Property Management</h3>
<h4>Table: `properties`</h4>
<p><strong>Purpose:</strong> Store property listings</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → agents.id</td>
<td>Property owner (agent)</td>
</tr>
<tr>
<td><code>slug</code></td>
<td>VARCHAR(255)</td>
<td>UNIQUE, NOT NULL</td>
<td>URL-friendly slug</td>
</tr>
<tr>
<td><code>title</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Property title</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full description</td>
</tr>
<tr>
<td><code>type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>house, apartment, land, commercial</td>
</tr>
<tr>
<td><code>listing_type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>sale, rent, both</td>
</tr>
<tr>
<td><code>price</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Listing price (IDR)</td>
</tr>
<tr>
<td><code>price_per_sqm</code></td>
<td>DECIMAL(15,2)</td>
<td>NULLABLE</td>
<td>Price per m²</td>
</tr>
<tr>
<td><code>land_area</code></td>
<td>DECIMAL(10,2)</td>
<td>NULLABLE</td>
<td>Land area (m²)</td>
</tr>
<tr>
<td><code>building_area</code></td>
<td>DECIMAL(10,2)</td>
<td>NULLABLE</td>
<td>Building area (m²)</td>
</tr>
<tr>
<td><code>bedrooms</code></td>
<td>INT UNSIGNED</td>
<td>NULLABLE</td>
<td>Number of bedrooms</td>
</tr>
<tr>
<td><code>bathrooms</code></td>
<td>INT UNSIGNED</td>
<td>NULLABLE</td>
<td>Number of bathrooms</td>
</tr>
<tr>
<td><code>address</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full address</td>
</tr>
<tr>
<td><code>city</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>City/Kabupaten</td>
</tr>
<tr>
<td><code>province</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>Province</td>
</tr>
<tr>
<td><code>latitude</code></td>
<td>DECIMAL(10,8)</td>
<td>NULLABLE</td>
<td>GPS latitude</td>
</tr>
<tr>
<td><code>longitude</code></td>
<td>DECIMAL(11,8)</td>
<td>NULLABLE</td>
<td>GPS longitude</td>
</tr>
<tr>
<td><code>certificate_type</code></td>
<td>VARCHAR(50)</td>
<td>NULLABLE</td>
<td>SHM, HGB, dll</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'available'</td>
<td>available, pending, sold, rented</td>
</tr>
<tr>
<td><code>approval_status</code></td>
<td>ENUM</td>
<td>DEFAULT 'draft'</td>
<td>draft, pending, published, declined, need_revision</td>
</tr>
<tr>
<td><code>submitted_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>When agent submitted for review</td>
</tr>
<tr>
<td><code>reviewed_by</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>FK to users (Admin Kantor)</td>
</tr>
<tr>
<td><code>reviewed_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>When admin reviewed</td>
</tr>
<tr>
<td><code>revision_notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Notes from admin for revision</td>
</tr>
<tr>
<td><code>is_featured</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Featured listing</td>
</tr>
<tr>
<td><code>is_public</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Show in public marketplace</td>
</tr>
<tr>
<td><code>published_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Publication timestamp</td>
</tr>
<tr>
<td><code>views_count</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>View counter</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
<tr>
<td><code>deleted_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Soft delete timestamp</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_slug (slug)</code></li>
<li><code>INDEX idx_agent (agent_id)</code></li>
<li><code>INDEX idx_type (type)</code></li>
<li><code>INDEX idx_listing_type (listing_type)</code></li>
<li><code>INDEX idx_status (status)</code></li>
<li><code>INDEX idx_approval_status (approval_status)</code></li>
<li><code>INDEX idx_reviewed_by (reviewed_by)</code></li>
<li><code>INDEX idx_city (city)</code></li>
<li><code>INDEX idx_price (price)</code></li>
<li><code>INDEX idx_is_public (is_public)</code></li>
<li><code>INDEX idx_published_at (published_at)</code></li>
<li><code>INDEX idx_created_at (created_at)</code></li>
<li><code>INDEX idx_deleted_at (deleted_at)</code></li>
<li><code>FULLTEXT idx_search (title, description, address)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Agent)</code> - property dimiliki agent</li>
<li><code>hasMany(PropertyPhoto)</code> - property punya banyak foto</li>
<li><code>hasMany(PropertyLink)</code> - property bisa punya banyak private links</li>
<li><code>hasOne(Transaction)</code> - property punya max 1 transaksi</li>
</ul>
<p><strong>Soft Delete:</strong></p>
<ul>
<li>Uses Laravel's <code>SoftDeletes</code> trait</li>
<li>Deleted properties tidak muncul di query default</li>
<li>Admin Master bisa restore jika diperlukan</li>
</ul>
<hr>
<h4>Table: `property_photos`</h4>
<p><strong>Purpose:</strong> Store property photos/images</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference</td>
</tr>
<tr>
<td><code>photo_url</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>File path/URL</td>
</tr>
<tr>
<td><code>order_number</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>Display order</td>
</tr>
<tr>
<td><code>is_cover</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Cover image flag</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Upload time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_order (order_number)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - foto belong to property</li>
</ul>
<hr>
<h4>Table: `property_links`</h4>
<p><strong>Purpose:</strong> Store tokenized private links for exclusive property viewing</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → users.id</td>
<td>User who created the link</td>
</tr>
<tr>
<td><code>token</code></td>
<td>VARCHAR(64)</td>
<td>UNIQUE, NOT NULL</td>
<td>Random access token</td>
</tr>
<tr>
<td><code>expires_at</code></td>
<td>TIMESTAMP</td>
<td>NOT NULL</td>
<td>Link expiration time</td>
</tr>
<tr>
<td><code>is_used</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Single-use flag</td>
</tr>
<tr>
<td><code>accessed_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>First access timestamp</td>
</tr>
<tr>
<td><code>access_count</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>Number of times accessed</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Link creation time</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_token (token)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_created_by (created_by)</code></li>
<li><code>INDEX idx_expires_at (expires_at)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - link untuk property tertentu</li>
<li><code>belongsTo(User as creator)</code> - user yang generate link</li>
<li><code>hasMany(PropertyVisitor)</code> - link bisa punya banyak visitor</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Check if link is valid
public function isValid(): bool {
    return $this->expires_at > now() 
        && (!$this->is_used || $this->access_count == 0);
}

// Generate random token
public static function generateToken(): string {
    return Str::random(64);
}
</code></pre>
<hr>
<h4>Table: `property_visitors`</h4>
<p><strong>Purpose:</strong> Store visitor information from private link access (lead capture)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_link_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → property_links.id</td>
<td>Link yang diakses</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference (denormalized)</td>
</tr>
<tr>
<td><code>visitor_name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Visitor full name</td>
</tr>
<tr>
<td><code>visitor_email</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Visitor email</td>
</tr>
<tr>
<td><code>visitor_phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Visitor phone</td>
</tr>
<tr>
<td><code>visitor_whatsapp</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>WhatsApp number</td>
</tr>
<tr>
<td><code>interest_level</code></td>
<td>ENUM</td>
<td>DEFAULT 'medium'</td>
<td>low, medium, high, very_high</td>
</tr>
<tr>
<td><code>message</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Visitor's message/notes</td>
</tr>
<tr>
<td><code>visited_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>When visitor accessed</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>VARCHAR(45)</td>
<td>NULLABLE</td>
<td>Visitor IP (IPv4/IPv6)</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Browser user agent</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property_link (property_link_id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_visitor_email (visitor_email)</code></li>
<li><code>INDEX idx_visited_at (visited_at)</code></li>
<li><code>INDEX idx_interest_level (interest_level)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_link_id) REFERENCES property_links(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(PropertyLink)</code> - visitor dari link tertentu</li>
<li><code>belongsTo(Property)</code> - visitor tertarik ke property tertentu</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-notify agent when high interest visitor
PropertyVisitor::created(function ($visitor) {
    if (in_array($visitor->interest_level, ['high', 'very_high'])) {
        $visitor->property->agent->notify(
            new HighInterestLeadNotification($visitor)
        );
    }
});
</code></pre>
<hr>
<h3>3.4 Transactions & Commissions</h3>
<h4>Table: `transactions`</h4>
<p><strong>Purpose:</strong> Store property transactions (sale/rent)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property sold/rented</td>
</tr>
<tr>
<td><code>agent_owner_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → agents.id</td>
<td>Property owner agent</td>
</tr>
<tr>
<td><code>agent_buyer_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → agents.id</td>
<td>Buyer's agent (optional)</td>
</tr>
<tr>
<td><code>buyer_name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Buyer full name</td>
</tr>
<tr>
<td><code>buyer_phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Buyer contact</td>
</tr>
<tr>
<td><code>buyer_email</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Buyer email</td>
</tr>
<tr>
<td><code>transaction_type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>sale, rent</td>
</tr>
<tr>
<td><code>final_price</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Closing price (IDR)</td>
</tr>
<tr>
<td><code>commission_percentage</code></td>
<td>DECIMAL(5,2)</td>
<td>DEFAULT 2.00</td>
<td>Commission % (e.g., 2%)</td>
</tr>
<tr>
<td><code>transaction_date</code></td>
<td>DATE</td>
<td>NOT NULL</td>
<td>Transaction date</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'completed'</td>
<td>pending, completed, cancelled</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Additional notes</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_agent_owner (agent_owner_id)</code></li>
<li><code>INDEX idx_agent_buyer (agent_buyer_id)</code></li>
<li><code>INDEX idx_transaction_date (transaction_date)</code></li>
<li><code>INDEX idx_status (status)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (agent_owner_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (agent_buyer_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - transaction untuk property tertentu</li>
<li><code>belongsTo(Agent as agentOwner)</code> - agen pemilik</li>
<li><code>belongsTo(Agent as agentBuyer)</code> - agen pembawa buyer (optional)</li>
<li><code>hasMany(Commission)</code> - transaction generate multiple commissions</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-update property status when transaction created
Transaction::creating(function ($transaction) {
    $property = $transaction->property;
    
    if ($transaction->transaction_type === 'sale') {
        $property->status = 'sold';
    } else {
        $property->status = 'rented';
    }
    
    $property->save();
});
</code></pre>
<hr>
<h4>Table: `commissions`</h4>
<p><strong>Purpose:</strong> Store commission records for agents and offices</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>transaction_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → transactions.id</td>
<td>Related transaction</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → agents.id</td>
<td>Agent (if applicable)</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → offices.id</td>
<td>Office (if applicable)</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Commission amount (IDR)</td>
</tr>
<tr>
<td><code>percentage</code></td>
<td>DECIMAL(5,2)</td>
<td>NOT NULL</td>
<td>Percentage from total</td>
</tr>
<tr>
<td><code>type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>agent_owner, agent_buyer, office</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'pending'</td>
<td>pending, paid, cancelled</td>
</tr>
<tr>
<td><code>paid_date</code></td>
<td>DATE</td>
<td>NULLABLE</td>
<td>Payment date</td>
</tr>
<tr>
<td><code>payment_method</code></td>
<td>VARCHAR(50)</td>
<td>NULLABLE</td>
<td>Transfer, Cash, etc</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Payment notes</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_transaction (transaction_id)</code></li>
<li><code>INDEX idx_agent (agent_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
<li><code>INDEX idx_status (status)</code></li>
<li><code>INDEX idx_paid_date (paid_date)</code></li>
<li><code>INDEX idx_type (type)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (transaction_id) REFERENCES transactions(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Transaction)</code> - commission dari transaction</li>
<li><code>belongsTo(Agent)</code> - agent commission</li>
<li><code>belongsTo(Office)</code> - office commission</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-generate commissions when transaction created
Transaction::created(function ($transaction) {
    $commissions = CommissionService::calculate($transaction);
    
    foreach ($commissions as $commission) {
        Commission::create([
            'transaction_id' => $transaction->id,
            'agent_id' => $commission['agent_id'] ?? null,
            'office_id' => $commission['office_id'] ?? null,
            'amount' => $commission['amount'],
            'percentage' => $commission['percentage'],
            'type' => $commission['type'],
            'status' => 'pending',
        ]);
    }
});
</code></pre>
<hr>
<h2>4. Enum Values</h2>
<h3>4.1 user.role</h3>
<pre><code>enum UserRole: string {
    case ADMIN_MASTER = 'admin_master';
    case ADMIN_KANTOR = 'admin_kantor';
    case AGENT = 'agent';
    case BUYER = 'buyer';
}
</code></pre>
<h3>4.2 property.type</h3>
<pre><code>enum PropertyType: string {
    case HOUSE = 'house';         // Rumah
    case APARTMENT = 'apartment';  // Apartemen
    case LAND = 'land';            // Tanah
    case COMMERCIAL = 'commercial'; // Komersial
}
</code></pre>
<h3>4.3 property.listing_type</h3>
<pre><code>enum ListingType: string {
    case SALE = 'sale';  // Dijual
    case RENT = 'rent';  // Disewa
    case BOTH = 'both';  // Dijual & Disewa
}
</code></pre>
<h3>4.4 property.status</h3>
<pre><code>enum PropertyStatus: string {
    case AVAILABLE = 'available'; // Tersedia
    case PENDING = 'pending';     // Dalam nego
    case SOLD = 'sold';           // Terjual
    case RENTED = 'rented';       // Tersewa
}
</code></pre>
<h3>4.5 property.approval_status</h3>
<pre><code>enum PropertyApprovalStatus: string {
    case DRAFT = 'draft';                   // Belum disubmit, agent masih edit
    case PENDING = 'pending';               // Sudah disubmit, menunggu review
    case PUBLISHED = 'published';           // Approved, bisa dilihat publik
    case DECLINED = 'declined';             // Rejected permanently
    case NEED_REVISION = 'need_revision';   // Perlu diperbaiki agent
}
</code></pre>
<p><strong>Business Rules:</strong></p>
<ul>
<li>DRAFT → agent submit → PENDING</li>
<li>PENDING → admin approve → PUBLISHED</li>
<li>PENDING → admin decline → DECLINED</li>
<li>PENDING → admin request revision → NEED_REVISION</li>
<li>NEED_REVISION → agent perbaiki & resubmit → PENDING</li>
<li>Only PUBLISHED properties dapat dilihat di public marketplace</li>
<li>Property dengan is_public=false tetap bisa generate private link</li>
</ul>
<h3>4.6 property_visitor.interest_level</h3>
<pre><code>enum VisitorInterestLevel: string {
    case LOW = 'low';               // Hanya lihat-lihat
    case MEDIUM = 'medium';         // Cukup tertarik
    case HIGH = 'high';             // Sangat tertarik
    case VERY_HIGH = 'very_high';   // Siap beli/nego
}
</code></pre>
<p><strong>Business Logic:</strong></p>
<ul>
<li>Agent akan dapat notifikasi untuk HIGH dan VERY_HIGH interest</li>
<li>Visitor dengan VERY_HIGH prioritas untuk di-follow up</li>
</ul>
<h3>4.7 transaction.transaction_type</h3>
<pre><code>enum TransactionType: string {
    case SALE = 'sale'; // Jual
    case RENT = 'rent'; // Sewa
}
</code></pre>
<h3>4.8 transaction.status</h3>
<pre><code>enum TransactionStatus: string {
    case PENDING = 'pending';
    case COMPLETED = 'completed';
    case CANCELLED = 'cancelled';
}
</code></pre>
<h3>4.9 commission.type</h3>
<pre><code>enum CommissionType: string {
    case AGENT_OWNER = 'agent_owner';
    case AGENT_BUYER = 'agent_buyer';
    case OFFICE = 'office';
}
</code></pre>
<h3>4.10 commission.status</h3>
<pre><code>enum CommissionStatus: string {
    case PENDING = 'pending';
    case PAID = 'paid';
    case CANCELLED = 'cancelled';
}
</code></pre>
<hr>
<h2>4.11 Additional Tables</h2>
<h3>Table: `activity_log`</h3>
<p><strong>Purpose:</strong> Store audit trail for all important actions (using spatie/laravel-activitylog)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>log_name</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Log category</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Action description</td>
</tr>
<tr>
<td><code>subject_type</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Model class name</td>
</tr>
<tr>
<td><code>subject_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>Model ID</td>
</tr>
<tr>
<td><code>causer_type</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>User model class</td>
</tr>
<tr>
<td><code>causer_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>User ID who caused</td>
</tr>
<tr>
<td><code>properties</code></td>
<td>JSON</td>
<td>NULLABLE</td>
<td>Old & new values</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Action timestamp</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_subject (subject_type, subject_id)</code></li>
<li><code>INDEX idx_causer (causer_type, causer_id)</code></li>
<li><code>INDEX idx_log_name (log_name)</code></li>
<li><code>INDEX idx_created_at (created_at)</code></li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Track siapa yang create/update/delete properti</li>
<li>Track perubahan komisi</li>
<li>Track perubahan harga jual</li>
<li>Track approval/rejection</li>
<li>Track login/logout activity</li>
</ul>
<p><strong>Example Log:</strong></p>
<pre><code>// Automatic logging with spatie/laravel-activitylog
activity()
    ->performedOn($property)
    ->causedBy($user)
    ->withProperties([
        'old' => ['price' => 1000000000],
        'new' => ['price' => 900000000]
    ])
    ->log('Property price updated');
</code></pre>
<hr>
<h2>5. Database Migrations (Laravel)</h2>
<h3>5.1 Migration Order</h3>
<pre><code>1. 2025_11_01_000000_create_users_table.php
2. 2025_11_01_000001_create_password_reset_tokens_table.php
3. 2025_11_01_000002_create_sessions_table.php
4. 2025_11_01_000003_create_offices_table.php
5. 2025_11_01_000004_create_agents_table.php
6. 2025_11_01_000005_create_office_admins_table.php
7. 2025_11_01_000006_create_properties_table.php
8. 2025_11_01_000007_create_property_photos_table.php
9. 2025_11_01_000008_create_property_links_table.php
10. 2025_11_01_000009_create_transactions_table.php
11. 2025_11_01_000010_create_commissions_table.php
12. 2025_11_01_000011_create_activity_log_table.php
</code></pre>
<p><strong>Note:</strong> <code>activity_log</code> table will be auto-created by spatie/laravel-activitylog package via:</p>
<pre><code>php artisan vendor:publish --provider="Spatie\Activitylog\ActivitylogServiceProvider" --tag="activitylog-migrations"
php artisan migrate
</code></pre>
<hr>
<h2>6. Sample Data (Seeders)</h2>
<h3>6.1 Admin Master (Default)</h3>
<pre><code>User::create([
    'name' => 'Super Admin',
    'email' => 'admin@hendraprop.com',
    'password' => Hash::make('password'),
    'role' => 'admin_master',
    'is_active' => true,
]);
</code></pre>
<h3>6.2 Sample Offices</h3>
<pre><code>Office::create(['name' => 'Hendra Prop 1', 'address' => 'Jakarta', 'phone' => '021-xxx']);
Office::create(['name' => 'Hendra Prop 2', 'address' => 'Bandung', 'phone' => '022-xxx']);
Office::create(['name' => 'Hendra Prop 3', 'address' => 'Surabaya', 'phone' => '031-xxx']);
</code></pre>
<h3>6.3 Sample Agents</h3>
<pre><code>// Create user first
$user = User::create([
    'name' => 'Agent 1',
    'email' => 'agent1@hendraprop.com',
    'password' => Hash::make('password'),
    'role' => 'agent',
]);

// Create agent profile
Agent::create([
    'user_id' => $user->id,
    'office_id' => 1,
    'phone' => '08123456789',
    'whatsapp' => '08123456789',
    'status' => 'active',
]);
</code></pre>
<hr>
<h2>7. Query Examples</h2>
<h3>7.1 Get all properties with agent info</h3>
<pre><code>SELECT 
    p.id, p.title, p.price, p.status,
    a.id as agent_id,
    u.name as agent_name,
    o.name as office_name
FROM properties p
JOIN agents a ON p.agent_id = a.id
JOIN users u ON a.user_id = u.id
JOIN offices o ON a.office_id = o.id
WHERE p.status = 'available'
ORDER BY p.created_at DESC
LIMIT 20;
</code></pre>
<h3>7.2 Get agent performance (omzet & komisi)</h3>
<pre><code>SELECT 
    a.id,
    u.name as agent_name,
    COUNT(DISTINCT p.id) as total_listings,
    COUNT(DISTINCT t.id) as total_transactions,
    SUM(t.final_price) as total_omzet,
    SUM(c.amount) as total_commission,
    SUM(CASE WHEN c.status = 'pending' THEN c.amount ELSE 0 END) as commission_pending,
    SUM(CASE WHEN c.status = 'paid' THEN c.amount ELSE 0 END) as commission_paid
FROM agents a
JOIN users u ON a.user_id = u.id
LEFT JOIN properties p ON p.agent_id = a.id
LEFT JOIN transactions t ON t.agent_owner_id = a.id OR t.agent_buyer_id = a.id
LEFT JOIN commissions c ON c.agent_id = a.id
WHERE a.id = ?
GROUP BY a.id, u.name;
</code></pre>
<h3>7.3 Get office performance</h3>
<pre><code>SELECT 
    o.id,
    o.name as office_name,
    COUNT(DISTINCT a.id) as total_agents,
    COUNT(DISTINCT p.id) as total_listings,
    COUNT(DISTINCT t.id) as total_transactions,
    SUM(t.final_price) as total_omzet,
    SUM(c.amount) as office_commission
FROM offices o
LEFT JOIN agents a ON a.office_id = o.id
LEFT JOIN properties p ON p.agent_id = a.id
LEFT JOIN transactions t ON t.property_id = p.id
LEFT JOIN commissions c ON c.office_id = o.id
WHERE o.id = ?
GROUP BY o.id, o.name;
</code></pre>
<hr>
<h2>8. Performance Optimization</h2>
<h3>8.1 Index Strategy</h3>
<ul>
<li><strong>Primary Keys:</strong> All tables have auto-increment BIGINT primary key</li>
<li><strong>Foreign Keys:</strong> All FKs are indexed automatically</li>
<li><strong>Search Columns:</strong> city, type, status, price (for filtering)</li>
<li><strong>FULLTEXT:</strong> title, description, address (for search)</li>
<li><strong>Composite Index:</strong> (agent_id, status) pada properties</li>
</ul>
<h3>8.2 Query Optimization</h3>
<pre><code>// ❌ BAD: N+1 problem
$properties = Property::all();
foreach ($properties as $property) {
    echo $property->agent->user->name; // N queries
}

// ✅ GOOD: Eager loading
$properties = Property::with('agent.user', 'photos')->get(); // 1 query
</code></pre>
<h3>8.3 Caching Strategy</h3>
<pre><code>// Cache expensive queries
$topProperties = Cache::remember('properties:featured', 3600, function() {
    return Property::where('is_featured', true)
        ->with('agent.user', 'photos')
        ->take(10)
        ->get();
});
</code></pre>
<hr>
<h2>9. Backup Strategy</h2>
<h3>9.1 Daily Backup</h3>
<pre><code>#!/bin/bash
# Daily backup script
mysqldump -u root -p hendra_prop > /backup/hendra_prop_$(date +%Y%m%d).sql
</code></pre>
<h3>9.2 Retention Policy</h3>
<ul>
<li>Daily backups: Keep for 7 days</li>
<li>Weekly backups: Keep for 1 month</li>
<li>Monthly backups: Keep for 1 year</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0</p>
</div>

<div class="content-section page-break" id="section-4">
<h1>BAB 4: Data Flow Diagram (DFD)</h1>

<p><strong>Dokumen Data Flow Diagram</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. DFD Overview</h2>
<p>Data Flow Diagram (DFD) menunjukkan bagaimana data mengalir melalui sistem, dari input pengguna hingga penyimpanan dan output. DFD ini menggunakan notasi standar dengan 4 komponen utama:</p>
<p><strong>Notasi:</strong></p>
<ul>
<li><strong>External Entity (□)</strong> - Pengguna atau sistem eksternal</li>
<li><strong>Process (○)</strong> - Proses/transformasi data</li>
<li><strong>Data Store (═)</strong> - Database/storage</li>
<li><strong>Data Flow (→)</strong> - Aliran data</li>
</ul>
<hr>
<h2>2. DFD Level 0 (Context Diagram)</h2>
<h3>2.1 System Context</h3>
<pre><code>┌──────────────────────────────────────────────────────────────────┐
│                         SISTEM HENDRA PROP                        │
│                    (Property Management System)                   │
│                                                                    │
│  Input:                                Output:                    │
│  • Property Data                       • Listing Information      │
│  • Transaction Data                    • Performance Reports      │
│  • User Credentials                    • Commission Reports       │
│  • Search Queries                      • Notifications            │
└──────────────────────────────────────────────────────────────────┘
         ▲                 ▲                 ▲                 ▲
         │                 │                 │                 │
    ┌────┴────┐       ┌────┴────┐      ┌────┴────┐      ┌────┴────┐
    │  Admin  │       │  Admin  │      │  Agen   │      │  Buyer  │
    │  Master │       │ Kantor  │      │ Properti│      │(Public) │
    └─────────┘       └─────────┘      └─────────┘      └─────────┘
</code></pre>
<h3>2.2 External Entities</h3>
<table>
<thead>
<tr>
<th>Entity</th>
<th>Role</th>
<th>Interaction</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Admin Master</strong></td>
<td>Super Administrator</td>
<td>Full CRUD on all entities, view all reports</td>
</tr>
<tr>
<td><strong>Admin Kantor</strong></td>
<td>Office Manager</td>
<td>Manage office agents & properties, view office reports</td>
</tr>
<tr>
<td><strong>Agen Properti</strong></td>
<td>Sales Agent</td>
<td>Create listings, view personal performance</td>
</tr>
<tr>
<td><strong>Buyer (Public)</strong></td>
<td>Property Seeker</td>
<td>Browse/search listings, contact agents</td>
</tr>
</tbody>
</table>
<h2>3. DFD Level 1 (Main Processes)</h2>
<h3>3.1 Complete Level 1 DFD</h3>
<pre><code>┌─────────────┐                                           ┌─────────────┐
│   Admin     │                                           │   Buyer     │
│   Master    │                                           │  (Public)   │
└──────┬──────┘                                           └──────┬──────┘
       │                                                         │
       │ [Credentials]                            [Search Query]│
       ▼                                                         ▼
┌────────────────────────────────────────────────────────────────────────┐
│                         1.0 AUTHENTICATION                              │
│                      (Login/Logout/Verify)                              │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [User Session]
       ▼
   ═════════════════
   ║ USER_SESSION  ║
   ═════════════════
       │
       │ [Authenticated User Data]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                      2.0 USER MANAGEMENT                                │
│              (CRUD Kantor, Agen, Assign Roles)                          │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [User/Office/Agent Data]
       ▼
   ═════════════════
   ║  USERS_DB     ║
   ║  OFFICES_DB   ║
   ║  AGENTS_DB    ║
   ═════════════════
       │
       │ [Agent Info]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                    3.0 PROPERTY MANAGEMENT                              │
│           (Create Listing, Upload Photos, Publish)                      │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Property Data + Photos]
       ▼
   ═════════════════════════
   ║  PROPERTIES_DB        ║
   ║  PROPERTY_PHOTOS_DB   ║
   ║  PROPERTY_LINKS_DB    ║
   ═════════════════════════
       │                                 │
       │ [Public Properties]             │ [Private Link]
       ▼                                 ▼
┌──────────────────────────┐    ┌───────────────────────┐
│  4.0 PUBLIC MARKETPLACE  │    │ 5.0 PRIVATE VIEWING   │
│    (Browse/Search)       │    │   (Token Access)      │
└──────┬───────────────────┘    └───────────────────────┘
       │                                 │
       │ [Property View]                 │ [View Count]
       ▼                                 ▼
   ═════════════════
   ║  PROPERTIES   ║ ← [Update Views]
   ═════════════════
       │
       │ [Agent Contact Info]
       ▼
   [Buyer Contacts Agent via WA/Phone]
       │
       │ [Transaction Details]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                   6.0 TRANSACTION MANAGEMENT                            │
│          (Input Sale/Rent, Link Agents, Buyer Info)                     │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Transaction Data]
       ▼
   ═════════════════════
   ║  TRANSACTIONS_DB  ║
   ═════════════════════
       │
       │ [Transaction Record]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                   7.0 COMMISSION CALCULATION                            │
│              (Auto-Calculate, Split 70/30 or 35/35/30)                  │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Commission Records]
       ▼
   ═════════════════════
   ║  COMMISSIONS_DB   ║
   ═════════════════════
       │
       │ [Commission Data]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                    8.0 PERFORMANCE DASHBOARD                            │
│         (Aggregate Metrics, Generate Charts, Reports)                   │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Performance Reports]
       ▼
   [Admin/Agen View Dashboard]
       │
       │ [Activity Data]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                      9.0 ACTIVITY LOGGING                               │
│              (Track Changes, Audit Trail)                               │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Activity Logs]
       ▼
   ═════════════════════
   ║  ACTIVITY_LOG_DB  ║
   ═════════════════════
       │
       │ [Notification Triggers]
       ▼
┌────────────────────────────────────────────────────────────────────────┐
│                     10.0 NOTIFICATION SYSTEM                            │
│            (Email & Database Notifications)                             │
└──────┬─────────────────────────────────────────────────────────────────┘
       │ [Notifications]
       ▼
   ═════════════════════
   ║  NOTIFICATIONS_DB ║
   ═════════════════════
       │
       ▼
   [User Receives Notification]
</code></pre>
<hr>
<h2>4. DFD Level 2 (Detailed Processes)</h2>
<h3>4.1 Process 3.0 - Property Management (Detailed)</h3>
<pre><code>┌──────────────┐
│    Agen      │
└──────┬───────┘
       │
       │ [Property Input Data]
       ▼
┌──────────────────────────────────────────┐
│  3.1 VALIDATE PROPERTY DATA              │
│  (Check required fields, formats)        │
└──────┬───────────────────────────────────┘
       │ [Validated Data]
       ▼
┌──────────────────────────────────────────┐
│  3.2 UPLOAD & OPTIMIZE PHOTOS            │
│  (Max 10, resize, compress)              │
└──────┬───────────────────────────────────┘
       │ [Photos URLs]
       ▼
   ═════════════════════
   ║  PROPERTY_PHOTOS  ║
   ═════════════════════
       │
       │ [Property + Photos]
       ▼
┌──────────────────────────────────────────┐
│  3.3 GENERATE SLUG & METADATA            │
│  (SEO slug, timestamps)                  │
└──────┬───────────────────────────────────┘
       │ [Complete Property Record]
       ▼
┌──────────────────────────────────────────┐
│  3.4 PUBLISH DECISION                    │
│  (Set is_public, published_at)           │
└──────┬───────────────────────────────────┘
       │
       ├─[is_public=true]──────────────────┐
       │                                    │
       │ [Save to DB]                       │ [Index for Search]
       ▼                                    ▼
   ═══════════════                  ┌──────────────┐
   ║ PROPERTIES ║──────────────────▶│  3.5 INDEX   │
   ═══════════════                  │  FOR SEARCH  │
       │                            └──────────────┘
       │ [Property Created]
       ▼
┌──────────────────────────────────────────┐
│  3.6 LOG ACTIVITY                        │
│  (Record creation in audit log)          │
└──────┬───────────────────────────────────┘
       │ [Activity Log Entry]
       ▼
   ═════════════════
   ║ ACTIVITY_LOG  ║
   ═════════════════
       │
       │ [Trigger Notification]
       ▼
┌──────────────────────────────────────────┐
│  3.7 SEND NOTIFICATION                   │
│  (Notify Admin Kantor for review)        │
└──────────────────────────────────────────┘
</code></pre>
<hr>
<h3>4.2 Process 6.0 - Transaction Management (Detailed)</h3>
<pre><code>┌──────────────┐
│ Admin Kantor │
└──────┬───────┘
       │
       │ [Transaction Input]
       ▼
┌──────────────────────────────────────────┐
│  6.1 SELECT PROPERTY                     │
│  (Dropdown available properties)         │
└──────┬───────────────────────────────────┘
       │ [Property ID]
       ▼
   ═══════════════
   ║ PROPERTIES ║────────[Property Data]────┐
   ═══════════════                           │
                                             ▼
┌──────────────────────────────────────────────────────┐
│  6.2 AUTO-FILL AGENT OWNER                           │
│  (Get agent from property.agent_id)                  │
└──────┬───────────────────────────────────────────────┘
       │ [Agent Owner Data]
       ▼
┌──────────────────────────────────────────┐
│  6.3 INPUT TRANSACTION DETAILS           │
│  • Agent Buyer (optional)                │
│  • Buyer Name & Contact                  │
│  • Final Price                           │
│  • Transaction Type (sale/rent)          │
│  • Commission % (default 2%)             │
└──────┬───────────────────────────────────┘
       │ [Transaction Data]
       ▼
┌──────────────────────────────────────────┐
│  6.4 CALCULATE COMMISSION PREVIEW        │
│  (Show: total, agent split, office)      │
└──────┬───────────────────────────────────┘
       │ [Confirmed Transaction]
       ▼
┌──────────────────────────────────────────┐
│  6.5 SAVE TRANSACTION                    │
└──────┬───────────────────────────────────┘
       │ [Transaction Record]
       ▼
   ═════════════════
   ║ TRANSACTIONS ║
   ═════════════════
       │
       │ [Transaction ID]
       ▼
┌──────────────────────────────────────────┐
│  6.6 GENERATE COMMISSIONS                │
│  (Create records for agents & office)    │
└──────┬───────────────────────────────────┘
       │ [Commission Records]
       ▼
   ═════════════════
   ║ COMMISSIONS  ║
   ═════════════════
       │
       │ [Property ID]
       ▼
┌──────────────────────────────────────────┐
│  6.7 UPDATE PROPERTY STATUS              │
│  (Set to sold/rented)                    │
└──────┬───────────────────────────────────┘
       │ [Updated Property]
       ▼
   ═══════════════
   ║ PROPERTIES ║
   ═══════════════
       │
       │ [Log Entry]
       ▼
┌──────────────────────────────────────────┐
│  6.8 LOG TRANSACTION                     │
│  (Audit trail)                           │
└──────┬───────────────────────────────────┘
       │ [Activity Log]
       ▼
   ═════════════════
   ║ ACTIVITY_LOG ║
   ═════════════════
       │
       │ [Notification Triggers]
       ▼
┌──────────────────────────────────────────┐
│  6.9 NOTIFY AGENTS                       │
│  (Property sold, commission pending)     │
└──────────────────────────────────────────┘
</code></pre>
<hr>
<h3>4.3 Process 7.0 - Commission Calculation (Detailed)</h3>
<pre><code>┌──────────────────┐
│  Transaction     │
│  Created Event   │
└──────┬───────────┘
       │ [Transaction Data]
       ▼
┌──────────────────────────────────────────┐
│  7.1 GET COMMISSION PERCENTAGE           │
│  (Default 2% or custom from transaction) │
└──────┬───────────────────────────────────┘
       │ [Commission %]
       ▼
┌──────────────────────────────────────────┐
│  7.2 CALCULATE TOTAL COMMISSION          │
│  (final_price × commission_percentage)   │
└──────┬───────────────────────────────────┘
       │ [Total Commission Amount]
       ▼
┌──────────────────────────────────────────┐
│  7.3 CHECK AGENT COUNT                   │
│  (1 agent or 2 agents?)                  │
└──────┬───────────────────────────────────┘
       │
       ├─[1 Agent]────────────────┐
       │                          │
       │                          ▼
       │                   ┌──────────────────────────┐
       │                   │  7.4a SPLIT 70/30        │
       │                   │  • Agent: 70%            │
       │                   │  • Office: 30%           │
       │                   └──────┬───────────────────┘
       │                          │
       │                          │
       ├─[2 Agents]──────────────┐│
       │                          ││
       │                          ▼▼
       │                   ┌──────────────────────────┐
       │                   │  7.4b SPLIT 35/35/30     │
       │                   │  • Agent Owner: 35%      │
       │                   │  • Agent Buyer: 35%      │
       │                   │  • Office: 30%           │
       │                   └──────┬───────────────────┘
       │                          │
       ▼                          ▼
       └──────────────┬───────────┘
                      │ [Commission Array]
                      ▼
┌──────────────────────────────────────────┐
│  7.5 CREATE COMMISSION RECORDS           │
│  (One for each agent + one for office)   │
└──────┬───────────────────────────────────┘
       │ [Commission Records]
       ▼
   ═════════════════
   ║ COMMISSIONS  ║
   ═════════════════
       │ [Status: pending]
       ▼
   [Agents can view in dashboard]
</code></pre>
<p><strong>Example Calculation:</strong></p>
<pre><code>Transaction: Rp 1.000.000.000
Commission %: 2%
Total Commission: Rp 20.000.000

Scenario A (1 Agent):
→ Agent Owner: Rp 14.000.000 (70%)
→ Office: Rp 6.000.000 (30%)

Scenario B (2 Agents):
→ Agent Owner: Rp 7.000.000 (35%)
→ Agent Buyer: Rp 7.000.000 (35%)
→ Office: Rp 6.000.000 (30%)
</code></pre>
<hr>
<h3>4.4 Process 8.0 - Performance Dashboard (Detailed)</h3>
<pre><code>┌──────────────┐
│ Agen/Admin   │
└──────┬───────┘
       │ [Dashboard Request + Date Range]
       ▼
┌──────────────────────────────────────────┐
│  8.1 IDENTIFY USER ROLE                  │
│  (Agen: personal, Admin: office/master)  │
└──────┬───────────────────────────────────┘
       │ [User Role]
       │
       ├─[Agen]──────────────────────────┐
       │                                  │
       │                                  ▼
       │                   ┌────────────────────────────┐
       │                   │  8.2a QUERY AGENT DATA     │
       │                   │  • Listings count          │
       │                   │  • Transactions sum        │
       │                   │  • Commissions sum         │
       │                   └──────┬─────────────────────┘
       │                          │
       │                          │
       ├─[Admin Kantor]──────────┐│
       │                          ││
       │                          ▼▼
       │                   ┌────────────────────────────┐
       │                   │  8.2b QUERY OFFICE DATA    │
       │                   │  (Aggregate all agents)    │
       │                   └──────┬─────────────────────┘
       │                          │
       │                          │
       └─[Admin Master]──────────┐│
                                  ││
                                  ▼▼
                          ┌────────────────────────────┐
                          │  8.2c QUERY GLOBAL DATA    │
                          │  (Aggregate all offices)   │
                          └──────┬─────────────────────┘
                                 │
       ┌─────────────────────────┴─────────────┐
       │                                       │
       ▼                                       ▼
   ═══════════════                    ═════════════════
   ║ PROPERTIES ║                    ║ TRANSACTIONS ║
   ═══════════════                    ═════════════════
       │                                       │
       └───────────────┬───────────────────────┘
                       │ [Raw Data]
                       ▼
┌──────────────────────────────────────────┐
│  8.3 CALCULATE METRICS                   │
│  • Total Listings                        │
│  • Total Omzet (sum final_price)         │
│  • Total Commission                      │
│  • Closing Rate (sold/total × 100%)     │
└──────┬───────────────────────────────────┘
       │ [Calculated Metrics]
       ▼
┌──────────────────────────────────────────┐
│  8.4 GENERATE CHARTS DATA                │
│  • Omzet per month (line chart)          │
│  • Listings by status (pie chart)        │
│  • Performance comparison (bar chart)    │
└──────┬───────────────────────────────────┘
       │ [Chart Data JSON]
       ▼
┌──────────────────────────────────────────┐
│  8.5 CACHE RESULTS                       │
│  (TTL: 1 hour for performance)           │
└──────┬───────────────────────────────────┘
       │ [Cached Metrics + Charts]
       ▼
   ═══════════════
   ║ REDIS CACHE║
   ═══════════════
       │
       │ [Dashboard Response]
       ▼
   [User Views Dashboard]
</code></pre>
<hr>
<h2>5. Data Stores Detail</h2>
<h3>5.1 Database Tables & Their Usage</h3>
<table>
<thead>
<tr>
<th>Data Store</th>
<th>Used By Processes</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>users</strong></td>
<td>1.0, 2.0</td>
<td>Authentication & user management</td>
</tr>
<tr>
<td><strong>offices</strong></td>
<td>2.0</td>
<td>Office information</td>
</tr>
<tr>
<td><strong>agents</strong></td>
<td>2.0, 3.0, 6.0</td>
<td>Agent profiles & relationships</td>
</tr>
<tr>
<td><strong>properties</strong></td>
<td>3.0, 4.0, 5.0, 6.0, 8.0</td>
<td>Property listings</td>
</tr>
<tr>
<td><strong>property_photos</strong></td>
<td>3.0, 4.0, 5.0</td>
<td>Property images</td>
</tr>
<tr>
<td><strong>property_links</strong></td>
<td>5.0</td>
<td>Private tokenized access</td>
</tr>
<tr>
<td><strong>transactions</strong></td>
<td>6.0, 7.0, 8.0</td>
<td>Sale/rent records</td>
</tr>
<tr>
<td><strong>commissions</strong></td>
<td>7.0, 8.0</td>
<td>Commission tracking</td>
</tr>
<tr>
<td><strong>activity_log</strong></td>
<td>9.0</td>
<td>Audit trail</td>
</tr>
<tr>
<td><strong>notifications</strong></td>
<td>10.0</td>
<td>User notifications</td>
</tr>
</tbody>
</table>
<h2>6. Critical Data Flows</h2>
<h3>6.1 End-to-End: Property Listing to Commission</h3>
<pre><code>1. Agen → [Property Data] → Process 3.0 → PROPERTIES_DB
2. Buyer → [Search] → Process 4.0 → PROPERTIES_DB → [Results] → Buyer
3. Buyer → [Contact] → Agen (External: WA/Phone)
4. Admin → [Transaction] → Process 6.0 → TRANSACTIONS_DB
5. Process 6.0 → [Trigger] → Process 7.0 → COMMISSIONS_DB
6. Process 7.0 → [Status Update] → PROPERTIES_DB (sold/rented)
7. Process 6.0 → [Log] → Process 9.0 → ACTIVITY_LOG_DB
8. Process 9.0 → [Notify] → Process 10.0 → NOTIFICATIONS_DB
9. Agen → [Dashboard] → Process 8.0 → Query COMMISSIONS_DB → [Report]
</code></pre>
<h3>6.2 Data Flow Summary Table</h3>
<table>
<thead>
<tr>
<th>From</th>
<th>Data</th>
<th>To</th>
<th>Process</th>
</tr>
</thead>
<tbody>
<tr>
<td>Agen</td>
<td>Property Info</td>
<td>System</td>
<td>3.0 Property Mgmt</td>
</tr>
<tr>
<td>System</td>
<td>Property Record</td>
<td>PROPERTIES_DB</td>
<td>Store</td>
</tr>
<tr>
<td>Buyer</td>
<td>Search Query</td>
<td>System</td>
<td>4.0 Marketplace</td>
</tr>
<tr>
<td>PROPERTIES_DB</td>
<td>Listing Results</td>
<td>Buyer</td>
<td>Display</td>
</tr>
<tr>
<td>Admin</td>
<td>Transaction Info</td>
<td>System</td>
<td>6.0 Transaction Mgmt</td>
</tr>
<tr>
<td>System</td>
<td>Transaction Record</td>
<td>TRANSACTIONS_DB</td>
<td>Store</td>
</tr>
<tr>
<td>System</td>
<td>Commission Data</td>
<td>COMMISSIONS_DB</td>
<td>7.0 Calculation</td>
</tr>
<tr>
<td>System</td>
<td>Activity Record</td>
<td>ACTIVITY_LOG_DB</td>
<td>9.0 Logging</td>
</tr>
<tr>
<td>System</td>
<td>Notification</td>
<td>User</td>
<td>10.0 Notification</td>
</tr>
</tbody>
</table>
<h2>7. Data Validation & Business Rules</h2>
<h3>7.1 Process-Level Validation</h3>
<p><strong>Process 3.0 - Property Management:</strong></p>
<ul>
<li>Validate: required fields (title, price, type, agent_id)</li>
<li>Check: photo count ≤ 10, file size ≤ 5MB</li>
<li>Generate: unique slug</li>
<li>Default: status = 'available', is_public = true</li>
</ul>
<p><strong>Process 6.0 - Transaction Management:</strong></p>
<ul>
<li>Validate: property must be 'available' or 'pending'</li>
<li>Check: agent_owner from property.agent_id</li>
<li>Optional: agent_buyer (different from agent_owner)</li>
<li>Auto-set: property.status = 'sold'/'rented'</li>
</ul>
<p><strong>Process 7.0 - Commission Calculation:</strong></p>
<ul>
<li>Validate: commission_percentage > 0</li>
<li>Check: agent count (1 or 2)</li>
<li>Calculate: split based on agent count</li>
<li>Default: status = 'pending'</li>
</ul>
<hr>
<h2>8. Performance Considerations</h2>
<h3>8.1 Data Flow Optimization</h3>
<p><strong>Caching Strategy:</strong></p>
<ul>
<li>Cache dashboard queries (TTL: 1 hour)</li>
<li>Cache public listing (TTL: 5 minutes)</li>
<li>Cache search results (TTL: 10 minutes)</li>
</ul>
<p><strong>Query Optimization:</strong></p>
<ul>
<li>Eager load relationships to avoid N+1</li>
<li>Index frequently queried columns</li>
<li>Use pagination for large result sets</li>
</ul>
<p><strong>Async Processing:</strong></p>
<ul>
<li>Image optimization → Queue</li>
<li>Email notifications → Queue</li>
<li>Activity logging → Queue (for bulk operations)</li>
<li>Report generation → Queue</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Status:</strong> Ready for Development Reference</p>
</div>

<div class="content-section page-break" id="section-5">
<h1>BAB 5: Use Case Diagram & Specifications</h1>

<p><strong>Dokumen Use Case Diagram & Scenarios</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Use Case Overview</h2>
<p>Use Case Diagram menunjukkan interaksi antara actor (pengguna) dengan sistem. Diagram ini mengidentifikasi siapa yang bisa melakukan apa dalam sistem.</p>
<p><strong>Notasi:</strong></p>
<ul>
<li><strong>Actor (🧑)</strong> - Pengguna atau role</li>
<li><strong>Use Case (○)</strong> - Fungsi/fitur sistem</li>
<li><strong>Association (─)</strong> - Actor menggunakan use case</li>
<li><strong>Include (««include»»)</strong> - Use case wajib memanggil use case lain</li>
<li><strong>Extend (««extend»»)</strong> - Use case opsional dipanggil jika kondisi tertentu</li>
<li><strong>Generalization (▲)</strong> - Inheritance/parent-child relationship</li>
</ul>
<hr>
<h2>2. Actors & Their Roles</h2>
<table>
<thead>
<tr>
<th>Actor</th>
<th>Description</th>
<th>Primary Goals</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Admin Master</strong></td>
<td>Super administrator</td>
<td>Manage seluruh sistem, view all reports</td>
</tr>
<tr>
<td><strong>Admin Kantor</strong></td>
<td>Office manager</td>
<td>Manage office agents & properties</td>
</tr>
<tr>
<td><strong>Agen Properti</strong></td>
<td>Sales agent</td>
<td>Create listings, view commissions</td>
</tr>
<tr>
<td><strong>Buyer (Public)</strong></td>
<td>Property seeker</td>
<td>Browse & search properties</td>
</tr>
<tr>
<td><strong>System</strong></td>
<td>Automated system</td>
<td>Run scheduled tasks, send notifications</td>
</tr>
</tbody>
</table>
<h2>3. Complete Use Case Diagram</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                      SISTEM HENDRA PROP                                  │
│                                                                           │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                    AUTHENTICATION                             │      │
│  │                                                               │      │
│  │    ○ Login                   ○ Logout                        │      │
│  │    ○ Forgot Password         ○ Reset Password                │      │
│  └──────────────────────────────────────────────────────────────┘      │
│           │                                                              │
│           │                                                              │
│  ┌────────┼──────────────────────────────────────────────────────────┐ │
│  │        │            PROPERTY MANAGEMENT                            │ │
│  │        │                                                            │ │
│  │    ○ Create Property           ○ Edit Property                    │ │
│  │    ○ Delete Property           ○ Upload Photos                    │ │
│  │    ○ Publish to Marketplace    ○ Generate Private Link           │ │
│  │    ○ Set Property Status       ○ View Property List              │ │
│  └──────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                    PUBLIC MARKETPLACE                          │      │
│  │                                                               │      │
│  │    ○ Browse Listings           ○ Search Properties           │      │
│  │    ○ Filter by Criteria        ○ View Property Detail        │      │
│  │    ○ Contact Agent (WA/Phone)  ○ Access Private Link         │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                 TRANSACTION MANAGEMENT                         │      │
│  │                                                               │      │
│  │    ○ Input Transaction         ○ View Transactions           │      │
│  │    ○ Edit Transaction          ○ Calculate Commission        │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                 COMMISSION MANAGEMENT                          │      │
│  │                                                               │      │
│  │    ○ View Commissions          ○ Mark as Paid                │      │
│  │    ○ Track Payment Status      ○ View Commission History     │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                   PERFORMANCE DASHBOARD                        │      │
│  │                                                               │      │
│  │    ○ View Personal Dashboard   ○ View Office Dashboard       │      │
│  │    ○ View Master Dashboard     ○ Export Reports              │      │
│  │    ○ View Closing Rate         ○ Filter by Date Range        │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                    USER MANAGEMENT                             │      │
│  │                                                               │      │
│  │    ○ Manage Offices            ○ Manage Agents               │      │
│  │    ○ Assign Roles              ○ Activate/Deactivate User    │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                 ACTIVITY LOG & AUDIT                           │      │
│  │                                                               │      │
│  │    ○ View Activity Log         ○ Search Audit Trail          │      │
│  │    ○ Filter by User/Action     ○ Export Activity Log         │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │                    NOTIFICATIONS                               │      │
│  │                                                               │      │
│  │    ○ View Notifications        ○ Mark as Read                │      │
│  │    ○ Receive Email Alerts      ○ Manage Preferences          │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘

🧑 Admin Master          🧑 Admin Kantor          🧑 Agen          🧑 Buyer
     │                        │                      │               │
     └────────────────────────┴──────────────────────┴───────────────┘
                  (All connect to relevant use cases above)
</code></pre>
<hr>
<h2>4. Use Cases by Actor</h2>
<h3>4.1 Admin Master Use Cases</h3>
<pre><code>┌──────────────────┐
│  Admin Master    │
│      🧑         │
└────────┬─────────┘
         │
         ├────────○ UC-01: Login
         │
         ├────────○ UC-02: Manage Offices (CRUD)
         │           ├── Create Office
         │           ├── Edit Office
         │           ├── Delete Office (soft)
         │           └── View All Offices
         │
         ├────────○ UC-03: Manage Agents (CRUD)
         │           ├── Create Agent
         │           ├── Edit Agent
         │           ├── Assign to Office
         │           └── Deactivate Agent
         │
         ├────────○ UC-04: Manage Properties
         │           ├── View All Properties
         │           ├── Edit Any Property
         │           ├── Delete Property
         │           ├── Approve Property
         │           └── Force Unpublish
         │
         ├────────○ UC-05: Manage Transactions
         │           ├── Input Transaction
         │           ├── Edit Transaction
         │           ├── View All Transactions
         │           └── ««include»» Calculate Commission
         │
         ├────────○ UC-06: Manage Commissions
         │           ├── View All Commissions
         │           ├── Edit Commission Split
         │           ├── Mark as Paid
         │           └── Override Commission %
         │
         ├────────○ UC-07: View Master Dashboard
         │           ├── View Global Metrics
         │           ├── View All Offices Performance
         │           ├── View All Agents Performance
         │           └── ««extend»» Export Reports
         │
         ├────────○ UC-08: View Activity Log
         │           ├── View All Activities
         │           ├── Filter by User/Date/Action
         │           └── ««extend»» Export Audit Trail
         │
         ├────────○ UC-09: Manage System Settings
         │           ├── Configure Defaults
         │           └── Manage Notifications
         │
         └────────○ UC-10: Restore Deleted Data
                     └── Undelete Soft-Deleted Records
</code></pre>
<hr>
<h3>4.2 Admin Kantor Use Cases</h3>
<pre><code>┌──────────────────┐
│  Admin Kantor    │
│      🧑         │
└────────┬─────────┘
         │
         ├────────○ UC-11: Login
         │
         ├────────○ UC-12: Manage Office Agents
         │           ├── Create Agent (own office only)
         │           ├── Edit Agent
         │           └── View Office Agents
         │
         ├────────○ UC-13: Manage Office Properties
         │           ├── Create Property
         │           ├── Edit Property
         │           ├── Delete Property
         │           ├── Publish to Marketplace
         │           └── Generate Private Link
         │
         ├────────○ UC-13A: Review Property Submissions
         │           ├── View Pending Submissions
         │           ├── Approve Property → PUBLISHED
         │           ├── Decline Property → DECLINED
         │           ├── Request Revision → NEED_REVISION
         │           ├── Add Revision Notes
         │           └── ««include»» Send Notification to Agent
         │
         ├────────○ UC-14: Manage Transactions
         │           ├── Input Transaction (office properties)
         │           ├── View Office Transactions
         │           └── ««include»» Calculate Commission
         │
         ├────────○ UC-15: Manage Commissions
         │           ├── View Office Commissions
         │           ├── Mark as Paid (office agents)
         │           └── Edit Commission Notes
         │
         ├────────○ UC-16: View Office Dashboard
         │           ├── View Office Metrics
         │           ├── View Agents Performance
         │           ├── View Closing Rates
         │           └── ««extend»» Export Office Report
         │
         ├────────○ UC-17: View Activity Log
         │           └── View Office Activities
         │
         └────────○ UC-18: Manage Notifications
                     ├── View Notifications
                     └── Mark as Read
</code></pre>
<hr>
<h3>4.3 Agen Properti Use Cases</h3>
<pre><code>┌──────────────────┐
│  Agen Properti   │
│      🧑         │
└────────┬─────────┘
         │
         ├────────○ UC-19: Login
         │
         ├────────○ UC-20: Manage Profile
         │           ├── Edit Profile Info
         │           ├── Upload Photo
         │           └── Update Contact Info
         │
         ├────────○ UC-21: Manage Own Properties
         │           ├── Create Property (Draft)
         │           │    ├── ««include»» Upload Photos
         │           │    └── ««include»» Generate Slug
         │           ├── Submit Property for Approval
         │           ├── Edit Property
         │           ├── Resubmit After Revision
         │           ├── View Revision Notes
         │           ├── Delete Property
         │           ├── Set Property Status
         │           └── ««extend»» Generate Private Link
         │
         ├────────○ UC-22: View Property List
         │           ├── View Own Properties
         │           └── Filter by Status
         │
         ├────────○ UC-23: View Property Visitors (Leads)
         │           ├── View Visitor List per Property
         │           ├── Filter by Interest Level
         │           ├── Export Visitor Data to Excel
         │           └── View Visitor Contact Info
         │
         ├────────○ UC-24: View Commissions
         │           ├── View Pending Commissions
         │           ├── View Paid Commissions
         │           └── View Commission History
         │
         ├────────○ UC-24: View Personal Dashboard
         │           ├── View Total Listings
         │           ├── View Total Omzet
         │           ├── View Total Commission
         │           ├── View Closing Rate
         │           └── View Performance Charts
         │
         └────────○ UC-25: Manage Notifications
                     ├── View Notifications
                     ├── Mark as Read
                     └── Configure Preferences
</code></pre>
<hr>
<h3>4.4 Buyer (Public) Use Cases</h3>
<pre><code>┌──────────────────┐
│   Buyer          │
│   (Public) 🧑   │
└────────┬─────────┘
         │
         ├────────○ UC-26: Browse Marketplace
         │           ├── View All Listings
         │           └── Pagination
         │
         ├────────○ UC-27: Search Properties
         │           ├── Search by Keyword
         │           └── ««include»» Filter Results
         │
         ├────────○ UC-28: Filter Properties
         │           ├── Filter by Type
         │           ├── Filter by Price Range
         │           ├── Filter by Location
         │           ├── Filter by Listing Type (Jual/Sewa)
         │           └── Filter by Area Size
         │
         ├────────○ UC-29: View Property Detail
         │           ├── View Photos Gallery
         │           ├── View Full Description
         │           ├── View Location Map
         │           └── View Agent Info
         │
         ├────────○ UC-30: Access Private Link
         │           ├── Click Private Link (from WhatsApp/Email)
         │           ├── ««include»» Fill Visitor Form
         │           │    ├── Enter Name (required)
         │           │    ├── Enter Email (required)
         │           │    ├── Enter Phone (optional)
         │           │    ├── Enter WhatsApp (optional)
         │           │    ├── Select Interest Level
         │           │    └── Add Message/Notes
         │           └── View Property Detail (after form submission)
         │
         ├────────○ UC-31: Contact Agent
         │           ├── Call via Phone
         │           └── Chat via WhatsApp
         │
         ├────────○ UC-31: Access Private Link
         │           ├── Enter Token URL
         │           ├── ««include»» Validate Token
         │           └── View Private Property
         │
         └────────○ UC-32: (Optional) Register Account
                     ├── Create Buyer Account
                     └── Save Favorite Properties
</code></pre>
<hr>
<h3>4.5 System (Automated) Use Cases</h3>
<pre><code>┌──────────────────┐
│   System         │
│   ⚙️            │
└────────┬─────────┘
         │
         ├────────○ UC-33: Auto-Expire Private Links
         │           ├── Check expired links (hourly)
         │           └── Mark as expired
         │
         ├────────○ UC-34: Clean Old Notifications
         │           └── Delete notifications >30 days (daily)
         │
         ├────────○ UC-35: Generate Daily Reports
         │           ├── Cache performance metrics
         │           └── Pre-calculate dashboard data
         │
         ├────────○ UC-36: Archive Activity Logs
         │           └── Archive logs >90 days (weekly)
         │
         ├────────○ UC-37: Send Email Notifications
         │           ├── Property Approved Email
         │           ├── Property Sold Email
         │           └── Commission Paid Email
         │
         ├────────○ UC-38: Log Activities
         │           ├── Auto-log CRUD operations
         │           └── Track user actions
         │
         └────────○ UC-39: Optimize Images
                     ├── Resize uploaded photos
                     └── Compress for performance
</code></pre>
<hr>
<h2>5. Detailed Use Case Specifications</h2>
<h3>5.1 UC-21: Create Property (Agen)</h3>
<p><strong>Use Case ID:</strong> UC-21  </p>
<p><strong>Use Case Name:</strong> Create Property  </p>
<p><strong>Actor:</strong> Agen Properti  </p>
<p><strong>Priority:</strong> High  </p>
<p><strong>Preconditions:</strong></p>
<ul>
<li>Agen sudah login</li>
<li>Agen memiliki status active</li>
</ul>
<p><strong>Main Flow:</strong></p>
<p>1. Agen memilih menu "Create New Property"</p>
<p>2. System menampilkan form input property</p>
<p>3. Agen mengisi data property:</p>
<ul>
<li>Judul, deskripsi, tipe, harga, luas tanah/bangunan, alamat</li>
</ul>
<p>4. Agen mengupload foto (max 10)</p>
<ul>
<li>««include»» UC-21a: Upload & Optimize Photos</li>
</ul>
<p>5. Agen memilih publish option (Public/Private)</p>
<p>6. Agen klik "Save as Draft"</p>
<p>7. System validates input</p>
<ul>
<li>««include»» UC-21b: Validate Property Data</li>
</ul>
<p>8. System generates slug dari judul</p>
<p>9. System saves property to database dengan <code>approval_status = DRAFT</code></p>
<p>10. System logs activity</p>
<p>11. System menampilkan success message</p>
<p>12. Property tersimpan dengan status "DRAFT" (belum di-publish)</p>
<p><strong>Alternative Flow - Submit for Approval:</strong></p>
<p>6a. Agen klik "Submit for Approval" (instead of Save as Draft)</p>
<p>7a. System validates property (must complete: title, photos, price)</p>
<p>8a. System updates <code>approval_status = PENDING</code></p>
<p>9a. System records <code>submitted_at = now()</code></p>
<p>10a. System sends notification ke Admin Kantor</p>
<p>11a. System shows "Property submitted for review"</p>
<p>12a. Property menunggu approval dari Admin Kantor</p>
<p><strong>Alternative Flows:</strong></p>
<ul>
<li><strong>7a. Validation Error:</strong></li>
<li>System shows error messages</li>
<li>Return to step 3</li>
<li><strong>4a. Photo Upload Fail:</strong></li>
<li>System shows error message</li>
<li>Agen bisa retry atau skip photo</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li>Property tersimpan di database</li>
<li>Property muncul di admin panel</li>
<li>Activity log tercatat</li>
<li>Notification sent ke Admin Kantor</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Max 10 photos per property</li>
<li>Each photo max 5MB</li>
<li>Slug must be unique</li>
<li>Price must be > 0</li>
<li>Property auto-assigned to logged-in agent</li>
</ul>
<hr>
<h3>5.2 UC-05: Input Transaction (Admin)</h3>
<p><strong>Use Case ID:</strong> UC-05  </p>
<p><strong>Use Case Name:</strong> Input Transaction  </p>
<p><strong>Actor:</strong> Admin Master / Admin Kantor  </p>
<p><strong>Priority:</strong> Critical  </p>
<p><strong>Preconditions:</strong></p>
<ul>
<li>Admin sudah login</li>
<li>Ada property dengan status available/pending</li>
</ul>
<p><strong>Main Flow:</strong></p>
<p>1. Admin memilih menu "Create Transaction"</p>
<p>2. System menampilkan form transaction</p>
<p>3. Admin select property dari dropdown</p>
<p>4. System auto-fill agent owner dari property</p>
<p>5. Admin optionally select agent buyer</p>
<p>6. Admin input buyer information:</p>
<ul>
<li>Nama, phone, email</li>
</ul>
<p>7. Admin input transaction details:</p>
<ul>
<li>Transaction type (sale/rent)</li>
<li>Final price</li>
<li>Commission % (default 2%)</li>
<li>Transaction date</li>
</ul>
<p>8. System calculate commission preview</p>
<ul>
<li>««include»» UC-05a: Calculate Commission</li>
</ul>
<p>9. Admin review commission split</p>
<p>10. Admin confirm & submit</p>
<p>11. System saves transaction</p>
<p>12. System generates commission records</p>
<ul>
<li>««include»» UC-05b: Generate Commissions</li>
</ul>
<p>13. System updates property status to sold/rented</p>
<p>14. System logs transaction</p>
<p>15. System sends notifications to involved agents</p>
<p>16. System shows success message</p>
<p><strong>Alternative Flows:</strong></p>
<ul>
<li><strong>3a. No Available Property:</strong></li>
<li>System shows "No properties available"</li>
<li>Process ends</li>
<li><strong>9a. Admin Override Commission %:</strong></li>
<li>Admin changes commission percentage</li>
<li>System recalculates</li>
<li>Continue to step 10</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li>Transaction tersimpan</li>
<li>Commission records created with status "pending"</li>
<li>Property status updated</li>
<li>Agents receive notifications</li>
<li>Activity log recorded</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Agent buyer must be different from agent owner</li>
<li>Commission % must be > 0</li>
<li>Final price can be different from listing price</li>
<li>Commission split: 70/30 (1 agent) or 35/35/30 (2 agents)</li>
</ul>
<hr>
<h3>5.3 UC-27: Search Properties (Buyer)</h3>
<p><strong>Use Case ID:</strong> UC-27  </p>
<p><strong>Use Case Name:</strong> Search Properties  </p>
<p><strong>Actor:</strong> Buyer (Public)  </p>
<p><strong>Priority:</strong> Critical  </p>
<p><strong>Preconditions:</strong></p>
<ul>
<li>None (public access)</li>
</ul>
<p><strong>Main Flow:</strong></p>
<p>1. Buyer opens marketplace page</p>
<p>2. Buyer enters search keyword in search box</p>
<p>3. Buyer optionally applies filters</p>
<ul>
<li>««include»» UC-28: Filter Properties</li>
</ul>
<p>4. System searches database</p>
<ul>
<li>Match: title, description, address (FULLTEXT)</li>
<li>Filter by: type, price, location, listing_type</li>
<li>Only show: is_public = true, status = available/pending</li>
</ul>
<p>5. System returns paginated results (20 per page)</p>
<p>6. System displays results with:</p>
<ul>
<li>Cover photo, title, price, location, agent name</li>
</ul>
<p>7. Buyer clicks on property card</p>
<p>8. System redirects to property detail page</p>
<ul>
<li>««continue»» UC-29: View Property Detail</li>
</ul>
<p><strong>Alternative Flows:</strong></p>
<ul>
<li><strong>5a. No Results Found:</strong></li>
<li>System shows "No properties found"</li>
<li>Suggest remove some filters</li>
<li><strong>3a. Save Search Filters to URL:</strong></li>
<li>System updates URL with filter params</li>
<li>URL is shareable</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li>Search results displayed</li>
<li>View count not incremented (only on detail view)</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Only show properties with is_public = true</li>
<li>Hide properties with status = sold/rented</li>
<li>Search is case-insensitive</li>
<li>Results sorted by: published_at DESC (newest first)</li>
<li>Debounce search input (300ms)</li>
</ul>
<hr>
<h3>5.4 UC-13A: Review Property Submission (Admin Kantor)</h3>
<p><strong>Use Case ID:</strong> UC-13A  </p>
<p><strong>Use Case Name:</strong> Review Property Submission  </p>
<p><strong>Actor:</strong> Admin Kantor  </p>
<p><strong>Priority:</strong> Critical  </p>
<p><strong>Preconditions:</strong></p>
<ul>
<li>Admin Kantor sudah login</li>
<li>Ada property dengan status <code>approval_status = PENDING</code></li>
</ul>
<p><strong>Main Flow:</strong></p>
<p>1. Admin Kantor akses menu "Property Approvals"</p>
<p>2. System menampilkan list properties dengan status PENDING</p>
<p>3. Admin Kantor select property untuk di-review</p>
<p>4. System menampilkan property detail lengkap</p>
<p>5. Admin Kantor review property:</p>
<ul>
<li>Check title, description, photos, price</li>
<li>Validate data quality</li>
</ul>
<p>6. Admin Kantor memutuskan action:</p>
<ul>
<li><strong>Option A: Approve</strong> → Go to step 7</li>
<li><strong>Option B: Decline</strong> → Go to step 10</li>
<li><strong>Option C: Request Revision</strong> → Go to step 13</li>
</ul>
<p><strong>Flow A - Approve:</strong></p>
<p>7. Admin Kantor klik "Approve"</p>
<p>8. System updates <code>approval_status = PUBLISHED</code></p>
<p>9. System records:</p>
<ul>
<li><code>reviewed_by = current_admin_id</code></li>
<li><code>reviewed_at = now()</code></li>
<li><code>published_at = now()</code></li>
</ul>
<p>10. System logs approval action</p>
<p>11. System sends email notification ke Agent:</p>
<ul>
<li>"Your property [title] has been approved!"</li>
</ul>
<p>12. Property sekarang bisa tampil di public marketplace</p>
<p>13. End</p>
<p><strong>Flow B - Decline:</strong></p>
<p>10. Admin Kantor klik "Decline"</p>
<p>11. System shows confirm dialog</p>
<p>12. Admin Kantor confirm</p>
<p>13. System updates <code>approval_status = DECLINED</code></p>
<p>14. System records <code>reviewed_by</code> & <code>reviewed_at</code></p>
<p>15. System logs decline action</p>
<p>16. System sends email notification ke Agent:</p>
<ul>
<li>"Your property [title] has been declined"</li>
</ul>
<p>17. Property tidak bisa di-resubmit (permanently declined)</p>
<p>18. End</p>
<p><strong>Flow C - Request Revision:</strong></p>
<p>13. Admin Kantor klik "Request Revision"</p>
<p>14. System menampilkan textarea untuk revision notes</p>
<p>15. Admin Kantor input revision notes (required):</p>
<ul>
<li>Apa yang perlu diperbaiki</li>
<li>Detail yang salah/kurang</li>
</ul>
<p>16. Admin Kantor submit</p>
<p>17. System validates notes tidak kosong</p>
<p>18. System updates <code>approval_status = NEED_REVISION</code></p>
<p>19. System saves revision notes ke <code>revision_notes</code> field</p>
<p>20. System records <code>reviewed_by</code> & <code>reviewed_at</code></p>
<p>21. System logs revision request</p>
<p>22. System sends email notification ke Agent:</p>
<ul>
<li>"Your property [title] needs revision"</li>
<li>Include revision notes</li>
</ul>
<p>23. Agent bisa edit property & resubmit</p>
<p>24. End</p>
<p><strong>Alternative Flows:</strong></p>
<ul>
<li><strong>17a. Revision Notes Kosong:</strong></li>
<li>System shows error "Please provide revision notes"</li>
<li>Return to step 15</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li>Property approval status updated</li>
<li>Agent notified via email</li>
<li>Activity logged</li>
<li>Dashboard metrics updated</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Admin Kantor hanya bisa approve property di kantornya</li>
<li>Admin Master bisa approve property di semua kantor</li>
<li>Approval action cannot be undone</li>
<li>Declined property perlu create new (tidak bisa resubmit)</li>
<li>NEED_REVISION property bisa unlimited resubmit</li>
</ul>
<hr>
<h3>5.5 UC-30: Fill Visitor Form (Buyer via Private Link)</h3>
<p><strong>Use Case ID:</strong> UC-30  </p>
<p><strong>Use Case Name:</strong> Fill Visitor Form (Lead Capture)  </p>
<p><strong>Actor:</strong> Buyer (Public Visitor)  </p>
<p><strong>Priority:</strong> High  </p>
<p><strong>Preconditions:</strong></p>
<ul>
<li>Visitor mendapat private link dari Agent (via WhatsApp/Email)</li>
<li>Link masih valid (belum expired)</li>
</ul>
<p><strong>Main Flow:</strong></p>
<p>1. Visitor klik private link: <code>/property/{slug}?token={token}</code></p>
<p>2. System validates token:</p>
<ul>
<li>Check token exists</li>
<li>Check token not expired</li>
<li>Check token not used (if single-use)</li>
</ul>
<p>3. System redirect ke Visitor Form page</p>
<p>4. System menampilkan form dengan fields:</p>
<ul>
<li>Nama lengkap (required)</li>
<li>Email (required)</li>
<li>Nomor telepon (optional)</li>
<li>WhatsApp number (optional)</li>
<li>Interest level (dropdown, required):</li>
<li>Low - Hanya lihat-lihat</li>
<li>Medium - Cukup tertarik</li>
<li>High - Sangat tertarik</li>
<li>Very High - Siap beli/nego</li>
<li>Message/notes (textarea, optional)</li>
</ul>
<p>5. Visitor mengisi form</p>
<p>6. Visitor submit form</p>
<p>7. System validates form:</p>
<ul>
<li>Nama & email required</li>
<li>Email format valid</li>
<li>Check duplicate: same email+property dalam 24 jam</li>
</ul>
<p>8. System saves data ke <code>property_visitors</code> table:</p>
<ul>
<li>property_link_id</li>
<li>property_id</li>
<li>visitor_name, email, phone, whatsapp</li>
<li>interest_level, message</li>
<li>visited_at = now()</li>
<li>ip_address, user_agent</li>
</ul>
<p>9. System increments <code>access_count</code> di <code>property_links</code></p>
<p>10. System checks interest level:</p>
<ul>
<li>If HIGH or VERY_HIGH → Send real-time notification ke Agent</li>
</ul>
<p>11. System logs visitor access</p>
<p>12. System redirect ke Property Detail page</p>
<p>13. Visitor bisa lihat property lengkap (photos, description, location)</p>
<p>14. End</p>
<p><strong>Alternative Flows:</strong></p>
<ul>
<li><strong>2a. Token Invalid/Expired:</strong></li>
<li>System shows "Link expired or invalid"</li>
<li>Provide contact agent button</li>
<li>End</li>
<li><strong>2b. Token Already Used (single-use):</strong></li>
<li>System shows "Link already used"</li>
<li>End</li>
<li><strong>7a. Validation Error:</strong></li>
<li>System shows error messages</li>
<li>Return to step 5</li>
<li><strong>7b. Duplicate Submission:</strong></li>
<li>System shows "You already submitted this form today"</li>
<li>Auto-redirect ke Property Detail</li>
<li>Skip steps 8-11</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li>Visitor data tersimpan (lead captured)</li>
<li>Agent notified (if HIGH/VERY_HIGH interest)</li>
<li>Property access tracked</li>
<li>Visitor can view property detail</li>
</ul>
<p><strong>Business Rules:</strong></p>
<ul>
<li>Form wajib diisi untuk akses private link</li>
<li>Duplicate prevention: 1 email per property per 24 jam</li>
<li>HIGH/VERY_HIGH interest trigger agent notification</li>
<li>Visitor data used for follow-up & marketing</li>
<li>IP & user agent tracked for security</li>
</ul>
<p><strong>Notification Logic:</strong></p>
<pre><code>if (interest_level === 'high' || interest_level === 'very_high') {
    notify_agent_email();
    notify_agent_dashboard();
    priority_lead = true;
}
</code></pre>
<hr>
<h2>6. Use Case Relationships</h2>
<h3>6.1 Include Relationships</h3>
<table>
<thead>
<tr>
<th>Base Use Case</th>
<th>Includes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>UC-21: Create Property</td>
<td>UC-21a: Upload Photos</td>
<td>Wajib upload minimal 1 foto</td>
</tr>
<tr>
<td>UC-21: Create Property</td>
<td>UC-21b: Validate Data</td>
<td>Wajib validasi sebelum save</td>
</tr>
<tr>
<td>UC-05: Input Transaction</td>
<td>UC-05a: Calculate Commission</td>
<td>Auto-calculate saat input</td>
</tr>
<tr>
<td>UC-05: Input Transaction</td>
<td>UC-05b: Generate Commission Records</td>
<td>Auto-create records</td>
</tr>
<tr>
<td>UC-27: Search Properties</td>
<td>UC-28: Filter Properties</td>
<td>Filter applied during search</td>
</tr>
<tr>
<td>UC-29: View Property Detail</td>
<td>UC-29a: Increment View Counter</td>
<td>Auto-increment views</td>
</tr>
<tr>
<td>UC-31: Access Private Link</td>
<td>UC-31a: Validate Token</td>
<td>Check token validity</td>
</tr>
<h3>6.2 Extend Relationships</h3>
<tr>
<td>Base Use Case</td>
<td>Extends</td>
<td>Condition</td>
</tr>
<tr>
<td>UC-07: View Dashboard</td>
<td>UC-07a: Export Report</td>
<td>If user clicks export button</td>
</tr>
<tr>
<td>UC-21: Create Property</td>
<td>UC-21c: Generate Private Link</td>
<td>If user wants private link</td>
</tr>
<tr>
<td>UC-24: View Dashboard</td>
<td>UC-24a: Download Excel</td>
<td>If user wants export</td>
</tr>
<tr>
<td>UC-29: View Property Detail</td>
<td>UC-29b: View Map</td>
<td>If property has lat/long</td>
</tr>
<h3>6.3 Generalization</h3>
<pre><code>           ○ Manage User
                │
        ┌───────┴───────┐
        │               │
○ Manage Admin     ○ Manage Agent
        │
    ┌───┴───┐
    │       │
○ Create  ○ Edit
</code></pre>
</tbody>
</table>
<h2>7. Use Case Priority Matrix</h2>
<h3>7.1 Critical Use Cases (Must Have for MVP)</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Use Case</th>
<th>Actor</th>
<th>Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td>UC-01</td>
<td>Login</td>
<td>All</td>
<td>-</td>
</tr>
<tr>
<td>UC-02</td>
<td>Manage Offices</td>
<td>Admin Master</td>
<td>UC-01</td>
</tr>
<tr>
<td>UC-03</td>
<td>Manage Agents</td>
<td>Admin Master/Kantor</td>
<td>UC-02</td>
</tr>
<tr>
<td>UC-21</td>
<td>Create Property</td>
<td>Agen</td>
<td>UC-01</td>
</tr>
<tr>
<td>UC-27</td>
<td>Search Properties</td>
<td>Buyer</td>
<td>-</td>
</tr>
<tr>
<td>UC-29</td>
<td>View Property Detail</td>
<td>Buyer</td>
<td>UC-27</td>
</tr>
<tr>
<td>UC-30</td>
<td>Contact Agent</td>
<td>Buyer</td>
<td>UC-29</td>
</tr>
<tr>
<td>UC-05</td>
<td>Input Transaction</td>
<td>Admin</td>
<td>UC-21</td>
</tr>
<tr>
<td>UC-05a</td>
<td>Calculate Commission</td>
<td>System</td>
<td>UC-05</td>
</tr>
<tr>
<td>UC-24</td>
<td>View Personal Dashboard</td>
<td>Agen</td>
<td>UC-01</td>
</tr>
<h3>7.2 High Priority (Should Have)</h3>
<tr>
<td>ID</td>
<td>Use Case</td>
<td>Actor</td>
<td>Phase</td>
</tr>
<tr>
<td>UC-13</td>
<td>Manage Office Properties</td>
<td>Admin Kantor</td>
<td>Sprint 2</td>
</tr>
<tr>
<td>UC-15</td>
<td>Manage Commissions</td>
<td>Admin Kantor</td>
<td>Sprint 4</td>
</tr>
<tr>
<td>UC-16</td>
<td>View Office Dashboard</td>
<td>Admin Kantor</td>
<td>Sprint 5</td>
</tr>
<tr>
<td>UC-31</td>
<td>Access Private Link</td>
<td>Buyer</td>
<td>Sprint 3</td>
</tr>
<tr>
<td>UC-17</td>
<td>View Activity Log</td>
<td>Admin</td>
<td>Sprint 5</td>
</tr>
<h3>7.3 Medium Priority (Nice to Have - Phase 2)</h3>
<tr>
<td>ID</td>
<td>Use Case</td>
<td>Actor</td>
<td>Phase</td>
</tr>
<tr>
<td>UC-09</td>
<td>Manage System Settings</td>
<td>Admin Master</td>
<td>Phase 2</td>
</tr>
<tr>
<td>UC-07a</td>
<td>Export Reports</td>
<td>Admin</td>
<td>Phase 2</td>
</tr>
<tr>
<td>UC-32</td>
<td>Register Buyer Account</td>
<td>Buyer</td>
<td>Phase 2</td>
</tr>
<tr>
<td>UC-37</td>
<td>Send Email Notifications</td>
<td>System</td>
<td>Phase 2</td>
</tr>
</tbody>
</table>
<h2>8. Actor Permission Matrix</h2>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Admin Master</th>
<th>Admin Kantor</th>
<th>Agen</th>
<th>Buyer</th>
<th>System</th>
</tr>
</thead>
<tbody>
<tr>
<td>Login</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>⚪</td>
<td>❌</td>
</tr>
<tr>
<td>Manage Offices</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Manage Agents</td>
<td>✅</td>
<td>✅ (own)</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Create Property</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Edit Property</td>
<td>✅ (all)</td>
<td>✅ (office)</td>
<td>✅ (own)</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Delete Property</td>
<td>✅</td>
<td>✅</td>
<td>✅ (own)</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Browse Marketplace</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Search Properties</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>View Property Detail</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Contact Agent</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Input Transaction</td>
<td>✅</td>
<td>✅ (office)</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>View Commissions</td>
<td>✅ (all)</td>
<td>✅ (office)</td>
<td>✅ (own)</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Mark Commission Paid</td>
<td>✅</td>
<td>✅ (office)</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>View Dashboard</td>
<td>✅ (master)</td>
<td>✅ (office)</td>
<td>✅ (personal)</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>View Activity Log</td>
<td>✅ (all)</td>
<td>✅ (office)</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Auto-Expire Links</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>Send Notifications</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>✅ Full Access</li>
<li>✅ (scope) Limited Access</li>
<li>⚪ Optional (if implemented)</li>
<li>❌ No Access</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Status:</strong> Ready for Development Reference</p>
</div>

<div class="content-section page-break" id="section-6">
<h1>BAB 6: Activity Diagrams & Business Process Flows</h1>

<p><strong>Dokumen Activity Diagrams (Business Process Flows)</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Activity Diagram Overview</h2>
<p>Activity Diagram menunjukkan alur aktivitas/proses bisnis dari awal hingga akhir, dengan decision points dan parallel activities.</p>
<p><strong>Notasi:</strong></p>
<ul>
<li><strong>Start (●)</strong> - Titik mulai</li>
<li><strong>End (◉)</strong> - Titik selesai</li>
<li><strong>Activity [□]</strong> - Aksi/proses</li>
<li><strong>Decision {◇}</strong> - Decision point (if/else)</li>
<li><strong>Fork/Join (═)</strong> - Parallel activities</li>
<li><strong>Swimlane (│)</strong> - Responsibility area per actor</li>
</ul>
<hr>
<h2>2. Activity Diagram: End-to-End Property Listing to Sale</h2>
<pre><code>═══════════════════════════════════════════════════════════════════════════
SWIMLANE: AGEN          │  SYSTEM         │  BUYER      │  ADMIN KANTOR
═══════════════════════════════════════════════════════════════════════════

    ●  START                │                │             │
    │                       │                │             │
    ▼                       │                │             │
[Login ke Sistem]          │                │             │
    │                       │                │             │
    ▼                       │                │             │
[Create New Property]      │                │             │
    │                       │                │             │
    ▼                       │                │             │
[Input Data Properti]      │                │             │
(Judul, harga, deskripsi)  │                │             │
    │                       │                │             │
    ▼                       │                │             │
[Upload Foto (max 10)]     │                │             │
    │                       │                │             │
    ▼                       ▼                │             │
[Submit Form]          [Validate Data]      │             │
    │                       │                │             │
    │                       ▼                │             │
    │                  {Valid?}              │             │
    │                    /    \              │             │
    │               [No]      [Yes]          │             │
    │                /            \          │             │
    ◀──[Error Msg]──              │         │             │
    │                              ▼         │             │
    │                    [Optimize Photos]   │             │
    │                    (Resize & Compress) │             │
    │                              │         │             │
    │                              ▼         │             │
    │                    [Generate Slug]     │             │
    │                              │         │             │
    │                              ▼         │             │
    │                    [Save to Database]  │             │
    │                              │         │             │
    │                              ▼         │             │
    │                    {Publish Mode?}     │             │
    │                      /          \      │             │
    │                [Public]      [Private]│             │
    │                  /                \    │             │
    │                 ▼                  ▼   │             │
    │      [Set is_public=true]  [Set is_public=false]    │
    │      [Set published_at]    [Generate Token Link]    │
    │                  │                  │  │             │
    │                  └─────────┬────────┘  │             │
    │                            ▼            │             │
    │                    [Log Activity]       │             │
    │                            │            │             │
    │                            ▼            │             │
    │                    [Send Notification]──────────────▶│
    ◀──[Success Msg]────                     │             │
    │                                         │             ▼
    │                                         │    [Receive Notification]
    │                                         │             │
    │                                         │             ▼
    │                                         │    {Approve/Reject?}
    │                                         │       /        \
    │                                         │  [Approve]  [Reject]
    │                                         │     /            \
    │                                         ▼    ▼              ▼
    │                                    [Set Status]     [Send Reason]
    │                                    [Approved]             │
    │                                         │                 ▼
    │◀────[Notification: Approved]────────────┘         [Notify Agen]
    │                                         │                 │
    │                                         ▼                 ◀─┐
    │                              {Property on Marketplace}      │
    │                                         │                   │
    │                                         │                   │
    │                                         ▼                   │
    ┼─────────────────────────────────────────┼───────────────────┼───
    │                                         │                   │
    │                                         │  ● Buyer START    │
    │                                         │        │          │
    │                                         │        ▼          │
    │                                         │  [Browse Listings]│
    │                                         │        │          │
    │                                         │        ▼          │
    │                                         │  [Search & Filter]│
    │                                         │        │          │
    │                                         │        ▼          │
    │                                         ▼  [View Detail]   │
    │                                [Query Database]│           │
    │                                         │      ▼           │
    │                                         │ [Display Info]   │
    │                                         │      │           │
    │                                         │      ▼           │
    │                                         │ {Interested?}    │
    │                                         │   /      \       │
    │                                         │[No]      [Yes]   │
    │                                         │ /          \     │
    │                                         ▼◉         [Contact Agent]
    │                                         END           │    │
    │                                                       ▼    │
    │                                              [Open WhatsApp]
    │                                                       │    │
    │                                                       ▼    │
    │◀──────────[Buyer Contact via WA]────────────────────────┘│
    │                                                            │
    │ (Negotiation happens externally)                          │
    │                                                            │
    ▼                                                            │
[Deal Reached]                                                  │
    │                                                            │
    ▼                                                            │
[Inform Admin Kantor]──────────────────────────────────────────▶│
    │                                                            ▼
    │                                                   [Input Transaction]
    │                                                            │
    │                                                            ▼
    │                          ┌────────────────────[Select Property]
    │                          │                                 │
    │                          │                                 ▼
    │                          │                    [Auto-fill Agent Owner]
    │                          │                                 │
    │                          │                                 ▼
    │                          │                    [Input Buyer Info]
    │                          │                                 │
    │                          │                                 ▼
    │                          │                    [Input Final Price]
    │                          │                                 │
    │                          │                                 ▼
    │                          ▼                    [Calculate Commission]
    │                   [Commission Preview]                     │
    │                          │                                 ▼
    │                          │                        {Commission OK?}
    │                          │                          /          \
    │                          │                     [Yes]          [No]
    │                          │                      /                \
    │                          │                     ▼                  ▼
    │                          │              [Save Transaction]  [Adjust %]
    │                          │                     │                  │
    │                          │                     ▼                  │
    │                          │           [Generate Commissions]◀──────┘
    │                          │                     │
    │                          │     ┌───────────────┼───────────────┐
    │                          │     │               │               │
    │                          │     ▼               ▼               ▼
    │                          │ [Comm Agent]  [Comm Buyer]  [Comm Office]
    │                          │     │               │               │
    │                          │     └───────────────┼───────────────┘
    │                          │                     │
    │                          │                     ▼
    │                          │          [Update Property Status]
    │                          │          (Status → Sold/Rented)
    │                          │                     │
    │                          │                     ▼
    │                          │             [Log Activity]
    │                          │                     │
    │                          │                     ▼
    │                          │          [Send Notifications]
    │                          │            /              \
    │                          │           ▼                ▼
    │◀──[Notif: Property Sold]─┘     [To Agen Owner]  [To Agen Buyer]
    │                                                       │
    ▼                                                       ▼
[View Dashboard]                                    [View Dashboard]
    │                                                       │
    ▼                                                       ▼
[See Pending Commission]                        [See Pending Commission]
    │                                                       │
    │                                                       │
    │        (Later: Admin marks as Paid)                   │
    │                      │                                │
    │                      ▼                                │
    │             [Mark Commission as Paid]◀────────────────┘
    │                      │                                │
    │                      ▼                                │
    │           [Set status = paid]                         │
    │           [Set paid_date]                             │
    │                      │                                │
    │                      ▼                                │
    │           [Send Payment Notification]                 │
    │                  /          \                         │
    │                 ▼            ▼                        │
    │◀──[Email Notif]   [Dashboard Notif]──────────────────▶│
    │                                                        │
    ▼                                                        ▼
[See Paid Commission]                          [See Paid Commission]
    │                                                        │
    ▼                                                        ▼
   ◉  END                                                  ◉  END
</code></pre>
<hr>
<h2>3. Flowchart: Commission Calculation Logic</h2>
<pre><code>                    ● START
                    │
                    ▼
        ┌───────────────────────────┐
        │ Get Transaction Data      │
        │ • Final Price             │
        │ • Commission %            │
        │ • Agent Owner ID          │
        │ • Agent Buyer ID (or null)│
        └─────────────┬─────────────┘
                      │
                      ▼
        ┌───────────────────────────┐
        │ Calculate Total Commission│
        │ total = price × comm_%    │
        └─────────────┬─────────────┘
                      │
                      ▼
                {Agent Buyer exists?}
                  /              \
             [YES]              [NO]
              /                    \
             ▼                      ▼
┌──────────────────────┐  ┌──────────────────────┐
│ SCENARIO A: 2 Agents │  │ SCENARIO B: 1 Agent  │
├──────────────────────┤  ├──────────────────────┤
│ Agent Owner: 35%     │  │ Agent Owner: 70%     │
│ Agent Buyer: 35%     │  │ Office: 30%          │
│ Office: 30%          │  │                      │
└──────────┬───────────┘  └──────────┬───────────┘
           │                         │
           ▼                         ▼
   ┌──────────────┐          ┌──────────────┐
   │ Create 3     │          │ Create 2     │
   │ Commission   │          │ Commission   │
   │ Records      │          │ Records      │
   └──────┬───────┘          └──────┬───────┘
          │                         │
          └────────────┬────────────┘
                       │
                       ▼
           ┌───────────────────────┐
           │ Save to commissions   │
           │ table with status     │
           │ = 'pending'           │
           └─────────┬─────────────┘
                     │
                     ▼
           ┌───────────────────────┐
           │ Return Commission     │
           │ Records Array         │
           └─────────┬─────────────┘
                     │
                     ▼
                    ◉ END
</code></pre>
<p><strong>Sample Output:</strong></p>
<pre><code>// Scenario A (2 Agents): Rp 1M, 2% commission
[
  {
    "agent_id": 3,
    "amount": 7000000,
    "percentage": 35,
    "type": "agent_owner"
  },
  {
    "agent_id": 5,
    "amount": 7000000,
    "percentage": 35,
    "type": "agent_buyer"
  },
  {
    "office_id": 1,
    "amount": 6000000,
    "percentage": 30,
    "type": "office"
  }
]
</code></pre>
<hr>
<h2>4. Flowchart: Public vs Private Property Access</h2>
<pre><code>                        ● Buyer START
                             │
                             ▼
                    {Access Method?}
                      /            \
            [Public URL]          [Private URL with Token]
                  /                        \
                 ▼                          ▼
    ┌─────────────────────┐    ┌─────────────────────────┐
    │ Access Marketplace  │    │ Extract Token from URL  │
    │ (No Auth Required)  │    │                         │
    └──────────┬──────────┘    └──────────┬──────────────┘
               │                           │
               ▼                           ▼
    [Query: is_public=true]     ┌──────────────────────┐
    [AND status=available]      │ Validate Token       │
               │                 │ • Exists?            │
               ▼                 │ • Not expired?       │
    [Display Listings]           │ • Not fully used?    │
               │                 └──────────┬───────────┘
               ▼                            │
    {Select Property?}              {Token Valid?}
         /      \                      /         \
    [No]       [Yes]               [No]         [Yes]
      │          │                  │             │
      ▼          ▼                  ▼             ▼
     END   [Click Detail]   [Show Error]  [Increment Access]
               │             • Link Expired       │
               │             • Already Used       ▼
               │                  │        [Load Property]
               │                  ▼               │
               │                 END              │
               │                                  │
               └──────────────┬───────────────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │ Display Property     │
                   │ Detail Page          │
                   │ • Photos Gallery     │
                   │ • Description        │
                   │ • Price & Specs      │
                   │ • Agent Contact      │
                   └──────────┬───────────┘
                              │
                              ▼
                   [Increment views_count]
                              │
                              ▼
                   {Interested to Contact?}
                         /         \
                    [No]           [Yes]
                      │              │
                      ▼              ▼
                     END    ┌───────────────┐
                            │ Click WA/Phone│
                            │ Button        │
                            └───────┬───────┘
                                    │
                                    ▼
                            [Open WhatsApp]
                            (Pre-filled message)
                                    │
                                    ▼
                            [Contact Agent]
                            (External to system)
                                    │
                                    ▼
                                   ◉ END
</code></pre>
<hr>
<h2>5. Activity Diagram: Transaction & Commission Flow</h2>
<pre><code>═══════════════════════════════════════════════════════════════════════════
SWIMLANE: ADMIN KANTOR  │  SYSTEM               │  AGEN OWNER  │  AGEN BUYER
═══════════════════════════════════════════════════════════════════════════

    ● START                 │                      │             │
    │                       │                      │             │
    ▼                       │                      │             │
[Login to Admin Panel]     │                      │             │
    │                       │                      │             │
    ▼                       │                      │             │
[Navigate to Transactions] │                      │             │
    │                       │                      │             │
    ▼                       │                      │             │
[Click "New Transaction"]  │                      │             │
    │                       │                      │             │
    ▼                       ▼                      │             │
[Select Property]      [Load Available]           │             │
                       [Properties List]           │             │
    │                       │                      │             │
    ▼                       ▼                      │             │
[Property Selected]    [Auto-fill Agent Owner]────────────────▶│
    │                       │                                    │
    ▼                       │                                    │
{Need Agent Buyer?}         │                                    │
   /        \               │                                    │
[No]       [Yes]            │                                    │
  │          │               │                                    │
  │          ▼               │                                    │
  │   [Select Agent Buyer]──────────────────────────────────────────────▶│
  │          │               │                                    │       │
  └──────────┼───────────────┤                                    │       │
             │               │                                    │       │
             ▼               │                                    │       │
[Input Buyer Info]          │                                    │       │
(Name, phone, email)        │                                    │       │
             │               │                                    │       │
             ▼               │                                    │       │
[Input Transaction Details] │                                    │       │
• Type (sale/rent)          │                                    │       │
• Final price               │                                    │       │
• Commission % (default 2%) │                                    │       │
• Transaction date          │                                    │       │
             │               │                                    │       │
             ▼               ▼                                    │       │
[Submit]         ┌──────────────────────┐                       │       │
                 │ Calculate Commission │                       │       │
                 │ (CommissionService)  │                       │       │
                 └──────────┬───────────┘                       │       │
                            │                                    │       │
                            ▼                                    │       │
                  {How many agents?}                            │       │
                      /          \                               │       │
                  [1 Agent]    [2 Agents]                       │       │
                    /              \                             │       │
                   ▼                ▼                            │       │
        ┌──────────────┐  ┌──────────────────┐                 │       │
        │ Split 70/30  │  │ Split 35/35/30   │                 │       │
        └──────┬───────┘  └──────┬───────────┘                 │       │
               │                 │                              │       │
               └────────┬────────┘                              │       │
                        │                                       │       │
                        ▼                                       │       │
              [Display Preview]                                 │       │
              • Agent Owner: Rp X                               │       │
              • Agent Buyer: Rp Y (if any)                      │       │
              • Office: Rp Z                                    │       │
                        │                                       │       │
◀──[Review Preview]─────┘                                       │       │
    │                                                            │       │
    ▼                                                            │       │
{Confirm?}                                                       │       │
  /    \                                                         │       │
[No]  [Yes]                                                      │       │
 │      │                                                        │       │
 │      ▼                                                        │       │
 │  [Save Transaction]                                           │       │
 │      │                                                        │       │
 │      ▼                                                        │       │
 │  [Create Commission Records]                                  │       │
 │      │  ════════════════════════════                          │       │
 │      │  ║ Parallel Execution      ║                          │       │
 │      ▼  ════════════════════════════                          │       │
 │   ┌──────────┬──────────┬──────────┐                         │       │
 │   ▼          ▼          ▼          ▼                          │       │
 │[Comm 1]  [Comm 2]  [Comm 3]  [Update Status]                  │       │
 │(Agent)   (Agent)  (Office)   (Sold/Rented)                    │       │
 │   │          │          │          │                           │       │
 │   └──────────┴──────────┴──────────┘                          │       │
 │              │                                                  │       │
 │              ▼                                                  │       │
 │      [Log to Activity Log]                                     │       │
 │              │                                                  │       │
 │              ▼                                                  │       │
 │      [Send Notifications]                                      │       │
 │        /           \                                            │       │
 │       ▼             ▼                                           │       │
 │ [To Agent Owner] [To Agent Buyer]─────────────────────────────▶│──────▶│
 │                                                                 ▼       ▼
 ▼                                                    [Notif Received] [Notif]
[Success Message]                                               │       │
 │                                                               ▼       ▼
 ▼                                                      [View Dashboard]  │
◉ Admin END                                                     │       │
                                                                 ▼       ▼
                                                    [See Pending Commission]
                                                                 │       │
                                                                 ▼       ▼
                                                                ◉ END   ◉ END
</code></pre>
<hr>
<h2>6. Activity Diagram: Mark Commission as Paid</h2>
<pre><code>═══════════════════════════════════════════════════════════════
SWIMLANE: ADMIN KANTOR  │  SYSTEM         │  AGEN
═══════════════════════════════════════════════════════════════

    ● START                 │                │
    │                       │                │
    ▼                       │                │
[Navigate to Commissions]  │                │
    │                       │                │
    ▼                       ▼                │
[Filter: Pending Only] [Query Pending]      │
                       [Commissions]         │
    │                       │                │
    ▼                       ▼                │
[Display List]         [Show List]          │
    │                       │                │
    ▼                       │                │
[Select Commission]        │                │
    │                       │                │
    ▼                       │                │
[Click "Mark as Paid"]     │                │
    │                       │                │
    ▼                       ▼                │
[Input Payment Details][Validate Input]     │
• Paid Date                 │                │
• Payment Method            │                │
• Notes                     │                │
    │                       ▼                │
    │                  {Valid?}              │
    │                   /    \               │
    │              [No]      [Yes]           │
    │               /            \           │
    ◀─[Error]─────              │           │
    │                            ▼           │
    │                    [Update Status]     │
    │                    • status = 'paid'   │
    │                    • paid_date = input │
    │                    • notes = input     │
    │                            │           │
    │                            ▼           │
    │                    [Log Activity]      │
    │                    (Audit Trail)       │
    │                            │           │
    │                            ▼           │
    │                  [Send Notification]───────────▶│
    ◀─[Success Msg]────                              │
    │                                                  ▼
    ▼                                        [Receive Notif]
   ◉ END                                              │
                                                      ▼
                                            [Check Dashboard]
                                                      │
                                                      ▼
                                            [See Paid Commission]
                                                      │
                                                      ▼
                                                     ◉ END
</code></pre>
<hr>
<h2>7. Activity Diagram: Property Moderation/Approval Workflow</h2>
<pre><code>═══════════════════════════════════════════════════════════════════════════
SWIMLANE: AGEN          │  SYSTEM         │  ADMIN KANTOR │  NOTIFICATION
═══════════════════════════════════════════════════════════════════════════

    ● START                │                │               │
    │                      │                │               │
    ▼                      │                │               │
[Create Property]         │                │               │
    │                      │                │               │
    ▼                      │                │               │
[Input Data: Title,       │                │               │
 Description, Price,      │                │               │
 Photos, etc.]            │                │               │
    │                      │                │               │
    ▼                      ▼                │               │
[Click Button]    [Set approval_status]    │               │
    │             = 'DRAFT'                 │               │
    │                      │                │               │
    │                      ▼                │               │
    │             [Save to Database]        │               │
    │                      │                │               │
    ◀──[Success: Draft]────┘                │               │
    │                                        │               │
    ▼                                        │               │
{Ready to Submit?}                          │               │
  /           \                             │               │
[No]          [Yes]                         │               │
 │             │                             │               │
 ▼             │                             │               │
[Edit Later]  │                             │               │
 │             │                             │               │
 ◉ END         ▼                             │               │
[Click "Submit for Approval"]               │               │
              │                              │               │
              ▼                              │               │
              │            ┌─────────────────┐               │
              │            │ VALIDATION:     │               │
              │            │ - Min 1 photo   │               │
              │            │ - Title filled  │               │
              │            │ - Price > 0     │               │
              │            └────────┬────────┘               │
              ▼                     ▼                        │
              │            {Valid?}                          │
              │             /      \                         │
              │        [No]        [Yes]                     │
              │         /             \                      │
  ◀───[Error]─┘        │              ▼                      │
  │                    │    [Update approval_status]         │
  ▼                    │    = 'PENDING'                     │
[Fix Issues]          │              │                      │
  │                    │              ▼                      │
  └────────────────────┘    [Set submitted_at = now()]      │
                                     │                      │
                                     ▼                      │
                            [Log Submission Activity]        │
                                     │                      │
                                     ▼                      ▼
                            [Trigger Notification]────▶[Email to Admin]
                                     │               "New submission"
                                     │                      │
                            ┌────────┴────────────────────────────────┐
                            │                                          │
                            │  WAITING FOR ADMIN REVIEW...             │
                            │                                          │
                            └────────┬──────────────────────┬──────────┘
                                     │                      │
                                     │                      ▼
                                     │                [Admin Login]
                                     │                      │
                                     │                      ▼
                                     │             [Open "Approvals" Menu]
                                     │                      │
                                     │                      ▼
                                     │             [View Pending List]
                                     │                      │
                                     │                      ▼
                                     │             [Select Property]
                                     │                      │
                                     │                      ▼
                                     │             [Review Details:
                                     │              Photos, Title,
                                     │              Price, Description]
                                     │                      │
                                     │                      ▼
                                     │              {Decision?}
                                     │           /      |      \
                                     │      [Approve] [Decline] [Revise]
                                     │         /        |          \
                                     │        /         │           \
                          ┌──────────▼───┐   │           │
                          │ APPROVE      │   │           │
                          └──────────────┘   │           │
                          │                  │           │
                          ▼                  │           │
                 [Update status = 'PUBLISHED'] │           │
                          │                  │           │
                          ▼                  │           │
                 [Set reviewed_by = admin_id]│           │
                 [Set reviewed_at = now()]  │           │
                 [Set published_at = now()] │           │
                          │                  │           │
                          ▼                  │           │
                 [Log Approval Activity]    │           │
                          │                  │           │
                          ▼                  ▼           │
                 [Send Notification]───▶[Email: Approved!]
                          │                  │           │
              ◀───────────┘                  │           │
              │                              │           │
              ▼                              │           │
     [Notification Received]                │           │
     "Property Approved!"                   │           │
              │                              │           │
              ▼                              │           │
     [Property NOW on                       │           │
      Public Marketplace]                   │           │
              │                              │           │
              ◉ END                          │           │
                                             │           │
                          ┌──────────────────▼───┐       │
                          │ DECLINE              │       │
                          └──────────────────────┘       │
                          │                              │
                          ▼                              │
                 [Confirm Decline?]                      │
                          │                              │
                       {Yes/No}                          │
                        /     \                          │
                   [No]       [Yes]                      │
                     /           \                       │
           ◀────────┘             ▼                      │
           │            [Update status = 'DECLINED']    │
           │                      │                      │
           │                      ▼                      │
           │            [Set reviewed_by & reviewed_at] │
           │                      │                      │
           │                      ▼                      │
           │            [Log Decline Activity]           │
           │                      │                      │
           │                      ▼                      ▼
           │            [Send Notification]────▶[Email: Declined]
           │                      │                      │
           ◀──────────────────────┘                      │
           │                                             │
           ▼                                             │
  [Notification Received]                               │
  "Property Declined"                                   │
           │                                             │
           ▼                                             │
  [Cannot Resubmit]                                     │
  [Need Create New]                                     │
           │                                             │
           ◉ END                                         │
                                                         │
                          ┌──────────────────────────────▼───┐
                          │ REQUEST REVISION                 │
                          └──────────────────────────────────┘
                          │
                          ▼
                 [Show Revision Notes Form]
                          │
                          ▼
                 [Admin Input Notes:]
                 "Please fix:
                  - Photos too blurry
                  - Price seems high
                  - Missing address"
                          │
                          ▼
                 {Notes filled?}
                    /         \
               [No]           [Yes]
                 /               \
    ◀───[Error]─┘                 ▼
    │                    [Update status = 'NEED_REVISION']
    │                              │
    │                              ▼
    │                    [Save revision_notes]
    │                              │
    │                              ▼
    │                    [Set reviewed_by & reviewed_at]
    │                              │
    │                              ▼
    │                    [Log Revision Request]
    │                              │
    │                              ▼                       ▼
    │                    [Send Notification]────▶[Email: Need Revision
    │                              │             + Revision Notes]
    ◀────────────────────────────┘                       │
    │                                                     │
    ▼                                                     │
[Notification Received]                                 │
"Property Needs Revision"                               │
    │                                                     │
    ▼                                                     │
[Read Revision Notes]                                   │
    │                                                     │
    ▼                                                     │
[Edit Property]                                          │
(Fix issues based on notes)                              │
    │                                                     │
    ▼                                                     │
[Click "Resubmit"]                                       │
    │                                                     │
    ▼                ▼                                    │
    │      [Update status = 'PENDING']                   │
    │                │                                    │
    │                ▼                                    │
    │      [Set submitted_at = now()]                    │
    │                │                                    │
    │                ▼                                    │
    │      [Notify Admin Again]─────────────────────────▶│
    │                │                                    │
    │                │  ┌─────────────────────────────────┘
    │                │  │
    │                └──┼─────────────────┐
    │                   │                 │
    │                   ▼                 │
    │         [Back to PENDING]           │
    │          (Repeat review cycle)      │
    │                                     │
    └─────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════
</code></pre>
<p><strong>Key Points:</strong></p>
<ul>
<li><strong>5 Status:</strong> DRAFT → PENDING → PUBLISHED / DECLINED / NEED_REVISION</li>
<li><strong>Revision Loop:</strong> NEED_REVISION dapat unlimited resubmit</li>
<li><strong>Declined:</strong> Permanent rejection, cannot resubmit</li>
<li><strong>Email Notifications:</strong> Sent at every status change</li>
<li><strong>Activity Log:</strong> All actions tracked for audit</li>
</ul>
<hr>
<h2>8. Flowchart: Visitor Form (Lead Capture via Private Link)</h2>
<pre><code>                    ● START (Visitor)
                          │
                          ▼
            [Visitor Receives Private Link]
            (from WhatsApp/Email)
                          │
                          ▼
            [Click Link: /property/{slug}?token={token}]
                          │
                          ▼
                 ┌────────────────┐
                 │  VALIDATE      │
                 │  TOKEN         │
                 └───────┬────────┘
                         │
                         ▼
                  {Token Valid?}
                   /          \
              [No]             [Yes]
               /                  \
              ▼                    ▼
    ┌─────────────────┐   [Redirect to Visitor Form]
    │ ERROR PAGE:      │            │
    │ "Link Expired"   │            ▼
    │ or               │   [Show Form Fields:]
    │ "Link Invalid"   │   - Nama (required)
    │                  │   - Email (required)
    │ [Contact Agent]  │   - Phone (optional)
    │                  │   - WhatsApp (optional)
    └─────────◉────────┘   - Interest Level:
         END                  ○ Low
                             ○ Medium
                             ○ High
                             ○ Very High
                           - Message (optional)
                          │
                          ▼
                 [Visitor Fill Form]
                          │
                          ▼
                 [Click Submit]
                          │
                          ▼
                 ┌────────────────┐
                 │  VALIDATION:   │
                 │  - Nama filled │
                 │  - Email valid │
                 │  - Interest sel│
                 └───────┬────────┘
                         │
                         ▼
                  {Valid?}
                   /      \
              [No]        [Yes]
               /             \
              ▼               ▼
    [Show Errors]   [Check Duplicate]
              │               │
              │               ▼
              │      {Same email+property
              │       in last 24h?}
              │         /         \
              │     [Yes]         [No]
              │      /               \
              │     ▼                 ▼
              │  [Show:        [Save to
              │  "Already      property_visitors:
              │   submitted"]  - visitor_name
              │     │           - visitor_email
              │     │           - visitor_phone
              │     │           - visitor_whatsapp
              │     └───────┐   - interest_level
              │             │   - message
              │             │   - visited_at
              └─────────────┤   - ip_address
                            │   - user_agent]
                            │         │
                            ▼         ▼
                   [Redirect to  [Increment
                    Property     access_count
                    Detail]      in property_links]
                            │         │
                            │         ▼
                            │   {Interest Level?}
                            │    /    |    \
                            │   /     |     \
                            │  LOW  MEDIUM  HIGH/VERY_HIGH
                            │   │     │         │
                            │   │     │         ▼
                            │   │     │    ┌──────────────┐
                            │   │     │    │ SEND NOTIF:  │
                            │   │     │    │ - Email Agent│
                            │   │     │    │ - Dashboard  │
                            │   │     │    │ Priority Lead│
                            │   │     │    └──────┬───────┘
                            │   │     │           │
                            │   └─────┴───────────┘
                            │           │
                            └───────────┘
                                  │
                                  ▼
                        [Visitor Views Property:
                         - Photos Gallery
                         - Description
                         - Location Map
                         - Specifications]
                                  │
                                  ▼
                        [Agent Can Track:
                         - Who viewed
                         - Interest level
                         - Contact info
                         - For follow-up]
                                  │
                                  ▼
                                 ◉ END

═══════════════════════════════════════════════════════════════════════════
</code></pre>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Lead Capture:</strong> Mandatory form before viewing property</li>
<li><strong>Duplicate Prevention:</strong> 1 email per property per 24 hours</li>
<li><strong>Interest Levels:</strong> 4 levels (Low, Medium, High, Very High)</li>
<li><strong>Smart Notifications:</strong> Agent notified only for HIGH/VERY_HIGH</li>
<li><strong>Tracking:</strong> IP, user agent, visited_at for analytics</li>
</ul>
<hr>
<h2>9. Swimlane Diagram: Property Approval Workflow</h2>
<pre><code>═══════════════════════════════════════════════════════════════════════════
│    AGEN         │  SYSTEM           │  ADMIN KANTOR    │  PUBLIC BUYER
═══════════════════════════════════════════════════════════════════════════

  ● START           │                  │                  │
     │              │                  │                  │
     ▼              │                  │                  │
[Create Property]   │                  │                  │
     │              │                  │                  │
     ▼              ▼                  │                  │
[Submit]     [Set status='pending']   │                  │
     │              │                  │                  │
     │              ▼                  │                  │
     │       [Log Activity]            │                  │
     │              │                  │                  │
     │              ▼                  │                  │
     │       [Send Notification]───────────▶│            │
     ◀─[Pending]    │                       │            │
     │              │                       ▼            │
     │              │              [Receive Notification]│
     │              │                       │            │
     │              │                       ▼            │
     │              │              [Review Property]     │
     │              │              • Check photos        │
     │              │              • Check description   │
     │              │                       │            │
     │              │                       ▼            │
     │              │              {Decision?}           │
     │              │                /        \          │
     │              │          [Approve]   [Reject]      │
     │              │            /              \        │
     │              │           ▼                ▼       │
     │              │   [Set Approved]   [Set Reason]   │
     │              │   [Set is_public]   [Send Reason] │
     │              │           │                │       │
     │              ▼           ▼                │       │
     │       [Log Decision]                      │       │
     │              │                             │       │
     │              ▼                             │       │
     │       [Send Notification]                 │       │
     │           /                 \              │       │
     │          ▼                   ▼             │       │
     ◀─[Approved Notif]       [Rejected]─────────▶       │
     │                             │                      │
     ▼                             ◀─[Fix & Resubmit]    │
{Approved?}                        │                      │
   /    \                          └──────────────▶[Loop]│
[No]   [Yes]                                              │
  │      │                                                │
  ▼      ▼                                                │
 END [Now Public]──────────────────────────────────────────────▶│
          │                                                       ▼
          │                                              [Property Visible]
          │                                              [in Marketplace]
          │                                                       │
          │                                                       ▼
          │                                              [Can Browse & View]
          │                                                       │
          └───────────────────────────────────────────────────────┘
                                                                  │
                                                                  ▼
                                                                 ◉ END
</code></pre>
<hr>
<h2>8. Decision Tables</h2>
<h3>8.1 Property Visibility Decision Table</h3>
<table>
<thead>
<tr>
<th>is_public</th>
<th>status</th>
<th>deleted_at</th>
<th>Show in Marketplace?</th>
<th>Accessible via Link?</th>
</tr>
</thead>
<tbody>
<tr>
<td>TRUE</td>
<td>available</td>
<td>NULL</td>
<td>✅ YES</td>
<td>✅ YES</td>
</tr>
<tr>
<td>TRUE</td>
<td>pending</td>
<td>NULL</td>
<td>✅ YES</td>
<td>✅ YES</td>
</tr>
<tr>
<td>TRUE</td>
<td>sold</td>
<td>NULL</td>
<td>❌ NO</td>
<td>✅ YES (read-only)</td>
</tr>
<tr>
<td>TRUE</td>
<td>rented</td>
<td>NULL</td>
<td>❌ NO</td>
<td>✅ YES (read-only)</td>
</tr>
<tr>
<td>FALSE</td>
<td>available</td>
<td>NULL</td>
<td>❌ NO</td>
<td>✅ YES (if has valid token)</td>
</tr>
<tr>
<td>FALSE</td>
<td>*</td>
<td>NULL</td>
<td>❌ NO</td>
<td>✅ YES (if has valid token)</td>
</tr>
<tr>
<td>*</td>
<td>*</td>
<td>NOT NULL</td>
<td>❌ NO</td>
<td>❌ NO</td>
</tr>
</tbody>
</table>
<p>1. Soft-deleted properties tidak accessible sama sekali</p>
<p>2. Public properties dengan status sold/rented hanya untuk referensi (no contact agent)</p>
<p>3. Private properties hanya accessible via valid token link</p>
<hr>
<h3>8.2 Commission Split Decision Table</h3>
<table>
<thead>
<tr>
<th>Agent Owner</th>
<th>Agent Buyer</th>
<th>Total Commission</th>
<th>Agent Owner Gets</th>
<th>Agent Buyer Gets</th>
<th>Office Gets</th>
</tr>
</thead>
<tbody>
<tr>
<td>✅</td>
<td>❌</td>
<td>Rp 20M</td>
<td>Rp 14M (70%)</td>
<td>-</td>
<td>Rp 6M (30%)</td>
</tr>
<tr>
<td>✅</td>
<td>✅</td>
<td>Rp 20M</td>
<td>Rp 7M (35%)</td>
<td>Rp 7M (35%)</td>
<td>Rp 6M (30%)</td>
</tr>
<tr>
<td>✅</td>
<td>❌</td>
<td>Rp 10M</td>
<td>Rp 7M (70%)</td>
<td>-</td>
<td>Rp 3M (30%)</td>
</tr>
<tr>
<td>✅</td>
<td>✅</td>
<td>Rp 10M</td>
<td>Rp 3.5M (35%)</td>
<td>Rp 3.5M (35%)</td>
<td>Rp 3M (30%)</td>
</tr>
</tbody>
</table>
<ul>
<li>Admin bisa ubah % split manual</li>
<li>Total percentage harus = 100%</li>
<li>Office minimum 20% (business rule)</li>
</ul>
<hr>
<h3>8.3 Token Validation Decision Table</h3>
<table>
<thead>
<tr>
<th>Token Exists</th>
<th>Expired</th>
<th>Access Count</th>
<th>is_used</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>❌</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>❌ Invalid (404)</td>
</tr>
<tr>
<td>✅</td>
<td>YES</td>
<td>-</td>
<td>-</td>
<td>❌ Expired</td>
</tr>
<tr>
<td>✅</td>
<td>NO</td>
<td>0</td>
<td>TRUE</td>
<td>✅ Valid (first access)</td>
</tr>
<tr>
<td>✅</td>
<td>NO</td>
<td>>0</td>
<td>TRUE</td>
<td>❌ Already Used</td>
</tr>
<tr>
<td>✅</td>
<td>NO</td>
<td>-</td>
<td>FALSE</td>
<td>✅ Valid (reusable)</td>
</tr>
</tbody>
</table>
<h2>9. Exception Handling Flows</h2>
<h3>9.1 Upload Photo Failed</h3>
<pre><code>[Upload Photo] → {Success?}
                   /      \
              [Yes]       [No]
               /            \
              ▼              ▼
         [Continue]   {Error Type?}
                        /    |    \
                [Size]  [Format] [Network]
                  /        |         \
                 ▼         ▼          ▼
         [Show: Max 5MB] [Show: JPG/PNG only] [Show: Retry]
                  │         │          │
                  └─────────┴──────────┘
                            │
                            ▼
                      [User Action]
                       /         \
                  [Retry]      [Skip]
                    /              \
                   ▼                ▼
            [Re-upload]        [Continue without]
</code></pre>
<h3>9.2 Transaction Conflict</h3>
<pre><code>[Input Transaction] → {Property Status?}
                         /        \
                  [Available]   [Sold/Rented]
                      /              \
                     ▼                ▼
               [Continue]    [Show Error]
                                "Property sudah terjual"
                                      │
                                      ▼
                                [Refresh List]
                                      │
                                      ▼
                                [Select Another]
</code></pre>
<hr>
<h2>10. Critical Path Analysis</h2>
<h3>10.1 Minimum Path to First Sale</h3>
<pre><code>1. [Admin Master Login] → 2 min
2. [Create Office] → 3 min
3. [Create Agent] → 5 min
4. [Agent Login] → 1 min
5. [Create Property + Upload Photos] → 10 min
6. [Publish to Marketplace] → 1 min
7. [Buyer Browse & Search] → 5 min
8. [Contact Agent via WA] → 1 min
9. (External: Negotiation) → varies
10. [Admin Input Transaction] → 5 min
11. [Commission Auto-Generated] → instant
12. [Agent View Dashboard] → 2 min

TOTAL: ~35 minutes (excluding negotiation)
</code></pre>
<hr>
<h2>11. Flow Summary per Role</h2>
<h3>11.1 Agen Daily Workflow</h3>
<pre><code>Login → View Dashboard → Create/Edit Listings → Upload Photos → 
Set Public/Private → Monitor Views → Respond to Buyer Contacts → 
View Commission Status → Logout
</code></pre>
<h3>11.2 Admin Kantor Daily Workflow</h3>
<pre><code>Login → View Office Dashboard → Review New Properties → 
Approve/Reject → Input Transactions → Mark Commissions Paid → 
View Activity Log → Generate Reports → Logout
</code></pre>
<h3>11.3 Buyer Journey</h3>
<pre><code>Visit Website → Browse Listings → Search & Filter → 
View Property Details → Contact Agent (WA) → 
(External: Visit & Negotiate) → Purchase Decision
</code></pre>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Status:</strong> Ready for Development Reference</p>
</div>

<div class="content-section page-break" id="section-7">
<h1>BAB 7: Technical Specifications & Architecture</h1>

<p><strong>Dokumen Technical Specifications</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. System Architecture</h2>
<h3>1.1 High-Level Architecture</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                        USERS                                 │
│  Admin Master │ Admin Kantor │ Agen │ Buyer (Public)        │
└──────────────┬──────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│                   PRESENTATION LAYER                         │
│  ┌──────────────────┐         ┌─────────────────────┐       │
│  │  Admin Panel     │         │  Public Website     │       │
│  │  (Filament 3)    │         │  (Blade + Alpine)   │       │
│  └──────────────────┘         └─────────────────────┘       │
└──────────────┬──────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│                   APPLICATION LAYER                          │
│  ┌────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │ Auth       │  │ Property     │  │ Transaction  │        │
│  │ Module     │  │ Module       │  │ Module       │        │
│  └────────────┘  └──────────────┘  └──────────────┘        │
│  ┌────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │ User       │  │ Commission   │  │ Dashboard    │        │
│  │ Module     │  │ Module       │  │ Module       │        │
│  └────────────┘  └──────────────┘  └──────────────┘        │
└──────────────┬──────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│                     DATA LAYER                               │
│  ┌──────────────────┐         ┌─────────────────────┐       │
│  │  MySQL Database  │         │  File Storage       │       │
│  │  (Relational)    │         │  (Local/S3)         │       │
│  └──────────────────┘         └─────────────────────┘       │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3>1.2 Technology Stack</h3>
<h4>Backend</h4>
<ul>
<li><strong>Framework:</strong> Laravel 11.x</li>
<li><strong>Language:</strong> PHP 8.2+</li>
<li><strong>Admin Panel:</strong> Filament 3.x</li>
<li><strong>Authentication:</strong> Laravel Breeze / Fortify</li>
<li><strong>Authorization:</strong> Laravel Gates & Policies</li>
<li><strong>Queue:</strong> Laravel Queue (database driver for MVP, Redis for production)</li>
<li><strong>Cache:</strong> File cache (MVP) → Redis (production)</li>
<li><strong>Activity Log:</strong> spatie/laravel-activitylog (audit trail)</li>
<li><strong>Notifications:</strong> Laravel Notification (email & database)</li>
<li><strong>Scheduler:</strong> Laravel Task Scheduling (cron jobs)</li>
<li><strong>Export:</strong> Laravel Excel (maatwebsite/excel) & DomPDF</li>
<li><strong>Soft Delete:</strong> Laravel SoftDeletes trait</li>
<li><strong>Image Processing:</strong> Intervention/Image</li>
</ul>
<h4>Frontend</h4>
<ul>
<li><strong>Admin:</strong> Filament 3 (Alpine.js + Livewire)</li>
<li><strong>Public Site:</strong> Blade Templates + Alpine.js + Tailwind CSS</li>
<li><strong>CSS Framework:</strong> Tailwind CSS 3.x</li>
<li><strong>Icons:</strong> Heroicons / Font Awesome</li>
</ul>
<h4>Database</h4>
<ul>
<li><strong>Primary:</strong> MySQL 8.0+</li>
<li><strong>Alternative:</strong> PostgreSQL 15+ (jika preferred)</li>
<li><strong>ORM:</strong> Eloquent</li>
</ul>
<h4>Storage</h4>
<ul>
<li><strong>MVP:</strong> Local storage (public/storage)</li>
<li><strong>Production:</strong> AWS S3 / DigitalOcean Spaces / Cloudinary</li>
</ul>
<h4>Server & Deployment</h4>
<ul>
<li><strong>Web Server:</strong> Caddy (sesuai setup di workspace)</li>
<li><strong>Server:</strong> VPS (Ubuntu 22.04 LTS)</li>
<li><strong>Process Manager:</strong> Supervisor (untuk queue worker)</li>
<li><strong>SSL:</strong> Let's Encrypt (via Caddy auto-https)</li>
</ul>
<h4>Development Tools</h4>
<ul>
<li><strong>Version Control:</strong> Git + GitHub/GitLab</li>
<li><strong>Package Manager:</strong> Composer (PHP), npm (JS)</li>
<li><strong>Code Quality:</strong> Laravel Pint, PHPStan</li>
<li><strong>Testing:</strong> PHPUnit, Pest (optional)</li>
</ul>
<hr>
<h2>2. Application Modules</h2>
<h3>2.1 Authentication Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>User login/logout</li>
<li>Password reset</li>
<li>Session management</li>
<li>Remember me functionality</li>
</ul>
<p><strong>Technologies:</strong></p>
<ul>
<li>Laravel Breeze (starter kit)</li>
<li>Laravel Sanctum (API auth for future mobile)</li>
</ul>
<p><strong>Database Tables:</strong></p>
<ul>
<li><code>users</code></li>
<li><code>password_reset_tokens</code></li>
<li><code>sessions</code></li>
</ul>
<hr>
<h3>2.2 Authorization Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Role-based access control (RBAC)</li>
<li>Permission checking</li>
<li>Policy enforcement</li>
</ul>
<p><strong>Implementation:</strong></p>
<pre><code>// Roles
enum UserRole: string {
    case ADMIN_MASTER = 'admin_master';
    case ADMIN_KANTOR = 'admin_kantor';
    case AGENT = 'agent';
    case BUYER = 'buyer';
}

// Gates
Gate::define('manage-all-offices', function (User $user) {
    return $user->role === UserRole::ADMIN_MASTER;
});

// Policies
class PropertyPolicy {
    public function update(User $user, Property $property) {
        return $user->role === UserRole::ADMIN_MASTER
            || ($user->role === UserRole::ADMIN_KANTOR && $user->manages($property->agent->office))
            || ($user->role === UserRole::AGENT && $property->agent_id === $user->agent->id);
    }
}
</code></pre>
<hr>
<h3>2.3 User Management Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>CRUD Users</li>
<li>CRUD Offices</li>
<li>CRUD Agents</li>
<li>Assign relationships</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li><code>User</code> (polymorphic: bisa Admin Master, Admin Kantor, Agent, Buyer)</li>
<li><code>Office</code></li>
<li><code>Agent</code> (belongsTo User, belongsTo Office)</li>
<li><code>OfficeAdmin</code> (pivot: admin_kantor yang manage office)</li>
</ul>
<p><strong>Key Relationships:</strong></p>
<pre><code>// User Model
class User extends Authenticatable {
    public function agent() {
        return $this->hasOne(Agent::class);
    }
    
    public function managedOffices() {
        return $this->belongsToMany(Office::class, 'office_admins');
    }
}

// Office Model
class Office extends Model {
    public function agents() {
        return $this->hasMany(Agent::class);
    }
    
    public function admins() {
        return $this->belongsToMany(User::class, 'office_admins');
    }
}

// Agent Model
class Agent extends Model {
    public function user() {
        return $this->belongsTo(User::class);
    }
    
    public function office() {
        return $this->belongsTo(Office::class);
    }
    
    public function properties() {
        return $this->hasMany(Property::class, 'agent_id');
    }
}
</code></pre>
<hr>
<h3>2.4 Property Management Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>CRUD Properties</li>
<li>Photo upload & management</li>
<li>Status management</li>
<li>Public listing</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li><code>Property</code></li>
<li><code>PropertyPhoto</code></li>
<li><code>PropertyType</code> (enum: Rumah, Apartemen, Tanah, Komersial)</li>
<li><code>PropertyStatus</code> (enum: Available, Pending, Sold, Rented)</li>
</ul>
<p><strong>Key Features:</strong></p>
<ul>
<li>Image upload dengan validation (max 10, max 5MB, JPG/PNG only)</li>
<li>Image optimization (resize, compress)</li>
<li>Slug generation untuk SEO-friendly URL</li>
<li>Soft delete</li>
</ul>
<p><strong>Database Tables:</strong></p>
<ul>
<li><code>properties</code></li>
<li><code>property_photos</code></li>
</ul>
<hr>
<h3>2.5 Transaction Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Record transactions</li>
<li>Link property, agents, buyer</li>
<li>Track transaction status</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li><code>Transaction</code></li>
<li><code>TransactionType</code> (enum: Sale, Rent)</li>
<li><code>TransactionStatus</code> (enum: Pending, Completed, Cancelled)</li>
</ul>
<p><strong>Key Relationships:</strong></p>
<pre><code>class Transaction extends Model {
    public function property() {
        return $this->belongsTo(Property::class);
    }
    
    public function agentOwner() {
        return $this->belongsTo(Agent::class, 'agent_owner_id');
    }
    
    public function agentBuyer() {
        return $this->belongsTo(Agent::class, 'agent_buyer_id');
    }
    
    public function commissions() {
        return $this->hasMany(Commission::class);
    }
}
</code></pre>
<hr>
<h3>2.6 Commission Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Calculate commission</li>
<li>Split commission (agent vs office)</li>
<li>Track payment status</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li><code>Commission</code></li>
<li><code>CommissionStatus</code> (enum: Pending, Paid, Cancelled)</li>
</ul>
<p><strong>Key Logic:</strong></p>
<pre><code>class CommissionService {
    public function calculateCommission(Transaction $transaction) {
        $totalCommission = $transaction->final_price * $transaction->commission_percentage / 100;
        
        $commissions = [];
        
        if ($transaction->agentBuyer) {
            // Scenario: 2 agents
            $agentSplit = 0.35; // 35% each
            
            $commissions[] = [
                'agent_id' => $transaction->agentOwner->id,
                'amount' => $totalCommission * $agentSplit,
                'type' => 'agent_owner'
            ];
            
            $commissions[] = [
                'agent_id' => $transaction->agentBuyer->id,
                'amount' => $totalCommission * $agentSplit,
                'type' => 'agent_buyer'
            ];
        } else {
            // Scenario: 1 agent only
            $commissions[] = [
                'agent_id' => $transaction->agentOwner->id,
                'amount' => $totalCommission * 0.70,
                'type' => 'agent_owner'
            ];
        }
        
        // Office commission (always 30%)
        $commissions[] = [
            'office_id' => $transaction->agentOwner->office_id,
            'amount' => $totalCommission * 0.30,
            'type' => 'office'
        ];
        
        return $commissions;
    }
}
</code></pre>
<hr>
<h3>2.7 Dashboard Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Aggregate data untuk dashboard</li>
<li>Generate charts</li>
<li>Performance metrics</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>Use Laravel Query Builder untuk aggregate</li>
<li>Cache hasil query (TTL: 1 hour)</li>
<li>Real-time update via Livewire</li>
</ul>
<p><strong>Key Metrics:</strong></p>
<pre><code>class DashboardService {
    public function getAgentMetrics(Agent $agent, $dateRange) {
        return [
            'total_listings' => $agent->properties()->active()->count(),
            'total_omzet' => $agent->transactions()->sum('final_price'),
            'total_commission' => $agent->commissions()->sum('amount'),
            'commission_pending' => $agent->commissions()->pending()->sum('amount'),
            'commission_paid' => $agent->commissions()->paid()->sum('amount'),
        ];
    }
}
</code></pre>
<hr>
<h3>2.8 Activity Log Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Track all important actions in the system</li>
<li>Audit trail for compliance</li>
<li>User activity monitoring</li>
</ul>
<p><strong>Package:</strong></p>
<ul>
<li><strong>spatie/laravel-activitylog</strong> v4.x</li>
</ul>
<p><strong>Installation:</strong></p>
<pre><code>composer require spatie/activitylog
php artisan vendor:publish --provider="Spatie\Activitylog\ActivitylogServiceProvider" --tag="activitylog-migrations"
php artisan migrate
</code></pre>
<p><strong>Implementation:</strong></p>
<pre><code>// Automatic logging on model events
use Spatie\Activitylog\Traits\LogsActivity;
use Spatie\Activitylog\LogOptions;

class Property extends Model {
    use LogsActivity;
    
    public function getActivitylogOptions(): LogOptions {
        return LogOptions::defaults()
            ->logOnly(['price', 'status', 'is_public', 'published_at'])
            ->logOnlyDirty()
            ->dontSubmitEmptyLogs();
    }
}

// Manual logging
activity()
    ->performedOn($property)
    ->causedBy($user)
    ->withProperties(['old' => [...], 'new' => [...]])
    ->log('Property price updated');
</code></pre>
<p><strong>Database Tables:</strong></p>
<ul>
<li><code>activity_log</code></li>
</ul>
<hr>
<h3>2.9 Notification Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Send internal notifications (database)</li>
<li>Send email notifications</li>
<li>Notification preferences management</li>
</ul>
<p><strong>Laravel Notification Channels:</strong></p>
<ul>
<li><strong>Database:</strong> For in-app notifications</li>
<li><strong>Mail:</strong> For email notifications</li>
</ul>
<p><strong>Implementation:</strong></p>
<pre><code>// Create notification
php artisan make:notification PropertyApprovedNotification

// Send notification
$agent->notify(new PropertyApprovedNotification($property));

// Retrieve notifications
$user->notifications; // All
$user->unreadNotifications; // Unread only
$user->markAsRead(); // Mark as read
</code></pre>
<p><strong>Database Tables:</strong></p>
<ul>
<li><code>notifications</code> (Laravel default)</li>
</ul>
<p><strong>Notification Types:</strong></p>
<p>1. PropertyApproved</p>
<p>2. PropertySold</p>
<p>3. CommissionPaid</p>
<p>4. PropertyNeedsReview</p>
<hr>
<h3>2.10 Scheduled Tasks Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Auto-expire private links</li>
<li>Clean old notifications</li>
<li>Generate daily reports</li>
<li>Archive old logs</li>
</ul>
<p><strong>Laravel Scheduler:</strong></p>
<pre><code>// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // Expire old property links
    $schedule->command('links:expire')->hourly();
    
    // Clean old notifications (>30 days)
    $schedule->command('notifications:clean')->daily()->at('02:00');
    
    // Cache performance metrics
    $schedule->command('reports:cache')->daily()->at('08:00');
    
    // Archive activity logs (>90 days)
    $schedule->command('logs:archive')->weekly()->sundays()->at('01:00');
}
</code></pre>
<p><strong>Cron Entry (Server):</strong></p>
<pre><code>* * * * * cd /var/www/hendra-prop && php artisan schedule:run >> /dev/null 2>&1
</code></pre>
<p><strong>Monitoring:</strong></p>
<ul>
<li>Log every task execution</li>
<li>Send alerts on failure</li>
<li>Track execution time</li>
</ul>
<hr>
<h3>2.11 Export Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Export performance reports to Excel</li>
<li>Export to PDF (optional)</li>
<li>Generate downloadable reports</li>
</ul>
<p><strong>Packages:</strong></p>
<ul>
<li><strong>maatwebsite/excel</strong> v3.x (Laravel Excel)</li>
<li><strong>barryvdh/laravel-dompdf</strong> (optional for PDF)</li>
</ul>
<p><strong>Installation:</strong></p>
<pre><code>composer require maatwebsite/excel
composer require barryvdh/laravel-dompdf
</code></pre>
<p><strong>Implementation:</strong></p>
<pre><code>// Export to Excel
use Maatwebsite\Excel\Facades\Excel;
use App\Exports\PerformanceExport;

return Excel::download(
    new PerformanceExport($dateRange), 
    'performance-report.xlsx'
);

// Export class
class PerformanceExport implements FromCollection {
    public function collection() {
        return Agent::with('transactions')->get();
    }
}
</code></pre>
<hr>
<h3>2.12 Private Link Module</h3>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Generate tokenized private links</li>
<li>Validate link expiration</li>
<li>Track link access</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li><code>PropertyLink</code></li>
</ul>
<p><strong>Implementation:</strong></p>
<pre><code>class PropertyLink extends Model {
    public function isValid(): bool {
        return $this->expires_at > now() 
            && (!$this->is_used || $this->access_count == 0);
    }
    
    public static function generateForProperty(Property $property, int $days = 7): self {
        return self::create([
            'property_id' => $property->id,
            'token' => Str::random(64),
            'expires_at' => now()->addDays($days),
            'created_by' => auth()->id(),
        ]);
    }
    
    public function recordAccess(): void {
        $this->increment('access_count');
        $this->accessed_at = $this->accessed_at ?? now();
        $this->save();
    }
}
</code></pre>
<p><strong>Database Tables:</strong></p>
<ul>
<li><code>property_links</code></li>
</ul>
<hr>
<h2>3. Database Design</h2>
<h3>3.1 Entity Relationship Diagram (ERD)</h3>
<pre><code>┌─────────────┐
│   USERS     │
├─────────────┤
│ id          │
│ name        │
│ email       │
│ password    │
│ role        │
│ created_at  │
└──────┬──────┘
       │
       │ 1:1 (untuk agent)
       │
       ▼
┌─────────────┐         ┌─────────────┐
│   AGENTS    │ N:1     │   OFFICES   │
├─────────────┤────────▶├─────────────┤
│ id          │         │ id          │
│ user_id     │         │ name        │
│ office_id   │         │ address     │
│ phone       │         │ phone       │
│ status      │         │ email       │
│ created_at  │         │ created_at  │
└──────┬──────┘         └─────────────┘
       │
       │ 1:N
       │
       ▼
┌─────────────────────┐
│    PROPERTIES       │
├─────────────────────┤
│ id                  │
│ agent_id            │
│ title               │
│ description         │
│ type                │
│ listing_type        │◀─────┐
│ price               │      │ 1:1
│ price_per_sqm       │      │
│ land_area           │      │
│ building_area       │      │
│ address             │      │
│ status              │      │
│ created_at          │      │
└──────┬──────────────┘      │
       │                     │
       │ 1:N                 │
       │                     │
       ▼                     │
┌──────────────────┐         │
│ PROPERTY_PHOTOS  │         │
├──────────────────┤         │
│ id               │         │
│ property_id      │         │
│ photo_url        │         │
│ order            │         │
│ is_cover         │         │
└──────────────────┘         │
                             │
                             │
┌────────────────────────────┘
│
│
▼
┌─────────────────────┐
│   TRANSACTIONS      │
├─────────────────────┤
│ id                  │
│ property_id         │
│ agent_owner_id      │
│ agent_buyer_id      │ (nullable)
│ buyer_name          │
│ buyer_phone         │
│ transaction_type    │
│ final_price         │
│ commission_pct      │
│ transaction_date    │
│ status              │
│ notes               │
│ created_at          │
└──────┬──────────────┘
       │
       │ 1:N
       │
       ▼
┌─────────────────────┐
│   COMMISSIONS       │
├─────────────────────┤
│ id                  │
│ transaction_id      │
│ agent_id            │ (nullable)
│ office_id           │ (nullable)
│ amount              │
│ percentage          │
│ type                │ (agent_owner/agent_buyer/office)
│ status              │ (pending/paid/cancelled)
│ paid_date           │
│ notes               │
│ created_at          │
└─────────────────────┘
</code></pre>
<hr>
<h3>3.2 Database Tables Detail</h3>
<h4>Table: `users`</h4>
<pre><code>CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    email_verified_at TIMESTAMP NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin_master', 'admin_kantor', 'agent', 'buyer') NOT NULL,
    phone VARCHAR(20),
    avatar VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    remember_token VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_role (role),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `offices`</h4>
<pre><code>CREATE TABLE offices (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address TEXT,
    phone VARCHAR(20),
    email VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `office_admins` (Pivot)</h4>
<pre><code>CREATE TABLE office_admins (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    office_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_office (user_id, office_id),
    INDEX idx_user (user_id),
    INDEX idx_office (office_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `agents`</h4>
<pre><code>CREATE TABLE agents (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    office_id BIGINT UNSIGNED NOT NULL,
    phone VARCHAR(20),
    whatsapp VARCHAR(20),
    bio TEXT,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT,
    UNIQUE KEY unique_user (user_id),
    INDEX idx_office (office_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `properties`</h4>
<pre><code>CREATE TABLE properties (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    agent_id BIGINT UNSIGNED NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    type ENUM('house', 'apartment', 'land', 'commercial') NOT NULL,
    listing_type ENUM('sale', 'rent', 'both') NOT NULL,
    price DECIMAL(15, 2) NOT NULL,
    price_per_sqm DECIMAL(15, 2),
    land_area DECIMAL(10, 2),
    building_area DECIMAL(10, 2),
    bedrooms INT UNSIGNED,
    bathrooms INT UNSIGNED,
    address TEXT,
    city VARCHAR(100),
    province VARCHAR(100),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    certificate_type VARCHAR(50),
    status ENUM('available', 'pending', 'sold', 'rented') DEFAULT 'available',
    is_featured BOOLEAN DEFAULT FALSE,
    views INT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT,
    INDEX idx_agent (agent_id),
    INDEX idx_type (type),
    INDEX idx_listing_type (listing_type),
    INDEX idx_status (status),
    INDEX idx_city (city),
    INDEX idx_price (price),
    FULLTEXT idx_search (title, description, address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `property_photos`</h4>
<pre><code>CREATE TABLE property_photos (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    property_id BIGINT UNSIGNED NOT NULL,
    photo_url VARCHAR(255) NOT NULL,
    order_number INT UNSIGNED DEFAULT 0,
    is_cover BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE,
    INDEX idx_property (property_id),
    INDEX idx_order (order_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `transactions`</h4>
<pre><code>CREATE TABLE transactions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    property_id BIGINT UNSIGNED NOT NULL,
    agent_owner_id BIGINT UNSIGNED NOT NULL,
    agent_buyer_id BIGINT UNSIGNED NULL,
    buyer_name VARCHAR(255) NOT NULL,
    buyer_phone VARCHAR(20),
    buyer_email VARCHAR(255),
    transaction_type ENUM('sale', 'rent') NOT NULL,
    final_price DECIMAL(15, 2) NOT NULL,
    commission_percentage DECIMAL(5, 2) DEFAULT 2.00,
    transaction_date DATE NOT NULL,
    status ENUM('pending', 'completed', 'cancelled') DEFAULT 'completed',
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE RESTRICT,
    FOREIGN KEY (agent_owner_id) REFERENCES agents(id) ON DELETE RESTRICT,
    FOREIGN KEY (agent_buyer_id) REFERENCES agents(id) ON DELETE RESTRICT,
    INDEX idx_property (property_id),
    INDEX idx_agent_owner (agent_owner_id),
    INDEX idx_agent_buyer (agent_buyer_id),
    INDEX idx_transaction_date (transaction_date),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<h4>Table: `commissions`</h4>
<pre><code>CREATE TABLE commissions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    transaction_id BIGINT UNSIGNED NOT NULL,
    agent_id BIGINT UNSIGNED NULL,
    office_id BIGINT UNSIGNED NULL,
    amount DECIMAL(15, 2) NOT NULL,
    percentage DECIMAL(5, 2) NOT NULL,
    type ENUM('agent_owner', 'agent_buyer', 'office') NOT NULL,
    status ENUM('pending', 'paid', 'cancelled') DEFAULT 'pending',
    paid_date DATE NULL,
    payment_method VARCHAR(50),
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (transaction_id) REFERENCES transactions(id) ON DELETE CASCADE,
    FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT,
    FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT,
    INDEX idx_transaction (transaction_id),
    INDEX idx_agent (agent_id),
    INDEX idx_office (office_id),
    INDEX idx_status (status),
    INDEX idx_paid_date (paid_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
</code></pre>
<hr>
<h2>4. API Specifications</h2>
<h3>4.1 API Endpoints (Internal - For Future Mobile App)</h3>
<h4>Authentication</h4>
<pre><code>POST   /api/auth/login
POST   /api/auth/logout
POST   /api/auth/refresh
GET    /api/auth/me
</code></pre>
<h4>Properties</h4>
<pre><code>GET    /api/properties              - List all properties
GET    /api/properties/{id}         - Get property detail
POST   /api/properties              - Create property (agent/admin)
PUT    /api/properties/{id}         - Update property
DELETE /api/properties/{id}         - Delete property
POST   /api/properties/{id}/photos  - Upload photos
</code></pre>
<h4>Agents</h4>
<pre><code>GET    /api/agents                  - List agents
GET    /api/agents/{id}             - Get agent detail
GET    /api/agents/{id}/properties  - Get agent's properties
GET    /api/agents/{id}/performance - Get agent metrics
</code></pre>
<h4>Transactions</h4>
<pre><code>GET    /api/transactions            - List transactions
POST   /api/transactions            - Create transaction
GET    /api/transactions/{id}       - Get transaction detail
</code></pre>
<h4>Commissions</h4>
<pre><code>GET    /api/commissions             - List commissions
PUT    /api/commissions/{id}/pay    - Mark as paid
</code></pre>
<h3>4.2 Response Format</h3>
<p><strong>Success Response:</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 1,
    "title": "Rumah Mewah di Jakarta Selatan",
    "price": 5000000000
  },
  "message": "Property retrieved successfully"
}
</code></pre>
<p><strong>Error Response:</strong></p>
<pre><code>{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "The given data was invalid.",
    "details": {
      "title": ["The title field is required."],
      "price": ["The price must be a number."]
    }
  }
}
</code></pre>
<hr>
<h2>5. Security Considerations</h2>
<h3>5.1 Authentication Security</h3>
<ul>
<li>Password hashing: bcrypt (cost: 12)</li>
<li>Password policy: min 8 characters, 1 uppercase, 1 number</li>
<li>Rate limiting: 5 failed attempts → 15 min lockout</li>
<li>Session timeout: 24 hours</li>
<li>CSRF protection: enabled (Laravel default)</li>
</ul>
<h3>5.2 Authorization Security</h3>
<ul>
<li>Policy-based authorization for all resources</li>
<li>Middleware protection pada setiap route</li>
<li>Row-level security (check ownership)</li>
<li>Audit trail untuk sensitive actions</li>
</ul>
<h3>5.3 Data Security</h3>
<ul>
<li>SQL injection prevention: Eloquent ORM</li>
<li>XSS prevention: Blade escaping, CSP headers</li>
<li>File upload validation: type, size, content check</li>
<li>Image sanitization: strip EXIF data</li>
<li>HTTPS enforcement</li>
<li>Secure headers: HSTS, X-Frame-Options, etc.</li>
</ul>
<h3>5.4 Database Security</h3>
<ul>
<li>Prepared statements (via Eloquent)</li>
<li>Least privilege principle untuk DB user</li>
<li>Encrypted connection to database</li>
<li>Regular backups with encryption</li>
</ul>
<hr>
<h2>6. Performance Optimization</h2>
<h3>6.1 Query Optimization</h3>
<pre><code>// Eager loading untuk N+1 problem
$properties = Property::with(['agent.user', 'photos'])
    ->paginate(20);

// Select only needed columns
$properties = Property::select(['id', 'title', 'price', 'status'])
    ->get();

// Index semua foreign keys & frequently queried columns
</code></pre>
<h3>6.2 Caching Strategy</h3>
<pre><code>// Cache listing untuk public page (TTL: 5 menit)
$properties = Cache::remember('properties:public', 300, function() {
    return Property::available()->with('photos')->get();
});

// Cache dashboard metrics (TTL: 1 jam)
$metrics = Cache::remember("agent:{$agentId}:metrics", 3600, function() {
    return DashboardService::getAgentMetrics($agentId);
});
</code></pre>
<h3>6.3 Image Optimization</h3>
<pre><code>// Resize & compress images
use Intervention\Image\Facades\Image;

Image::make($uploadedFile)
    ->fit(1200, 800)
    ->encode('jpg', 85)
    ->save($path);

// Generate thumbnail
Image::make($uploadedFile)
    ->fit(400, 300)
    ->encode('jpg', 80)
    ->save($thumbnailPath);
</code></pre>
<h3>6.4 Database Optimization</h3>
<ul>
<li>Index pada foreign keys</li>
<li>Index pada frequently filtered columns (status, type, city)</li>
<li>FULLTEXT index untuk search</li>
<li>Query caching</li>
<li>Connection pooling</li>
</ul>
<hr>
<h2>7. Deployment Architecture</h2>
<h3>7.1 Production Environment</h3>
<pre><code>┌─────────────────────────────────────────┐
│          CLOUDFLARE CDN                 │
│  (DNS, SSL, DDoS Protection, Cache)     │
└───────────────┬─────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────┐
│          VPS SERVER (Ubuntu 22.04)      │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  CADDY (Web Server + Auto HTTPS)  │ │
│  └────────────┬──────────────────────┘ │
│               │                         │
│               ▼                         │
│  ┌───────────────────────────────────┐ │
│  │  PHP-FPM 8.2 (Laravel 11)         │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  MySQL 8.0                        │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  Redis (Cache & Queue)            │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  Supervisor (Queue Worker)        │ │
│  └───────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
</code></pre>
<h3>7.2 Deployment Steps (CI/CD)</h3>
<pre><code># .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.2
      
      - name: Install dependencies
        run: composer install --no-dev --optimize-autoloader
      
      - name: Run tests
        run: php artisan test
      
      - name: Deploy to server
        run: |
          ssh user@server 'cd /var/www/hendra-prop && git pull'
          ssh user@server 'cd /var/www/hendra-prop && composer install --no-dev'
          ssh user@server 'cd /var/www/hendra-prop && php artisan migrate --force'
          ssh user@server 'cd /var/www/hendra-prop && php artisan optimize'
          ssh user@server 'sudo systemctl reload php8.2-fpm'
</code></pre>
<hr>
<h2>8. Monitoring & Logging</h2>
<h3>8.1 Application Monitoring</h3>
<ul>
<li><strong>Tool:</strong> Laravel Telescope (development)</li>
<li><strong>Tool:</strong> Sentry / Bugsnag (production error tracking)</li>
<li><strong>Metrics:</strong> Response time, error rate, queue backlog</li>
</ul>
<h3>8.2 Server Monitoring</h3>
<ul>
<li><strong>Tool:</strong> UptimeRobot (uptime monitoring)</li>
<li><strong>Tool:</strong> New Relic / Datadog (server metrics)</li>
<li><strong>Alerts:</strong> Email/Slack notification untuk downtime</li>
</ul>
<h3>8.3 Logging</h3>
<pre><code>// Laravel Log channels
'channels' => [
    'stack' => [
        'driver' => 'stack',
        'channels' => ['daily', 'slack'],
    ],
    'daily' => [
        'driver' => 'daily',
        'path' => storage_path('logs/laravel.log'),
        'level' => 'debug',
        'days' => 14,
    ],
    'slack' => [
        'driver' => 'slack',
        'url' => env('LOG_SLACK_WEBHOOK_URL'),
        'level' => 'critical',
    ],
];
</code></pre>
<hr>
<h2>9. Testing Strategy</h2>
<h3>9.1 Unit Tests</h3>
<pre><code>// Test commission calculation
test('commission calculation with two agents', function() {
    $transaction = Transaction::factory()->create([
        'final_price' => 1000000000,
        'commission_percentage' => 2.00,
    ]);
    
    $commissions = CommissionService::calculate($transaction);
    
    expect($commissions)->toHaveCount(3)
        ->and($commissions[0]['amount'])->toBe(7000000) // 35% agen owner
        ->and($commissions[1]['amount'])->toBe(7000000) // 35% agen buyer
        ->and($commissions[2]['amount'])->toBe(6000000); // 30% office
});
</code></pre>
<h3>9.2 Feature Tests</h3>
<pre><code>// Test property creation
test('agent can create property', function() {
    $agent = User::factory()->agent()->create();
    
    $response = $this->actingAs($agent)->post('/properties', [
        'title' => 'Test Property',
        'price' => 1000000000,
        'type' => 'house',
    ]);
    
    $response->assertCreated()
        ->assertJson(['success' => true]);
    
    $this->assertDatabaseHas('properties', [
        'title' => 'Test Property',
        'agent_id' => $agent->agent->id,
    ]);
});
</code></pre>
<h3>9.3 Browser Tests (Dusk)</h3>
<pre><code>// Test end-to-end listing flow
test('buyer can view property detail', function() {
    $property = Property::factory()->create();
    
    $this->browse(function (Browser $browser) use ($property) {
        $browser->visit('/properties/' . $property->slug)
            ->assertSee($property->title)
            ->assertSee($property->price)
            ->click('@contact-agent-button')
            ->assertPathIs('/contact');
    });
});
</code></pre>
<hr>
<h2>10. Development Workflow</h2>
<h3>10.1 Git Branching Strategy</h3>
<pre><code>main (production)
  │
  ├── develop (staging)
  │     │
  │     ├── feature/property-management
  │     ├── feature/commission-calculation
  │     ├── feature/dashboard
  │     └── bugfix/photo-upload
  │
  └── hotfix/critical-bug
</code></pre>
<h3>10.2 Commit Convention</h3>
<pre><code>feat: Add property photo upload
fix: Fix commission calculation for two agents
refactor: Refactor DashboardService
docs: Update API documentation
test: Add tests for TransactionService
chore: Update dependencies
</code></pre>
<h3>10.3 Code Review Checklist</h3>
<ul>
<li>[ ] Code follows Laravel best practices</li>
<li>[ ] All tests passing</li>
<li>[ ] No security vulnerabilities</li>
<li>[ ] Performance considerations addressed</li>
<li>[ ] Documentation updated</li>
<li>[ ] No linter errors</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0</p>
</div>

<div class="content-section page-break" id="section-8">
<h1>BAB 8: Database Design & Schema</h1>

<p><strong>Dokumen Database Design & Schema</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. Database Overview</h2>
<h3>1.1 Database Information</h3>
<ul>
<li><strong>Type:</strong> Relational Database</li>
<li><strong>DBMS:</strong> MySQL 8.0+ / PostgreSQL 15+</li>
<li><strong>Charset:</strong> utf8mb4_unicode_ci</li>
<li><strong>Engine:</strong> InnoDB (untuk transactions & foreign keys)</li>
<li><strong>Collation:</strong> utf8mb4_unicode_ci</li>
</ul>
<h3>1.2 Naming Conventions</h3>
<ul>
<li><strong>Tables:</strong> plural, snake_case (e.g., <code>properties</code>, <code>property_photos</code>)</li>
<li><strong>Columns:</strong> snake_case (e.g., <code>created_at</code>, <code>agent_id</code>)</li>
<li><strong>Primary Keys:</strong> <code>id</code> (BIGINT UNSIGNED AUTO_INCREMENT)</li>
<li><strong>Foreign Keys:</strong> <code>{table}_id</code> (e.g., <code>agent_id</code>, <code>office_id</code>)</li>
<li><strong>Indexes:</strong> <code>idx_{column}</code> atau <code>idx_{purpose}</code></li>
<li><strong>Unique Indexes:</strong> <code>unique_{column}</code></li>
</ul>
<hr>
<h2>2. Complete ERD (Entity Relationship Diagram)</h2>
<pre><code>                    ┌─────────────────────┐
                    │       USERS         │
                    ├─────────────────────┤
                    │ PK: id              │
                    │     name            │
                    │     email (UNIQUE)  │
                    │     password        │
                    │     role (ENUM)     │
                    │     phone           │
                    │     avatar          │
                    │     is_active       │
                    │     created_at      │
                    └──────┬──────────────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          │ 1:1            │                │ N:M
          │                │                │
          ▼                │                ▼
┌──────────────────┐       │      ┌──────────────────┐
│     AGENTS       │       │      │  OFFICE_ADMINS   │
├──────────────────┤       │      │  (Pivot Table)   │
│ PK: id           │       │      ├──────────────────┤
│ FK: user_id      │       │      │ PK: id           │
│ FK: office_id    │       │      │ FK: user_id      │
│     phone        │       │      │ FK: office_id    │
│     whatsapp     │       │      └────────┬─────────┘
│     bio          │       │               │
│     status       │       │               │
│     created_at   │       │               │
└─────┬────────────┘       │               │
      │                    │               │
      │ N:1                │ 1:N           │ N:1
      │                    │               │
      ▼                    ▼               ▼
┌─────────────────────────────────────────────────┐
│                   OFFICES                       │
├─────────────────────────────────────────────────┤
│ PK: id                                          │
│     name                                        │
│     address                                     │
│     phone                                       │
│     email                                       │
│     is_active                                   │
│     created_at                                  │
└─────────────────────────────────────────────────┘


      ┌──────────────────┐
      │     AGENTS       │ (from above)
      └─────┬────────────┘
            │
            │ 1:N (owner)
            │
            ▼
┌────────────────────────────────────┐
│          PROPERTIES                │
├────────────────────────────────────┤
│ PK: id                             │
│ FK: agent_id                       │
│     slug (UNIQUE)                  │
│     title                          │
│     description (TEXT)             │
│     type (ENUM)                    │
│     listing_type (ENUM)            │
│     price (DECIMAL)                │
│     price_per_sqm (DECIMAL)        │
│     land_area (DECIMAL)            │
│     building_area (DECIMAL)        │
│     bedrooms (INT)                 │
│     bathrooms (INT)                │
│     address (TEXT)                 │
│     city                           │
│     province                       │
│     latitude (DECIMAL)             │
│     longitude (DECIMAL)            │
│     certificate_type               │
│     status (ENUM)                  │
│     approval_status (ENUM)         │
│     submitted_at (DATETIME)        │
│     reviewed_by (user_id)          │
│     reviewed_at (DATETIME)         │
│     revision_notes (TEXT)          │
│     is_featured (BOOLEAN)          │
│     is_public (BOOLEAN)            │
│     published_at (DATETIME)        │
│     views_count (INT)              │
│     created_at                     │
│     deleted_at (DATETIME)          │
└─────┬──────────────────────────────┘
      │
      │ 1:N
      │
      ▼
┌────────────────────────────┐
│    PROPERTY_PHOTOS         │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_id            │
│     photo_url              │
│     order_number           │
│     is_cover (BOOLEAN)     │
│     created_at             │
└────────────────────────────┘

      │ (from properties)
      │ 1:N
      ▼
┌────────────────────────────┐
│    PROPERTY_LINKS          │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_id            │
│ FK: created_by (user_id)   │
│     token (UNIQUE)         │
│     expires_at (DATETIME)  │
│     is_used (BOOLEAN)      │
│     access_count (INT)     │
│     created_at             │
└────────────────────────────┘

      │ (from property_links)
      │ 1:N
      ▼
┌────────────────────────────┐
│   PROPERTY_VISITORS        │
├────────────────────────────┤
│ PK: id                     │
│ FK: property_link_id       │
│ FK: property_id            │
│     visitor_name           │
│     visitor_email          │
│     visitor_phone          │
│     visitor_whatsapp       │
│     interest_level (ENUM)  │
│     message (TEXT)         │
│     visited_at (DATETIME)  │
│     ip_address             │
│     created_at             │
└────────────────────────────┘


┌────────────────────────────────────┐
│          PROPERTIES                │ (from above)
└─────┬──────────────────────────────┘
      │
      │ 1:1 (per transaction)
      │
      ▼
┌────────────────────────────────────────────┐
│              TRANSACTIONS                  │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: property_id                            │
│ FK: agent_owner_id (→ agents.id)           │
│ FK: agent_buyer_id (→ agents.id, NULLABLE) │
│     buyer_name                             │
│     buyer_phone                            │
│     buyer_email                            │
│     transaction_type (ENUM)                │
│     final_price (DECIMAL)                  │
│     commission_percentage (DECIMAL)        │
│     transaction_date (DATE)                │
│     status (ENUM)                          │
│     notes (TEXT)                           │
│     created_at                             │
└─────┬──────────────────────────────────────┘
      │
      │ 1:N
      │
      ▼
┌────────────────────────────────────────────┐
│              COMMISSIONS                   │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: transaction_id                         │
│ FK: agent_id (NULLABLE)                    │
│ FK: office_id (NULLABLE)                   │
│     amount (DECIMAL)                       │
│     percentage (DECIMAL)                   │
│     type (ENUM)                            │
│     status (ENUM)                          │
│     paid_date (DATE)                       │
│     payment_method                         │
│     notes (TEXT)                           │
│     created_at                             │
└────────────────────────────────────────────┘

┌────────────────────────────────────────────┐
│              ACTIVITY_LOG                  │
├────────────────────────────────────────────┤
│ PK: id                                     │
│ FK: causer_id (user_id)                    │
│     log_name, description                  │
│     subject_type, subject_id               │
│     properties (JSON)                      │
│     created_at                             │
└────────────────────────────────────────────┘
</code></pre>
<hr>
<h2>3. Detailed Table Schemas</h2>
<h3>3.1 Authentication & Users</h3>
<h4>Table: `users`</h4>
<p><strong>Purpose:</strong> Store all user accounts (Admin Master, Admin Kantor, Agen, Buyer)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Full name</td>
</tr>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>UNIQUE, NOT NULL</td>
<td>Login email</td>
</tr>
<tr>
<td><code>email_verified_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Email verification time</td>
</tr>
<tr>
<td><code>password</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Hashed password (bcrypt)</td>
</tr>
<tr>
<td><code>role</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>admin_master, admin_kantor, agent, buyer</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Phone number</td>
</tr>
<tr>
<td><code>avatar</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Avatar image path</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Active status</td>
</tr>
<tr>
<td><code>remember_token</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>Remember me token</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation time</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_email (email)</code></li>
<li><code>INDEX idx_role (role)</code></li>
<li><code>INDEX idx_is_active (is_active)</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>hasOne(Agent)</code> - untuk user dengan role agent</li>
<li><code>belongsToMany(Office)</code> - via office_admins untuk admin kantor</li>
</ul>
<hr>
<h4>Table: `password_reset_tokens`</h4>
<p><strong>Purpose:</strong> Store password reset tokens (Laravel default)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>PK</td>
<td>Email address</td>
</tr>
<tr>
<td><code>token</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Reset token</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Token creation time</td>
</tr>
</tbody>
</table>
<h4>Table: `sessions`</h4>
<p><strong>Purpose:</strong> Store user sessions (Laravel default)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>VARCHAR(255)</td>
<td>PK</td>
<td>Session ID</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, INDEX</td>
<td>User ID</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>VARCHAR(45)</td>
<td>NULLABLE</td>
<td>IP address</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>User agent</td>
</tr>
<tr>
<td><code>payload</code></td>
<td>LONGTEXT</td>
<td>NOT NULL</td>
<td>Session data</td>
</tr>
<tr>
<td><code>last_activity</code></td>
<td>INT</td>
<td>INDEX</td>
<td>Last activity timestamp</td>
</tr>
</tbody>
</table>
<h3>3.2 Organization Structure</h3>
<h4>Table: `offices`</h4>
<p><strong>Purpose:</strong> Store office/branch information</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Office name</td>
</tr>
<tr>
<td><code>address</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full address</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Office phone</td>
</tr>
<tr>
<td><code>email</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Office email</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Active status</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_is_active (is_active)</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>hasMany(Agent)</code> - satu kantor punya banyak agen</li>
<li><code>belongsToMany(User)</code> - via office_admins</li>
<li><code>hasMany(Commission)</code> - komisi kantor</li>
</ul>
<hr>
<h4>Table: `office_admins`</h4>
<p><strong>Purpose:</strong> Pivot table untuk assign Admin Kantor ke Office</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → users.id</td>
<td>Admin Kantor user ID</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → offices.id</td>
<td>Office ID</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Assignment time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_user_office (user_id, office_id)</code></li>
<li><code>INDEX idx_user (user_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE CASCADE</code></li>
</ul>
<hr>
<h4>Table: `agents`</h4>
<p><strong>Purpose:</strong> Store agent profiles (linked to users table)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>UNIQUE, FK → users.id</td>
<td>User account</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → offices.id</td>
<td>Office affiliation</td>
</tr>
<tr>
<td><code>phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Contact phone</td>
</tr>
<tr>
<td><code>whatsapp</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>WhatsApp number</td>
</tr>
<tr>
<td><code>bio</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Agent bio/description</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'active'</td>
<td>active, inactive</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_user (user_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
<li><code>INDEX idx_status (status)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(User)</code> - agent punya user account</li>
<li><code>belongsTo(Office)</code> - agent belong to satu kantor</li>
<li><code>hasMany(Property)</code> - agent punya banyak listing</li>
<li><code>hasMany(Transaction as owner)</code> - transaksi sebagai pemilik</li>
<li><code>hasMany(Transaction as buyer)</code> - transaksi sebagai pembawa buyer</li>
<li><code>hasMany(Commission)</code> - komisi agen</li>
</ul>
<hr>
<h3>3.3 Property Management</h3>
<h4>Table: `properties`</h4>
<p><strong>Purpose:</strong> Store property listings</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → agents.id</td>
<td>Property owner (agent)</td>
</tr>
<tr>
<td><code>slug</code></td>
<td>VARCHAR(255)</td>
<td>UNIQUE, NOT NULL</td>
<td>URL-friendly slug</td>
</tr>
<tr>
<td><code>title</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Property title</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full description</td>
</tr>
<tr>
<td><code>type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>house, apartment, land, commercial</td>
</tr>
<tr>
<td><code>listing_type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>sale, rent, both</td>
</tr>
<tr>
<td><code>price</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Listing price (IDR)</td>
</tr>
<tr>
<td><code>price_per_sqm</code></td>
<td>DECIMAL(15,2)</td>
<td>NULLABLE</td>
<td>Price per m²</td>
</tr>
<tr>
<td><code>land_area</code></td>
<td>DECIMAL(10,2)</td>
<td>NULLABLE</td>
<td>Land area (m²)</td>
</tr>
<tr>
<td><code>building_area</code></td>
<td>DECIMAL(10,2)</td>
<td>NULLABLE</td>
<td>Building area (m²)</td>
</tr>
<tr>
<td><code>bedrooms</code></td>
<td>INT UNSIGNED</td>
<td>NULLABLE</td>
<td>Number of bedrooms</td>
</tr>
<tr>
<td><code>bathrooms</code></td>
<td>INT UNSIGNED</td>
<td>NULLABLE</td>
<td>Number of bathrooms</td>
</tr>
<tr>
<td><code>address</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Full address</td>
</tr>
<tr>
<td><code>city</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>City/Kabupaten</td>
</tr>
<tr>
<td><code>province</code></td>
<td>VARCHAR(100)</td>
<td>NULLABLE</td>
<td>Province</td>
</tr>
<tr>
<td><code>latitude</code></td>
<td>DECIMAL(10,8)</td>
<td>NULLABLE</td>
<td>GPS latitude</td>
</tr>
<tr>
<td><code>longitude</code></td>
<td>DECIMAL(11,8)</td>
<td>NULLABLE</td>
<td>GPS longitude</td>
</tr>
<tr>
<td><code>certificate_type</code></td>
<td>VARCHAR(50)</td>
<td>NULLABLE</td>
<td>SHM, HGB, dll</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'available'</td>
<td>available, pending, sold, rented</td>
</tr>
<tr>
<td><code>approval_status</code></td>
<td>ENUM</td>
<td>DEFAULT 'draft'</td>
<td>draft, pending, published, declined, need_revision</td>
</tr>
<tr>
<td><code>submitted_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>When agent submitted for review</td>
</tr>
<tr>
<td><code>reviewed_by</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>FK to users (Admin Kantor)</td>
</tr>
<tr>
<td><code>reviewed_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>When admin reviewed</td>
</tr>
<tr>
<td><code>revision_notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Notes from admin for revision</td>
</tr>
<tr>
<td><code>is_featured</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Featured listing</td>
</tr>
<tr>
<td><code>is_public</code></td>
<td>BOOLEAN</td>
<td>DEFAULT TRUE</td>
<td>Show in public marketplace</td>
</tr>
<tr>
<td><code>published_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Publication timestamp</td>
</tr>
<tr>
<td><code>views_count</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>View counter</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
<tr>
<td><code>deleted_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>Soft delete timestamp</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_slug (slug)</code></li>
<li><code>INDEX idx_agent (agent_id)</code></li>
<li><code>INDEX idx_type (type)</code></li>
<li><code>INDEX idx_listing_type (listing_type)</code></li>
<li><code>INDEX idx_status (status)</code></li>
<li><code>INDEX idx_approval_status (approval_status)</code></li>
<li><code>INDEX idx_reviewed_by (reviewed_by)</code></li>
<li><code>INDEX idx_city (city)</code></li>
<li><code>INDEX idx_price (price)</code></li>
<li><code>INDEX idx_is_public (is_public)</code></li>
<li><code>INDEX idx_published_at (published_at)</code></li>
<li><code>INDEX idx_created_at (created_at)</code></li>
<li><code>INDEX idx_deleted_at (deleted_at)</code></li>
<li><code>FULLTEXT idx_search (title, description, address)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Agent)</code> - property dimiliki agent</li>
<li><code>hasMany(PropertyPhoto)</code> - property punya banyak foto</li>
<li><code>hasMany(PropertyLink)</code> - property bisa punya banyak private links</li>
<li><code>hasOne(Transaction)</code> - property punya max 1 transaksi</li>
</ul>
<p><strong>Soft Delete:</strong></p>
<ul>
<li>Uses Laravel's <code>SoftDeletes</code> trait</li>
<li>Deleted properties tidak muncul di query default</li>
<li>Admin Master bisa restore jika diperlukan</li>
</ul>
<hr>
<h4>Table: `property_photos`</h4>
<p><strong>Purpose:</strong> Store property photos/images</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference</td>
</tr>
<tr>
<td><code>photo_url</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>File path/URL</td>
</tr>
<tr>
<td><code>order_number</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>Display order</td>
</tr>
<tr>
<td><code>is_cover</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Cover image flag</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Upload time</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_order (order_number)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - foto belong to property</li>
</ul>
<hr>
<h4>Table: `property_links`</h4>
<p><strong>Purpose:</strong> Store tokenized private links for exclusive property viewing</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → users.id</td>
<td>User who created the link</td>
</tr>
<tr>
<td><code>token</code></td>
<td>VARCHAR(64)</td>
<td>UNIQUE, NOT NULL</td>
<td>Random access token</td>
</tr>
<tr>
<td><code>expires_at</code></td>
<td>TIMESTAMP</td>
<td>NOT NULL</td>
<td>Link expiration time</td>
</tr>
<tr>
<td><code>is_used</code></td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Single-use flag</td>
</tr>
<tr>
<td><code>accessed_at</code></td>
<td>TIMESTAMP</td>
<td>NULLABLE</td>
<td>First access timestamp</td>
</tr>
<tr>
<td><code>access_count</code></td>
<td>INT UNSIGNED</td>
<td>DEFAULT 0</td>
<td>Number of times accessed</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Link creation time</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>UNIQUE KEY unique_token (token)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_created_by (created_by)</code></li>
<li><code>INDEX idx_expires_at (expires_at)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - link untuk property tertentu</li>
<li><code>belongsTo(User as creator)</code> - user yang generate link</li>
<li><code>hasMany(PropertyVisitor)</code> - link bisa punya banyak visitor</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Check if link is valid
public function isValid(): bool {
    return $this->expires_at > now() 
        && (!$this->is_used || $this->access_count == 0);
}

// Generate random token
public static function generateToken(): string {
    return Str::random(64);
}
</code></pre>
<hr>
<h4>Table: `property_visitors`</h4>
<p><strong>Purpose:</strong> Store visitor information from private link access (lead capture)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_link_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → property_links.id</td>
<td>Link yang diakses</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property reference (denormalized)</td>
</tr>
<tr>
<td><code>visitor_name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Visitor full name</td>
</tr>
<tr>
<td><code>visitor_email</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Visitor email</td>
</tr>
<tr>
<td><code>visitor_phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Visitor phone</td>
</tr>
<tr>
<td><code>visitor_whatsapp</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>WhatsApp number</td>
</tr>
<tr>
<td><code>interest_level</code></td>
<td>ENUM</td>
<td>DEFAULT 'medium'</td>
<td>low, medium, high, very_high</td>
</tr>
<tr>
<td><code>message</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Visitor's message/notes</td>
</tr>
<tr>
<td><code>visited_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>When visitor accessed</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>VARCHAR(45)</td>
<td>NULLABLE</td>
<td>Visitor IP (IPv4/IPv6)</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Browser user agent</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property_link (property_link_id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_visitor_email (visitor_email)</code></li>
<li><code>INDEX idx_visited_at (visited_at)</code></li>
<li><code>INDEX idx_interest_level (interest_level)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_link_id) REFERENCES property_links(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(PropertyLink)</code> - visitor dari link tertentu</li>
<li><code>belongsTo(Property)</code> - visitor tertarik ke property tertentu</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-notify agent when high interest visitor
PropertyVisitor::created(function ($visitor) {
    if (in_array($visitor->interest_level, ['high', 'very_high'])) {
        $visitor->property->agent->notify(
            new HighInterestLeadNotification($visitor)
        );
    }
});
</code></pre>
<hr>
<h3>3.4 Transactions & Commissions</h3>
<h4>Table: `transactions`</h4>
<p><strong>Purpose:</strong> Store property transactions (sale/rent)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>property_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → properties.id</td>
<td>Property sold/rented</td>
</tr>
<tr>
<td><code>agent_owner_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → agents.id</td>
<td>Property owner agent</td>
</tr>
<tr>
<td><code>agent_buyer_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → agents.id</td>
<td>Buyer's agent (optional)</td>
</tr>
<tr>
<td><code>buyer_name</code></td>
<td>VARCHAR(255)</td>
<td>NOT NULL</td>
<td>Buyer full name</td>
</tr>
<tr>
<td><code>buyer_phone</code></td>
<td>VARCHAR(20)</td>
<td>NULLABLE</td>
<td>Buyer contact</td>
</tr>
<tr>
<td><code>buyer_email</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Buyer email</td>
</tr>
<tr>
<td><code>transaction_type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>sale, rent</td>
</tr>
<tr>
<td><code>final_price</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Closing price (IDR)</td>
</tr>
<tr>
<td><code>commission_percentage</code></td>
<td>DECIMAL(5,2)</td>
<td>DEFAULT 2.00</td>
<td>Commission % (e.g., 2%)</td>
</tr>
<tr>
<td><code>transaction_date</code></td>
<td>DATE</td>
<td>NOT NULL</td>
<td>Transaction date</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'completed'</td>
<td>pending, completed, cancelled</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Additional notes</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_property (property_id)</code></li>
<li><code>INDEX idx_agent_owner (agent_owner_id)</code></li>
<li><code>INDEX idx_agent_buyer (agent_buyer_id)</code></li>
<li><code>INDEX idx_transaction_date (transaction_date)</code></li>
<li><code>INDEX idx_status (status)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (agent_owner_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (agent_buyer_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Property)</code> - transaction untuk property tertentu</li>
<li><code>belongsTo(Agent as agentOwner)</code> - agen pemilik</li>
<li><code>belongsTo(Agent as agentBuyer)</code> - agen pembawa buyer (optional)</li>
<li><code>hasMany(Commission)</code> - transaction generate multiple commissions</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-update property status when transaction created
Transaction::creating(function ($transaction) {
    $property = $transaction->property;
    
    if ($transaction->transaction_type === 'sale') {
        $property->status = 'sold';
    } else {
        $property->status = 'rented';
    }
    
    $property->save();
});
</code></pre>
<hr>
<h4>Table: `commissions`</h4>
<p><strong>Purpose:</strong> Store commission records for agents and offices</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>transaction_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>FK → transactions.id</td>
<td>Related transaction</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → agents.id</td>
<td>Agent (if applicable)</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE, FK → offices.id</td>
<td>Office (if applicable)</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>DECIMAL(15,2)</td>
<td>NOT NULL</td>
<td>Commission amount (IDR)</td>
</tr>
<tr>
<td><code>percentage</code></td>
<td>DECIMAL(5,2)</td>
<td>NOT NULL</td>
<td>Percentage from total</td>
</tr>
<tr>
<td><code>type</code></td>
<td>ENUM</td>
<td>NOT NULL</td>
<td>agent_owner, agent_buyer, office</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td>DEFAULT 'pending'</td>
<td>pending, paid, cancelled</td>
</tr>
<tr>
<td><code>paid_date</code></td>
<td>DATE</td>
<td>NULLABLE</td>
<td>Payment date</td>
</tr>
<tr>
<td><code>payment_method</code></td>
<td>VARCHAR(50)</td>
<td>NULLABLE</td>
<td>Transfer, Cash, etc</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td>NULLABLE</td>
<td>Payment notes</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Record creation</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>AUTO UPDATE</td>
<td>Last update</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_transaction (transaction_id)</code></li>
<li><code>INDEX idx_agent (agent_id)</code></li>
<li><code>INDEX idx_office (office_id)</code></li>
<li><code>INDEX idx_status (status)</code></li>
<li><code>INDEX idx_paid_date (paid_date)</code></li>
<li><code>INDEX idx_type (type)</code></li>
</ul>
<p><strong>Foreign Keys:</strong></p>
<ul>
<li><code>FOREIGN KEY (transaction_id) REFERENCES transactions(id) ON DELETE CASCADE</code></li>
<li><code>FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE RESTRICT</code></li>
<li><code>FOREIGN KEY (office_id) REFERENCES offices(id) ON DELETE RESTRICT</code></li>
</ul>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>belongsTo(Transaction)</code> - commission dari transaction</li>
<li><code>belongsTo(Agent)</code> - agent commission</li>
<li><code>belongsTo(Office)</code> - office commission</li>
</ul>
<p><strong>Business Logic:</strong></p>
<pre><code>// Auto-generate commissions when transaction created
Transaction::created(function ($transaction) {
    $commissions = CommissionService::calculate($transaction);
    
    foreach ($commissions as $commission) {
        Commission::create([
            'transaction_id' => $transaction->id,
            'agent_id' => $commission['agent_id'] ?? null,
            'office_id' => $commission['office_id'] ?? null,
            'amount' => $commission['amount'],
            'percentage' => $commission['percentage'],
            'type' => $commission['type'],
            'status' => 'pending',
        ]);
    }
});
</code></pre>
<hr>
<h2>4. Enum Values</h2>
<h3>4.1 user.role</h3>
<pre><code>enum UserRole: string {
    case ADMIN_MASTER = 'admin_master';
    case ADMIN_KANTOR = 'admin_kantor';
    case AGENT = 'agent';
    case BUYER = 'buyer';
}
</code></pre>
<h3>4.2 property.type</h3>
<pre><code>enum PropertyType: string {
    case HOUSE = 'house';         // Rumah
    case APARTMENT = 'apartment';  // Apartemen
    case LAND = 'land';            // Tanah
    case COMMERCIAL = 'commercial'; // Komersial
}
</code></pre>
<h3>4.3 property.listing_type</h3>
<pre><code>enum ListingType: string {
    case SALE = 'sale';  // Dijual
    case RENT = 'rent';  // Disewa
    case BOTH = 'both';  // Dijual & Disewa
}
</code></pre>
<h3>4.4 property.status</h3>
<pre><code>enum PropertyStatus: string {
    case AVAILABLE = 'available'; // Tersedia
    case PENDING = 'pending';     // Dalam nego
    case SOLD = 'sold';           // Terjual
    case RENTED = 'rented';       // Tersewa
}
</code></pre>
<h3>4.5 property.approval_status</h3>
<pre><code>enum PropertyApprovalStatus: string {
    case DRAFT = 'draft';                   // Belum disubmit, agent masih edit
    case PENDING = 'pending';               // Sudah disubmit, menunggu review
    case PUBLISHED = 'published';           // Approved, bisa dilihat publik
    case DECLINED = 'declined';             // Rejected permanently
    case NEED_REVISION = 'need_revision';   // Perlu diperbaiki agent
}
</code></pre>
<p><strong>Business Rules:</strong></p>
<ul>
<li>DRAFT → agent submit → PENDING</li>
<li>PENDING → admin approve → PUBLISHED</li>
<li>PENDING → admin decline → DECLINED</li>
<li>PENDING → admin request revision → NEED_REVISION</li>
<li>NEED_REVISION → agent perbaiki & resubmit → PENDING</li>
<li>Only PUBLISHED properties dapat dilihat di public marketplace</li>
<li>Property dengan is_public=false tetap bisa generate private link</li>
</ul>
<h3>4.6 property_visitor.interest_level</h3>
<pre><code>enum VisitorInterestLevel: string {
    case LOW = 'low';               // Hanya lihat-lihat
    case MEDIUM = 'medium';         // Cukup tertarik
    case HIGH = 'high';             // Sangat tertarik
    case VERY_HIGH = 'very_high';   // Siap beli/nego
}
</code></pre>
<p><strong>Business Logic:</strong></p>
<ul>
<li>Agent akan dapat notifikasi untuk HIGH dan VERY_HIGH interest</li>
<li>Visitor dengan VERY_HIGH prioritas untuk di-follow up</li>
</ul>
<h3>4.7 transaction.transaction_type</h3>
<pre><code>enum TransactionType: string {
    case SALE = 'sale'; // Jual
    case RENT = 'rent'; // Sewa
}
</code></pre>
<h3>4.8 transaction.status</h3>
<pre><code>enum TransactionStatus: string {
    case PENDING = 'pending';
    case COMPLETED = 'completed';
    case CANCELLED = 'cancelled';
}
</code></pre>
<h3>4.9 commission.type</h3>
<pre><code>enum CommissionType: string {
    case AGENT_OWNER = 'agent_owner';
    case AGENT_BUYER = 'agent_buyer';
    case OFFICE = 'office';
}
</code></pre>
<h3>4.10 commission.status</h3>
<pre><code>enum CommissionStatus: string {
    case PENDING = 'pending';
    case PAID = 'paid';
    case CANCELLED = 'cancelled';
}
</code></pre>
<hr>
<h2>4.11 Additional Tables</h2>
<h3>Table: `activity_log`</h3>
<p><strong>Purpose:</strong> Store audit trail for all important actions (using spatie/laravel-activitylog)</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>BIGINT UNSIGNED</td>
<td>PK, AUTO_INCREMENT</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>log_name</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Log category</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Action description</td>
</tr>
<tr>
<td><code>subject_type</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>Model class name</td>
</tr>
<tr>
<td><code>subject_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>Model ID</td>
</tr>
<tr>
<td><code>causer_type</code></td>
<td>VARCHAR(255)</td>
<td>NULLABLE</td>
<td>User model class</td>
</tr>
<tr>
<td><code>causer_id</code></td>
<td>BIGINT UNSIGNED</td>
<td>NULLABLE</td>
<td>User ID who caused</td>
</tr>
<tr>
<td><code>properties</code></td>
<td>JSON</td>
<td>NULLABLE</td>
<td>Old & new values</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT NOW</td>
<td>Action timestamp</td>
</tr>
</tbody>
</table>
<ul>
<li><code>PRIMARY KEY (id)</code></li>
<li><code>INDEX idx_subject (subject_type, subject_id)</code></li>
<li><code>INDEX idx_causer (causer_type, causer_id)</code></li>
<li><code>INDEX idx_log_name (log_name)</code></li>
<li><code>INDEX idx_created_at (created_at)</code></li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Track siapa yang create/update/delete properti</li>
<li>Track perubahan komisi</li>
<li>Track perubahan harga jual</li>
<li>Track approval/rejection</li>
<li>Track login/logout activity</li>
</ul>
<p><strong>Example Log:</strong></p>
<pre><code>// Automatic logging with spatie/laravel-activitylog
activity()
    ->performedOn($property)
    ->causedBy($user)
    ->withProperties([
        'old' => ['price' => 1000000000],
        'new' => ['price' => 900000000]
    ])
    ->log('Property price updated');
</code></pre>
<hr>
<h2>5. Database Migrations (Laravel)</h2>
<h3>5.1 Migration Order</h3>
<pre><code>1. 2025_11_01_000000_create_users_table.php
2. 2025_11_01_000001_create_password_reset_tokens_table.php
3. 2025_11_01_000002_create_sessions_table.php
4. 2025_11_01_000003_create_offices_table.php
5. 2025_11_01_000004_create_agents_table.php
6. 2025_11_01_000005_create_office_admins_table.php
7. 2025_11_01_000006_create_properties_table.php
8. 2025_11_01_000007_create_property_photos_table.php
9. 2025_11_01_000008_create_property_links_table.php
10. 2025_11_01_000009_create_transactions_table.php
11. 2025_11_01_000010_create_commissions_table.php
12. 2025_11_01_000011_create_activity_log_table.php
</code></pre>
<p><strong>Note:</strong> <code>activity_log</code> table will be auto-created by spatie/laravel-activitylog package via:</p>
<pre><code>php artisan vendor:publish --provider="Spatie\Activitylog\ActivitylogServiceProvider" --tag="activitylog-migrations"
php artisan migrate
</code></pre>
<hr>
<h2>6. Sample Data (Seeders)</h2>
<h3>6.1 Admin Master (Default)</h3>
<pre><code>User::create([
    'name' => 'Super Admin',
    'email' => 'admin@hendraprop.com',
    'password' => Hash::make('password'),
    'role' => 'admin_master',
    'is_active' => true,
]);
</code></pre>
<h3>6.2 Sample Offices</h3>
<pre><code>Office::create(['name' => 'Hendra Prop 1', 'address' => 'Jakarta', 'phone' => '021-xxx']);
Office::create(['name' => 'Hendra Prop 2', 'address' => 'Bandung', 'phone' => '022-xxx']);
Office::create(['name' => 'Hendra Prop 3', 'address' => 'Surabaya', 'phone' => '031-xxx']);
</code></pre>
<h3>6.3 Sample Agents</h3>
<pre><code>// Create user first
$user = User::create([
    'name' => 'Agent 1',
    'email' => 'agent1@hendraprop.com',
    'password' => Hash::make('password'),
    'role' => 'agent',
]);

// Create agent profile
Agent::create([
    'user_id' => $user->id,
    'office_id' => 1,
    'phone' => '08123456789',
    'whatsapp' => '08123456789',
    'status' => 'active',
]);
</code></pre>
<hr>
<h2>7. Query Examples</h2>
<h3>7.1 Get all properties with agent info</h3>
<pre><code>SELECT 
    p.id, p.title, p.price, p.status,
    a.id as agent_id,
    u.name as agent_name,
    o.name as office_name
FROM properties p
JOIN agents a ON p.agent_id = a.id
JOIN users u ON a.user_id = u.id
JOIN offices o ON a.office_id = o.id
WHERE p.status = 'available'
ORDER BY p.created_at DESC
LIMIT 20;
</code></pre>
<h3>7.2 Get agent performance (omzet & komisi)</h3>
<pre><code>SELECT 
    a.id,
    u.name as agent_name,
    COUNT(DISTINCT p.id) as total_listings,
    COUNT(DISTINCT t.id) as total_transactions,
    SUM(t.final_price) as total_omzet,
    SUM(c.amount) as total_commission,
    SUM(CASE WHEN c.status = 'pending' THEN c.amount ELSE 0 END) as commission_pending,
    SUM(CASE WHEN c.status = 'paid' THEN c.amount ELSE 0 END) as commission_paid
FROM agents a
JOIN users u ON a.user_id = u.id
LEFT JOIN properties p ON p.agent_id = a.id
LEFT JOIN transactions t ON t.agent_owner_id = a.id OR t.agent_buyer_id = a.id
LEFT JOIN commissions c ON c.agent_id = a.id
WHERE a.id = ?
GROUP BY a.id, u.name;
</code></pre>
<h3>7.3 Get office performance</h3>
<pre><code>SELECT 
    o.id,
    o.name as office_name,
    COUNT(DISTINCT a.id) as total_agents,
    COUNT(DISTINCT p.id) as total_listings,
    COUNT(DISTINCT t.id) as total_transactions,
    SUM(t.final_price) as total_omzet,
    SUM(c.amount) as office_commission
FROM offices o
LEFT JOIN agents a ON a.office_id = o.id
LEFT JOIN properties p ON p.agent_id = a.id
LEFT JOIN transactions t ON t.property_id = p.id
LEFT JOIN commissions c ON c.office_id = o.id
WHERE o.id = ?
GROUP BY o.id, o.name;
</code></pre>
<hr>
<h2>8. Performance Optimization</h2>
<h3>8.1 Index Strategy</h3>
<ul>
<li><strong>Primary Keys:</strong> All tables have auto-increment BIGINT primary key</li>
<li><strong>Foreign Keys:</strong> All FKs are indexed automatically</li>
<li><strong>Search Columns:</strong> city, type, status, price (for filtering)</li>
<li><strong>FULLTEXT:</strong> title, description, address (for search)</li>
<li><strong>Composite Index:</strong> (agent_id, status) pada properties</li>
</ul>
<h3>8.2 Query Optimization</h3>
<pre><code>// ❌ BAD: N+1 problem
$properties = Property::all();
foreach ($properties as $property) {
    echo $property->agent->user->name; // N queries
}

// ✅ GOOD: Eager loading
$properties = Property::with('agent.user', 'photos')->get(); // 1 query
</code></pre>
<h3>8.3 Caching Strategy</h3>
<pre><code>// Cache expensive queries
$topProperties = Cache::remember('properties:featured', 3600, function() {
    return Property::where('is_featured', true)
        ->with('agent.user', 'photos')
        ->take(10)
        ->get();
});
</code></pre>
<hr>
<h2>9. Backup Strategy</h2>
<h3>9.1 Daily Backup</h3>
<pre><code>#!/bin/bash
# Daily backup script
mysqldump -u root -p hendra_prop > /backup/hendra_prop_$(date +%Y%m%d).sql
</code></pre>
<h3>9.2 Retention Policy</h3>
<ul>
<li>Daily backups: Keep for 7 days</li>
<li>Weekly backups: Keep for 1 month</li>
<li>Monthly backups: Keep for 1 year</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0</p>
</div>

<div class="content-section page-break" id="section-9">
<h1>BAB 9: API Specifications</h1>

<p><strong>Dokumen API Specifications (For Future Mobile App)</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final</p>
<hr>
<h2>1. API Overview</h2>
<h3>1.1 Base Information</h3>
<ul>
<li><strong>Base URL:</strong> <code>https://api.hendraprop.com/v1</code></li>
<li><strong>Protocol:</strong> HTTPS only</li>
<li><strong>Format:</strong> JSON</li>
<li><strong>Authentication:</strong> Laravel Sanctum (Bearer Token)</li>
<li><strong>Rate Limiting:</strong> 60 requests/minute per user</li>
<li><strong>Versioning:</strong> URL-based (v1, v2, etc.)</li>
</ul>
<h3>1.2 Request Headers</h3>
<pre><code>Content-Type: application/json
Accept: application/json
Authorization: Bearer {token}
X-App-Version: 1.0.0 (optional)
</code></pre>
<h3>1.3 Response Format</h3>
<p><strong>Success Response (2xx):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 1,
    "title": "Rumah Mewah Jakarta Selatan",
    "price": 5000000000
  },
  "meta": {
    "current_page": 1,
    "total": 45
  },
  "message": "Property retrieved successfully"
}
</code></pre>
<p><strong>Error Response (4xx/5xx):</strong></p>
<pre><code>{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "The given data was invalid.",
    "details": {
      "title": ["The title field is required."],
      "price": ["The price must be a number."]
    }
  }
}
</code></pre>
<hr>
<h2>2. Authentication Endpoints</h2>
<h3>2.1 Login</h3>
<pre><code>POST /auth/login
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code>{
  "email": "agent@hendraprop.com",
  "password": "password123",
  "remember": true
}
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "token": "1|abc123def456ghi789...",
    "user": {
      "id": 5,
      "name": "Agent 1",
      "email": "agent@hendraprop.com",
      "role": "agent",
      "avatar": "https://..."
    }
  },
  "message": "Login successful"
}
</code></pre>
<hr>
<h3>2.2 Logout</h3>
<pre><code>POST /auth/logout
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "message": "Logged out successfully"
}
</code></pre>
<hr>
<h3>2.3 Get Current User</h3>
<pre><code>GET /auth/me
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 5,
    "name": "Agent 1",
    "email": "agent@hendraprop.com",
    "role": "agent",
    "agent": {
      "id": 3,
      "phone": "08123456789",
      "whatsapp": "08123456789",
      "office": {
        "id": 1,
        "name": "Hendra Prop 1"
      }
    }
  }
}
</code></pre>
<hr>
<h2>3. Property Endpoints</h2>
<h3>3.1 List Properties</h3>
<pre><code>GET /properties?page=1&type=house&status=available&price_min=1000000000&price_max=5000000000
</code></pre>
<p><strong>Query Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>page</code></td>
<td>int</td>
<td>Page number (default: 1)</td>
</tr>
<tr>
<td><code>per_page</code></td>
<td>int</td>
<td>Items per page (default: 20, max: 100)</td>
</tr>
<tr>
<td><code>type</code></td>
<td>string</td>
<td>Filter by type: house, apartment, land, commercial</td>
</tr>
<tr>
<td><code>listing_type</code></td>
<td>string</td>
<td>Filter: sale, rent, both</td>
</tr>
<tr>
<td><code>status</code></td>
<td>string</td>
<td>Filter: available, pending, sold, rented</td>
</tr>
<tr>
<td><code>price_min</code></td>
<td>decimal</td>
<td>Minimum price</td>
</tr>
<tr>
<td><code>price_max</code></td>
<td>decimal</td>
<td>Maximum price</td>
</tr>
<tr>
<td><code>city</code></td>
<td>string</td>
<td>Filter by city</td>
</tr>
<tr>
<td><code>search</code></td>
<td>string</td>
<td>Search keyword (title, description, address)</td>
</tr>
<tr>
<td><code>sort</code></td>
<td>string</td>
<td>Sort by: price_asc, price_desc, date_desc, views_desc</td>
</tr>
</tbody>
</table>
<pre><code>{
  "success": true,
  "data": [
    {
      "id": 1,
      "slug": "rumah-mewah-jakarta-selatan",
      "title": "Rumah Mewah Jakarta Selatan",
      "type": "house",
      "listing_type": "sale",
      "price": 5000000000,
      "price_per_sqm": 15000000,
      "land_area": 300,
      "building_area": 250,
      "bedrooms": 4,
      "bathrooms": 3,
      "address": "Jl. Kemang Raya No. 10",
      "city": "Jakarta Selatan",
      "status": "available",
      "cover_image": "https://storage.hendraprop.com/properties/1/cover.jpg",
      "views": 152,
      "agent": {
        "id": 3,
        "name": "Agent 1",
        "phone": "08123456789",
        "whatsapp": "08123456789",
        "avatar": "https://..."
      },
      "created_at": "2025-10-15T10:30:00Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "last_page": 5,
    "per_page": 20,
    "total": 95,
    "from": 1,
    "to": 20
  }
}
</code></pre>
<hr>
<h3>3.2 Get Property Detail</h3>
<pre><code>GET /properties/{id}
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 1,
    "slug": "rumah-mewah-jakarta-selatan",
    "title": "Rumah Mewah Jakarta Selatan",
    "description": "Rumah mewah dengan design modern minimalis...",
    "type": "house",
    "listing_type": "sale",
    "price": 5000000000,
    "price_per_sqm": 15000000,
    "land_area": 300,
    "building_area": 250,
    "bedrooms": 4,
    "bathrooms": 3,
    "address": "Jl. Kemang Raya No. 10, Jakarta Selatan",
    "city": "Jakarta Selatan",
    "province": "DKI Jakarta",
    "latitude": -6.259051,
    "longitude": 106.818134,
    "certificate_type": "SHM",
    "status": "available",
    "is_featured": true,
    "views": 152,
    "photos": [
      {
        "id": 1,
        "url": "https://storage.hendraprop.com/properties/1/photo1.jpg",
        "order": 1,
        "is_cover": true
      },
      {
        "id": 2,
        "url": "https://storage.hendraprop.com/properties/1/photo2.jpg",
        "order": 2,
        "is_cover": false
      }
    ],
    "agent": {
      "id": 3,
      "name": "Agent 1",
      "phone": "08123456789",
      "whatsapp": "08123456789",
      "bio": "Experienced property agent...",
      "avatar": "https://..."
    },
    "created_at": "2025-10-15T10:30:00Z",
    "updated_at": "2025-10-20T15:45:00Z"
  }
}
</code></pre>
<hr>
<h3>3.3 Create Property</h3>
<pre><code>POST /properties
</code></pre>
<p><strong>Request Body (multipart/form-data):</strong></p>
<pre><code>{
  "title": "Rumah Mewah Jakarta Selatan",
  "description": "Rumah mewah dengan design modern...",
  "type": "house",
  "listing_type": "sale",
  "price": 5000000000,
  "land_area": 300,
  "building_area": 250,
  "bedrooms": 4,
  "bathrooms": 3,
  "address": "Jl. Kemang Raya No. 10",
  "city": "Jakarta Selatan",
  "province": "DKI Jakarta",
  "latitude": -6.259051,
  "longitude": 106.818134,
  "certificate_type": "SHM",
  "photos": [
    "file1.jpg",
    "file2.jpg"
  ]
}
</code></pre>
<p><strong>Response (201 Created):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 15,
    "slug": "rumah-mewah-jakarta-selatan",
    "title": "Rumah Mewah Jakarta Selatan",
    ...
  },
  "message": "Property created successfully"
}
</code></pre>
<hr>
<h3>3.4 Update Property</h3>
<pre><code>PUT /properties/{id}
</code></pre>
<p><strong>Request Body:</strong> (same as create)</p>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": { ... },
  "message": "Property updated successfully"
}
</code></pre>
<hr>
<h3>3.5 Delete Property</h3>
<pre><code>DELETE /properties/{id}
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "message": "Property deleted successfully"
}
</code></pre>
<hr>
<h2>4. Transaction Endpoints</h2>
<h3>4.1 List Transactions</h3>
<pre><code>GET /transactions?agent_id=3&status=completed&date_from=2025-01-01&date_to=2025-12-31
</code></pre>
<p><strong>Query Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent_id</code></td>
<td>int</td>
<td>Filter by agent</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>int</td>
<td>Filter by office</td>
</tr>
<tr>
<td><code>status</code></td>
<td>string</td>
<td>Filter: pending, completed, cancelled</td>
</tr>
<tr>
<td><code>date_from</code></td>
<td>date</td>
<td>Start date (YYYY-MM-DD)</td>
</tr>
<tr>
<td><code>date_to</code></td>
<td>date</td>
<td>End date (YYYY-MM-DD)</td>
</tr>
</tbody>
</table>
<pre><code>{
  "success": true,
  "data": [
    {
      "id": 10,
      "property": {
        "id": 1,
        "title": "Rumah Mewah Jakarta Selatan",
        "cover_image": "https://..."
      },
      "agent_owner": {
        "id": 3,
        "name": "Agent 1"
      },
      "agent_buyer": {
        "id": 5,
        "name": "Agent 2"
      },
      "buyer_name": "John Doe",
      "buyer_phone": "08123456789",
      "transaction_type": "sale",
      "final_price": 4800000000,
      "commission_percentage": 2,
      "transaction_date": "2025-10-20",
      "status": "completed",
      "created_at": "2025-10-20T16:00:00Z"
    }
  ],
  "meta": {
    "total": 12
  }
}
</code></pre>
<hr>
<h3>4.2 Create Transaction</h3>
<pre><code>POST /transactions
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code>{
  "property_id": 1,
  "agent_buyer_id": 5,
  "buyer_name": "John Doe",
  "buyer_phone": "08123456789",
  "buyer_email": "john@example.com",
  "transaction_type": "sale",
  "final_price": 4800000000,
  "commission_percentage": 2,
  "transaction_date": "2025-10-20",
  "notes": "Deal after nego"
}
</code></pre>
<p><strong>Response (201 Created):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 15,
    "property_id": 1,
    "final_price": 4800000000,
    "commissions": [
      {
        "type": "agent_owner",
        "agent_id": 3,
        "amount": 33600000,
        "percentage": 35,
        "status": "pending"
      },
      {
        "type": "agent_buyer",
        "agent_id": 5,
        "amount": 33600000,
        "percentage": 35,
        "status": "pending"
      },
      {
        "type": "office",
        "office_id": 1,
        "amount": 28800000,
        "percentage": 30,
        "status": "pending"
      }
    ]
  },
  "message": "Transaction created successfully"
}
</code></pre>
<hr>
<h2>5. Commission Endpoints</h2>
<h3>5.1 List Commissions</h3>
<pre><code>GET /commissions?agent_id=3&status=pending
</code></pre>
<p><strong>Query Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent_id</code></td>
<td>int</td>
<td>Filter by agent</td>
</tr>
<tr>
<td><code>office_id</code></td>
<td>int</td>
<td>Filter by office</td>
</tr>
<tr>
<td><code>status</code></td>
<td>string</td>
<td>Filter: pending, paid, cancelled</td>
</tr>
<tr>
<td><code>date_from</code></td>
<td>date</td>
<td>Start date</td>
</tr>
<tr>
<td><code>date_to</code></td>
<td>date</td>
<td>End date</td>
</tr>
</tbody>
</table>
<pre><code>{
  "success": true,
  "data": [
    {
      "id": 25,
      "transaction": {
        "id": 10,
        "property": {
          "title": "Rumah Mewah Jakarta Selatan"
        },
        "transaction_date": "2025-10-20"
      },
      "amount": 33600000,
      "percentage": 35,
      "type": "agent_owner",
      "status": "pending",
      "paid_date": null,
      "created_at": "2025-10-20T16:00:00Z"
    }
  ],
  "meta": {
    "total_pending": 100000000,
    "total_paid": 50000000,
    "total_all": 150000000
  }
}
</code></pre>
<hr>
<h3>5.2 Mark Commission as Paid</h3>
<pre><code>PUT /commissions/{id}/pay
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code>{
  "paid_date": "2025-10-25",
  "payment_method": "bank_transfer",
  "notes": "Transfer to BCA 1234567890"
}
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "id": 25,
    "status": "paid",
    "paid_date": "2025-10-25",
    "payment_method": "bank_transfer"
  },
  "message": "Commission marked as paid"
}
</code></pre>
<hr>
<h2>6. Dashboard Endpoints</h2>
<h3>6.1 Agent Performance</h3>
<pre><code>GET /dashboard/agent/{agent_id}?date_from=2025-01-01&date_to=2025-12-31
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "agent": {
      "id": 3,
      "name": "Agent 1"
    },
    "metrics": {
      "total_listings": 25,
      "total_listings_sold": 10,
      "total_transactions": 12,
      "total_omzet": 50000000000,
      "total_commission": 1200000000,
      "commission_pending": 500000000,
      "commission_paid": 700000000
    },
    "omzet_per_month": [
      { "month": "2025-01", "omzet": 5000000000 },
      { "month": "2025-02", "omzet": 8000000000 }
    ]
  }
}
</code></pre>
<hr>
<h3>6.2 Office Performance</h3>
<pre><code>GET /dashboard/office/{office_id}?date_from=2025-01-01&date_to=2025-12-31
</code></pre>
<p><strong>Response (200 OK):</strong></p>
<pre><code>{
  "success": true,
  "data": {
    "office": {
      "id": 1,
      "name": "Hendra Prop 1"
    },
    "metrics": {
      "total_agents": 15,
      "total_listings": 120,
      "total_transactions": 45,
      "total_omzet": 150000000000,
      "office_commission": 2000000000
    },
    "agents_performance": [
      {
        "agent_id": 3,
        "name": "Agent 1",
        "total_listings": 25,
        "total_omzet": 50000000000,
        "total_commission": 1200000000
      }
    ]
  }
}
</code></pre>
<hr>
<h2>7. Error Codes</h2>
<table>
<thead>
<tr>
<th>Code</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>VALIDATION_ERROR</code></td>
<td>422</td>
<td>Input validation failed</td>
</tr>
<tr>
<td><code>UNAUTHORIZED</code></td>
<td>401</td>
<td>Not authenticated</td>
</tr>
<tr>
<td><code>FORBIDDEN</code></td>
<td>403</td>
<td>No permission to access resource</td>
</tr>
<tr>
<td><code>NOT_FOUND</code></td>
<td>404</td>
<td>Resource not found</td>
</tr>
<tr>
<td><code>SERVER_ERROR</code></td>
<td>500</td>
<td>Internal server error</td>
</tr>
<tr>
<td><code>RATE_LIMIT_EXCEEDED</code></td>
<td>429</td>
<td>Too many requests</td>
</tr>
</tbody>
</table>
<h2>8. Rate Limiting</h2>
<ul>
<li><strong>Default:</strong> 60 requests/minute per user</li>
<li><strong>Authenticated:</strong> 120 requests/minute</li>
<li><strong>Public endpoints:</strong> 30 requests/minute per IP</li>
</ul>
<p><strong>Response when rate limit exceeded:</strong></p>
<pre><code>{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests. Please try again in 60 seconds.",
    "retry_after": 60
  }
}
</code></pre>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0</p>
</div>

<div class="content-section page-break" id="section-10">
<h1>BAB 10: Sprint Planning & Project Timeline</h1>

<p><strong>Dokumen Sprint Planning & Timeline</strong>  </p>
<p>Proyek: Hendra Prop - Sistem Manajemen Properti  </p>
<p>Tanggal: 31 Oktober 2025  </p>
<p>Versi: Final  </p>
<p><strong>Target Launch:</strong> Maret 2026</p>
<hr>
<h2>1. Project Timeline Overview</h2>
<pre><code>Nov 2025        Dec 2025        Jan 2026        Feb 2026        Mar 2026
┌────────────┬────────────┬────────────┬────────────┬────────────┐
│ Setup      │ Sprint 1-2 │ Sprint 3-4 │ Sprint 5-6 │ Testing &  │
│ & Planning │ Foundation │ Public Web │ Dashboard  │ Launch     │
│ (1 week)   │ (4 weeks)  │ (4 weeks)  │ (4 weeks)  │ (3 weeks)  │
└────────────┴────────────┴────────────┴────────────┴────────────┘
</code></pre>
<p><strong>Breakdown:</strong></p>
<ul>
<li>Week 1: Setup & Planning (4-10 Nov)</li>
<li>Week 2-3: Sprint 1 (11-24 Nov)</li>
<li>Week 4-5: Sprint 2 (25 Nov - 8 Des)</li>
<li>Week 6-7: Sprint 3 (9-22 Des)</li>
<li>Week 8-9: Sprint 4 (23 Des - 5 Jan)</li>
<li>Week 10-11: Sprint 5 (6-19 Jan)</li>
<li>Week 12-13: Sprint 6 (20 Jan - 2 Feb)</li>
<li>Week 14-15: Testing & QA (3-16 Feb)</li>
<li>Week 16: Bug Fixing & Polish (17-23 Feb)</li>
<li>Week 17: Soft Launch Preparation (24 Feb - 2 Mar)</li>
<li><strong>Launch:</strong> 3 Maret 2026</li>
</ul>
<hr>
<h2>2. Sprint 0: Setup & Planning (Week 1)</h2>
<p><strong>Duration:</strong> 4-10 November 2025  </p>
<p><strong>Goal:</strong> Project kickoff, setup environment, finalize requirements</p>
<h3>Tasks</h3>
<ul>
<li>[x] ✅ Review & approval dokumen analisis</li>
<li>[ ] Setup Git repository (GitHub/GitLab)</li>
<li>[ ] Setup development environment</li>
<li>[ ] Install Laravel 11 + Filament 3</li>
<li>[ ] Setup database (MySQL)</li>
<li>[ ] Configure Caddy web server</li>
<li>[ ] Setup staging server (VPS)</li>
<li>[ ] Finalize UI/UX mockup (optional)</li>
<li>[ ] Team onboarding & training</li>
</ul>
<h3>Deliverables</h3>
<ul>
<li>✅ Approved documentation</li>
<li>Git repo dengan initial commit</li>
<li>Development environment ready</li>
<li>Staging server ready</li>
<li>Project board setup (Trello/Jira)</li>
</ul>
<hr>
<h2>3. Sprint 1: Authentication & Organization (Week 2-3)</h2>
<p><strong>Duration:</strong> 11-24 November 2025  </p>
<p><strong>Goal:</strong> Multi-role authentication & CRUD Kantor/Agen</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-AUTH-001</td>
<td>Login Admin Master</td>
<td>3</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-AUTH-002</td>
<td>Login Admin Kantor</td>
<td>2</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-AUTH-003</td>
<td>Login Agen</td>
<td>2</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-OFFICE-001</td>
<td>Create Kantor</td>
<td>3</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-OFFICE-002</td>
<td>Edit & Delete Kantor</td>
<td>2</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-AGENT-001</td>
<td>Create Agen</td>
<td>5</td>
<td>Backend Dev</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Setup Laravel Breeze/Fortify authentication</li>
<li>[ ] Create User, Office, Agent models & migrations</li>
<li>[ ] Implement role-based access control (Gates & Policies)</li>
<li>[ ] Create Filament resources for Office & Agent</li>
<li>[ ] Setup email (SMTP for password reset)</li>
<li>[ ] Write unit tests for auth & CRUD</li>
</ul>
<h3>Daily Standup Topics</h3>
<ul>
<li>Authentication flow implementation</li>
<li>Database migration execution</li>
<li>Permission testing per role</li>
<li>Email setup (local & staging)</li>
</ul>
<h3>Sprint Review</h3>
<ul>
<li><strong>Demo:</strong> Login multi-role & CRUD kantor/agen</li>
<li><strong>Retrospective:</strong> What went well? What to improve?</li>
</ul>
<h3>Definition of Done</h3>
<ul>
<li>✅ All user stories completed & tested</li>
<li>✅ Code reviewed & merged to develop</li>
<li>✅ Unit tests passing</li>
<li>✅ Deployed to staging</li>
<li>✅ Demo approved by stakeholder</li>
</ul>
<hr>
<h2>4. Sprint 2: Property Management (Week 4-5)</h2>
<p><strong>Duration:</strong> 25 Nov - 8 Desember 2025  </p>
<p><strong>Goal:</strong> CRUD Properti dengan upload multiple foto</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-AUTH-004</td>
<td>Forgot Password</td>
<td>5</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-AGENT-002</td>
<td>Edit Profile Agen</td>
<td>3</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-PROP-001</td>
<td>Create Listing</td>
<td>8</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-PROP-002</td>
<td>Edit Listing</td>
<td>5</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-PROP-004</td>
<td>Upload Foto</td>
<td>5</td>
<td>Backend Dev</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Create Property & PropertyPhoto models</li>
<li>[ ] Implement image upload dengan validation</li>
<li>[ ] Image optimization (resize, compress)</li>
<li>[ ] Slug generation untuk SEO</li>
<li>[ ] Filament resource untuk Property management</li>
<li>[ ] Drag & drop foto reorder</li>
<li>[ ] Form wizard untuk create property (step by step)</li>
</ul>
<h3>Challenges</h3>
<ul>
<li><strong>Challenge 1:</strong> Upload multiple foto sekaligus</li>
<li><strong>Solution:</strong> Use Livewire file upload atau Filepond.js</li>
<li><strong>Challenge 2:</strong> Image optimization</li>
<li><strong>Solution:</strong> Intervention/Image library</li>
</ul>
<h3>Testing Focus</h3>
<ul>
<li>Upload foto (max 10, max 5MB, JPG/PNG only)</li>
<li>Image resize & compress quality</li>
<li>Slug uniqueness</li>
<li>Permission: Agen hanya edit properti miliknya</li>
</ul>
<h3>Definition of Done</h3>
<ul>
<li>✅ Create & edit property working</li>
<li>✅ Upload foto berhasil (max 10)</li>
<li>✅ Foto ter-resize & compress</li>
<li>✅ Agen tidak bisa edit properti agen lain</li>
<li>✅ Unit & feature tests passing</li>
</ul>
<hr>
<h2>5. Sprint 3: Public Listing Website (Week 6-7)</h2>
<p><strong>Duration:</strong> 9-22 Desember 2025  </p>
<p><strong>Goal:</strong> Public website untuk buyer browse & search properti</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-PROP-003</td>
<td>Delete Listing</td>
<td>3</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-PUBLIC-001</td>
<td>Browse Listing</td>
<td>5</td>
<td>Frontend Dev</td>
</tr>
<tr>
<td>US-PUBLIC-002</td>
<td>Search & Filter</td>
<td>8</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-PUBLIC-003</td>
<td>View Detail</td>
<td>8</td>
<td>Frontend Dev</td>
</tr>
<tr>
<td>US-PUBLIC-004</td>
<td>Kontak Agen WA</td>
<td>3</td>
<td>Frontend Dev</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Create public-facing layout (Blade + Tailwind)</li>
<li>[ ] Property listing page dengan pagination</li>
<li>[ ] Search & filter implementation</li>
<li>[ ] Property detail page dengan gallery</li>
<li>[ ] WhatsApp deep link integration</li>
<li>[ ] Google Maps integration (optional)</li>
<li>[ ] SEO optimization (meta tags, sitemap)</li>
<li>[ ] Mobile responsive design</li>
</ul>
<h3>Design Requirements</h3>
<ul>
<li><strong>Homepage:</strong> Hero section + featured listings</li>
<li><strong>Listing Page:</strong> Grid view, search bar, filter sidebar</li>
<li><strong>Detail Page:</strong> Photo gallery, info, map, agent contact</li>
</ul>
<h3>Performance Targets</h3>
<ul>
<li>Page load time < 2 detik</li>
<li>Mobile responsive (100%)</li>
<li>SEO score > 80 (PageSpeed Insights)</li>
</ul>
<h3>Definition of Done</h3>
<ul>
<li>✅ Public listing accessible tanpa login</li>
<li>✅ Search & filter working</li>
<li>✅ Mobile responsive</li>
<li>✅ WhatsApp button buka WA app</li>
<li>✅ SEO meta tags set</li>
</ul>
<hr>
<h2>6. Sprint 4: Transaction & Commission (Week 8-9)</h2>
<p><strong>Duration:</strong> 23 Des - 5 Januari 2026  </p>
<p><strong>Goal:</strong> Input transaksi & auto-calculate komisi</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-TRANS-001</td>
<td>Input Transaksi</td>
<td>8</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-TRANS-002</td>
<td>View List Transaksi</td>
<td>5</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-TRANS-003</td>
<td>View Detail Transaksi</td>
<td>3</td>
<td>Frontend Dev</td>
</tr>
<tr>
<td>US-COMM-001</td>
<td>Auto-Calculate Komisi</td>
<td>8</td>
<td>Backend Dev</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Create Transaction & Commission models</li>
<li>[ ] Commission calculation service/logic</li>
<li>[ ] Filament resource untuk Transaction</li>
<li>[ ] Auto-update property status saat transaksi</li>
<li>[ ] Transaction detail view dengan komisi breakdown</li>
<li>[ ] Unit tests untuk commission calculation</li>
</ul>
<h3>Commission Logic</h3>
<pre><code>// Scenario 1: Hanya agen owner
- Agen owner: 70% dari total komisi
- Kantor: 30% dari total komisi

// Scenario 2: Agen owner + agen buyer
- Agen owner: 35% dari total komisi
- Agen buyer: 35% dari total komisi
- Kantor: 30% dari total komisi
</code></pre>
<h3>Testing Scenarios</h3>
<p>1. Transaction dengan 1 agen → komisi 70/30</p>
<p>2. Transaction dengan 2 agen → komisi 35/35/30</p>
<p>3. Override komisi % manual</p>
<p>4. Property status auto-change ke sold/rented</p>
<p>5. Tidak bisa delete transaction yang sudah ada komisi</p>
<h3>Definition of Done</h3>
<ul>
<li>✅ Input transaksi working</li>
<li>✅ Komisi auto-calculate dengan benar</li>
<li>✅ Support 1 atau 2 agen</li>
<li>✅ Property status auto-update</li>
<li>✅ Unit tests untuk logic komisi passing</li>
</ul>
<hr>
<h2>7. Sprint 5: Commission Management & Dashboard (Week 10-11)</h2>
<p><strong>Duration:</strong> 6-19 Januari 2026  </p>
<p><strong>Goal:</strong> Mark komisi paid & dashboard personal agen</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-COMM-002</td>
<td>Mark Komisi Paid</td>
<td>5</td>
<td>Backend Dev</td>
</tr>
<tr>
<td>US-COMM-003</td>
<td>View Komisi Pending/Paid</td>
<td>5</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-DASH-001</td>
<td>Dashboard Personal Agen</td>
<td>8</td>
<td>Full Stack Dev</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Komisi status management (pending → paid)</li>
<li>[ ] Dashboard widgets untuk agen</li>
<li>[ ] Chart implementation (Chart.js / ApexCharts)</li>
<li>[ ] Commission list dengan filter & export</li>
<li>[ ] Email notification saat komisi paid</li>
<li>[ ] Performance query optimization</li>
</ul>
<h3>Dashboard Widgets (Agen)</h3>
<ul>
<li>Total Listing Active</li>
<li>Total Omzet</li>
<li>Total Komisi</li>
<li>Komisi Pending</li>
<li>Komisi Paid</li>
<li>Chart: Omzet per bulan</li>
</ul>
<h3>Performance Optimization</h3>
<ul>
<li>Cache dashboard metrics (TTL: 1 jam)</li>
<li>Eager loading untuk avoid N+1</li>
<li>Database indexing</li>
</ul>
<h3>Definition of Done</h3>
<ul>
<li>✅ Mark komisi paid working</li>
<li>✅ Dashboard show real-time data</li>
<li>✅ Chart rendering correctly</li>
<li>✅ Export komisi ke Excel</li>
<li>✅ Email notification sent</li>
</ul>
<hr>
<h2>8. Sprint 6: Dashboard Kantor & Master + Polish (Week 12-13)</h2>
<p><strong>Duration:</strong> 20 Jan - 2 Februari 2026  </p>
<p><strong>Goal:</strong> Dashboard agregat & final polish</p>
<h3>User Stories</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Story</th>
<th>Points</th>
<th>Assignee</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-DASH-002</td>
<td>Dashboard Kantor</td>
<td>8</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>US-DASH-003</td>
<td>Dashboard Master</td>
<td>8</td>
<td>Full Stack Dev</td>
</tr>
<tr>
<td>-</td>
<td>Bug Fixing & Polish</td>
<td>10</td>
<td>All Team</td>
</tr>
</tbody>
</table>
<h3>Technical Tasks</h3>
<ul>
<li>[ ] Dashboard kantor (aggregate agen)</li>
<li>[ ] Dashboard master (aggregate kantor)</li>
<li>[ ] Performance optimization</li>
<li>[ ] Code refactoring</li>
<li>[ ] UI/UX polish</li>
<li>[ ] Bug fixing dari sprint sebelumnya</li>
</ul>
<h3>Dashboard Widgets (Admin Kantor)</h3>
<ul>
<li>Total Agen Active</li>
<li>Total Listing</li>
<li>Total Omzet Kantor</li>
<li>Komisi Kantor</li>
<li>Table: Performance per agen</li>
</ul>
<h3>Dashboard Widgets (Admin Master)</h3>
<ul>
<li>Total Kantor</li>
<li>Total Agen</li>
<li>Total Listing</li>
<li>Total Omzet Global</li>
<li>Table: Performance per kantor</li>
</ul>
<h3>Code Quality Checklist</h3>
<ul>
<li>[ ] Laravel Pint (code style)</li>
<li>[ ] PHPStan level 5</li>
<li>[ ] No N+1 queries</li>
<li>[ ] Security audit (SQL injection, XSS, CSRF)</li>
<li>[ ] Remove debug code</li>
</ul>
<h3>Definition of Done</h3>
<ul>
<li>✅ Dashboard kantor & master working</li>
<li>✅ All critical bugs fixed</li>
<li>✅ Code quality check passed</li>
<li>✅ Performance optimized</li>
<li>✅ Ready for testing phase</li>
</ul>
<hr>
<h2>9. Testing & QA Phase (Week 14-15)</h2>
<p><strong>Duration:</strong> 3-16 Februari 2026  </p>
<p><strong>Goal:</strong> Comprehensive testing & QA</p>
<h3>Testing Activities</h3>
<ul>
<li>[ ] <strong>Unit Testing:</strong> All critical functions</li>
<li>[ ] <strong>Feature Testing:</strong> End-to-end user flows</li>
<li>[ ] <strong>Browser Testing:</strong> Chrome, Firefox, Safari, Edge</li>
<li>[ ] <strong>Mobile Testing:</strong> iOS Safari, Android Chrome</li>
<li>[ ] <strong>Performance Testing:</strong> Load testing dengan K6</li>
<li>[ ] <strong>Security Testing:</strong> OWASP top 10</li>
<li>[ ] <strong>User Acceptance Testing (UAT):</strong> Stakeholder testing</li>
</ul>
<h3>Test Scenarios (UAT)</h3>
<p>1. <strong>End-to-End Listing Flow</strong></p>
<ul>
<li>Agen create listing → Public view → Buyer kontak</li>
</ul>
<p>2. <strong>End-to-End Transaction Flow</strong></p>
<ul>
<li>Admin input transaksi → Komisi auto-calculate → Mark paid</li>
</ul>
<p>3. <strong>Permission Testing</strong></p>
<ul>
<li>Agen tidak bisa akses data agen lain</li>
<li>Admin Kantor tidak bisa akses kantor lain</li>
</ul>
<p>4. <strong>Multi-Agen Transaction</strong></p>
<ul>
<li>Transaksi dengan 2 agen → Komisi split 35/35/30</li>
</ul>
<h3>Bug Severity Classification</h3>
<ul>
<li><strong>P0 - Critical:</strong> System crash, data loss, security breach → Fix immediately</li>
<li><strong>P1 - High:</strong> Major feature broken → Fix within 24 hours</li>
<li><strong>P2 - Medium:</strong> Minor feature broken → Fix within 1 week</li>
<li><strong>P3 - Low:</strong> Cosmetic issues → Fix if time allows</li>
</ul>
<h3>QA Checklist</h3>
<ul>
<li>[ ] All features working as expected</li>
<li>[ ] No critical or high bugs</li>
<li>[ ] Performance < 2 sec page load</li>
<li>[ ] Mobile responsive 100%</li>
<li>[ ] SEO optimization done</li>
<li>[ ] Security audit passed</li>
</ul>
<hr>
<h2>10. Bug Fixing & Polish (Week 16)</h2>
<p><strong>Duration:</strong> 17-23 Februari 2026  </p>
<p><strong>Goal:</strong> Fix all bugs from testing phase</p>
<h3>Activities</h3>
<ul>
<li>[ ] Fix all P0 & P1 bugs</li>
<li>[ ] Fix selected P2 bugs</li>
<li>[ ] UI/UX refinement</li>
<li>[ ] Content preparation (copy, images)</li>
<li>[ ] Documentation update</li>
</ul>
<h3>Launch Preparation</h3>
<ul>
<li>[ ] Production server setup</li>
<li>[ ] SSL certificate installation</li>
<li>[ ] Database migration to production</li>
<li>[ ] Backup strategy implementation</li>
<li>[ ] Monitoring setup (UptimeRobot, Sentry)</li>
</ul>
<hr>
<h2>11. Soft Launch Preparation (Week 17)</h2>
<p><strong>Duration:</strong> 24 Feb - 2 Maret 2026  </p>
<p><strong>Goal:</strong> Prepare for production launch</p>
<h3>Pre-Launch Checklist</h3>
<ul>
<li>[ ] Production environment tested</li>
<li>[ ] Database seeded dengan sample data</li>
<li>[ ] Admin accounts created</li>
<li>[ ] User training completed</li>
<li>[ ] Documentation finalized</li>
<li>[ ] Backup verified</li>
<li>[ ] Rollback plan ready</li>
<li>[ ] Support process defined</li>
</ul>
<h3>Launch Day Activities</h3>
<ul>
<li>[ ] Final smoke test</li>
<li>[ ] Deploy to production</li>
<li>[ ] DNS switch (if needed)</li>
<li>[ ] Monitor errors & performance</li>
<li>[ ] Stakeholder notification</li>
</ul>
<hr>
<h2>12. Post-Launch (Week 18+)</h2>
<p><strong>Duration:</strong> 3 Maret 2026 onwards  </p>
<p><strong>Goal:</strong> Monitor, support, and iterate</p>
<h3>Week 1 Post-Launch</h3>
<ul>
<li>[ ] Daily monitoring</li>
<li>[ ] Collect user feedback</li>
<li>[ ] Fix critical bugs ASAP</li>
<li>[ ] Performance tuning</li>
</ul>
<h3>Week 2-4 Post-Launch</h3>
<ul>
<li>[ ] Analyze usage data</li>
<li>[ ] Plan Phase 2 features</li>
<li>[ ] Refine based on feedback</li>
</ul>
<h3>Phase 2 Features (Optional)</h3>
<ul>
<li>Moderasi properti</li>
<li>Link sharing terbatas</li>
<li>Reward system</li>
<li>Email notification automation</li>
<li>Advanced analytics</li>
<li>Mobile app (React Native / Flutter)</li>
</ul>
<hr>
<h2>13. Team & Resources</h2>
<h3>Team Structure</h3>
<ul>
<li><strong>Backend Developer:</strong> 1-2 orang</li>
<li><strong>Frontend Developer:</strong> 1 orang</li>
<li><strong>Full Stack Developer:</strong> 1 orang (optional)</li>
<li><strong>UI/UX Designer:</strong> 1 orang (part-time)</li>
<li><strong>QA Tester:</strong> 1 orang</li>
<li><strong>Project Manager:</strong> 1 orang</li>
</ul>
<h3>Tools & Services</h3>
<ul>
<li><strong>Version Control:</strong> Git + GitHub/GitLab</li>
<li><strong>Project Management:</strong> Trello / Jira / Linear</li>
<li><strong>Communication:</strong> Slack / Discord</li>
<li><strong>Code Quality:</strong> Laravel Pint, PHPStan</li>
<li><strong>Testing:</strong> PHPUnit, Pest, Laravel Dusk</li>
<li><strong>Monitoring:</strong> Sentry, UptimeRobot</li>
<li><strong>Deployment:</strong> GitHub Actions / GitLab CI</li>
<li><strong>Hosting:</strong> VPS (DigitalOcean / AWS / Vultr)</li>
</ul>
<hr>
<h2>14. Risk Mitigation</h2>
<h3>Risk 1: Scope Creep</h3>
<p><strong>Mitigation:</strong> Strict MVP scope, reject non-essential features</p>
<h3>Risk 2: Timeline Delay</h3>
<p><strong>Mitigation:</strong> 2-week buffer built into timeline</p>
<h3>Risk 3: Technical Challenges</h3>
<p><strong>Mitigation:</strong> POC (Proof of Concept) untuk fitur complex</p>
<h3>Risk 4: Team Availability</h3>
<p><strong>Mitigation:</strong> Cross-training, documentation</p>
<hr>
<h2>15. Success Metrics</h2>
<h3>Launch Success Criteria</h3>
<ul>
<li>✅ Zero critical bugs</li>
<li>✅ All MVP features working</li>
<li>✅ Performance < 2 sec page load</li>
<li>✅ Mobile responsive</li>
<li>✅ User training completed</li>
</ul>
<h3>Post-Launch KPIs (1 Month)</h3>
<ul>
<li>User adoption > 80%</li>
<li>System uptime > 99%</li>
<li>Avg response time < 1 sec</li>
<li>Zero data loss incidents</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Next Review:</strong> Weekly sprint reviews</p>
</div>

</ul>
<hr>
<h2 id="h2-14-risk-mitigation">14. Risk Mitigation</h2>
<h3 id="h3-risk-1-scope-creep">Risk 1: Scope Creep</h3>
<p><strong>Mitigation:</strong> Strict MVP scope, reject non-essential features</p>
<h3 id="h3-risk-2-timeline-delay">Risk 2: Timeline Delay</h3>
<p><strong>Mitigation:</strong> 2-week buffer built into timeline</p>
<h3 id="h3-risk-3-technical-challenges">Risk 3: Technical Challenges</h3>
<p><strong>Mitigation:</strong> POC (Proof of Concept) untuk fitur complex</p>
<h3 id="h3-risk-4-team-availability">Risk 4: Team Availability</h3>
<p><strong>Mitigation:</strong> Cross-training, documentation</p>
<hr>
<h2 id="h2-15-success-metrics">15. Success Metrics</h2>
<h3 id="h3-launch-success-criteria">Launch Success Criteria</h3>
<ul>
<li>✅ Zero critical bugs</li>
<li>✅ All MVP features working</li>
<li>✅ Performance < 2 sec page load</li>
<li>✅ Mobile responsive</li>
<li>✅ User training completed</li>
</ul>
<h3 id="h3-post-launch-kpis-1-month">Post-Launch KPIs (1 Month)</h3>
<ul>
<li>User adoption > 80%</li>
<li>System uptime > 99%</li>
<li>Avg response time < 1 sec</li>
<li>Zero data loss incidents</li>
</ul>
<hr>
<p><strong>Prepared by:</strong> AI Project Analysis System  </p>
<p><strong>Date:</strong> 31 Oktober 2025  </p>
<p><strong>Version:</strong> 1.0.0  </p>
<p><strong>Next Review:</strong> Weekly sprint reviews</p>
</div>


    <!-- FOOTER PAGE -->
    <div class="content-section page-break">
        <h1>📞 Informasi Dokumen</h1>
        <table>
            <tbody>
                <tr><td><strong>Proyek</strong></td><td>Hendra Prop - Sistem Manajemen Properti Multi-Kantor</td></tr>
                <tr><td><strong>Versi</strong></td><td>Final (Complete)</td></tr>
                <tr><td><strong>Tanggal</strong></td><td>31 Oktober 2025</td></tr>
                <tr><td><strong>Target Launch</strong></td><td>3 Maret 2026</td></tr>
                <tr><td><strong>Total Halaman</strong></td><td>~150 halaman</td></tr>
                <tr><td><strong>Total Dokumen</strong></td><td>10 sections</td></tr>
                <tr><td><strong>Total Diagrams</strong></td><td>11 diagrams</td></tr>
            </tbody>
        </table>
        
        <hr>
        
        <div class="alert alert-success">
            <h2>✅ Dokumentasi Lengkap</h2>
            <p><strong>Struktur Dokumentasi:</strong></p>
            <ol>
                <li><strong>BAB 1: Business Requirements Document (BRD)</strong> - 25 FR + 15 NFR</li>
                <li><strong>BAB 2: Software Requirements Specification (SRS)</strong> - System analysis + User Stories</li>
                <li><strong>BAB 3: Entity Relationship Diagram (ERD)</strong> - Database relationships</li>
                <li><strong>BAB 4: Data Flow Diagram (DFD)</strong> - Level 0-1-2 process flows</li>
                <li><strong>BAB 5: Use Case Diagram & Specifications</strong> - 39 use cases</li>
                <li><strong>BAB 6: Activity Diagrams & Business Process Flows</strong> - 5 workflows</li>
                <li><strong>BAB 7: Technical Specifications & Architecture</strong> - 12 modules</li>
                <li><strong>BAB 8: Database Design & Schema</strong> - 12 tables + SQL</li>
                <li><strong>BAB 9: API Specifications</strong> - REST endpoints</li>
                <li><strong>BAB 10: Sprint Planning & Project Timeline</strong> - 6 sprints, 17 weeks</li>
            </ol>
        </div>
        
        <div class="alert alert-info">
            <h2>📊 Fitur Utama yang Didokumentasikan:</h2>
            <ul>
                <li>Multi-kantor property management dengan role-based access</li>
                <li>Public marketplace untuk listing properti</li>
                <li>Private tokenized links untuk akses eksklusif</li>
                <li>Automatic commission calculation (70/30 atau 35/35/30)</li>
                <li>Performance dashboard (Personal, Office, Master)</li>
                <li>Activity log & audit trail untuk compliance</li>
                <li>Notification system (Email & Database)</li>
                <li>Scheduled tasks & automation</li>
                <li>Export reports (Excel/PDF)</li>
                <li>Soft delete protection</li>
            </ul>
        </div>
        
        <hr>
        
        <p style="text-align: center; margin-top: 3rem;">
            <strong style="color: #667eea; font-size: 1.5rem;">🎉 Ready for Development! 🚀</strong>
        </p>
        
        <p style="text-align: center; color: #718096; font-size: 0.9rem; margin-top: 2rem;">
            © 2025 Hendra Prop<br>
            Prepared by: AI Project Analysis System<br>
            <strong>Target Launch: 3 Maret 2026</strong>
        </p>
    </div>
</body>
</html>
